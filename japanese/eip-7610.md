---
original: 5928c267fe00a7722f8a13bc6836d5920490cf627c5bb18a4b5b259a4da8553e
---

---
eip: 7610
title: 非空のストレージがある場合の作成の取り消し
description: 既にアドレスに非空のストレージがある場合、コントラクトの作成をエラーにする
author: Gary Rong (@rjl493456442), Martin Holst Swende (@holiman)
discussions-to: https://ethereum-magicians.org/t/eip-revert-creation-in-case-of-non-empty-storage/18452
status: Review
type: Standards Track
category: Core
created: 2024-02-02
---

## 概要

このEIPは、既に事前にストレージが存在するアドレスでコントラクトの作成を行うと、エラーを発生させるようにするものです。

## 仕様

この文書における「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119およびRFC 8174に記載されている通りに解釈されるものとします。

コントラクトの作成がトランザクションの作成、`CREATE`オペコード、`CREATE2`オペコード、またはその他の理由により行われ、宛先アドレスにすでに非ゼロのnonce、非ゼロのコード長、または非空のストレージが存在する場合、作成は初期化コードの最初のバイトが無効なオペコードであるかのようにエラーを発生させなければなりません(MUST)。この変更は、既存のすべてのブロックに遡って適用されなければなりません(MUST)。

このEIPは、[EIP-684](./eip-684.md)に1つの追加条件を追加するものです。コントラクトのデプロイには、ストレージが空であることが必要です。

## 根拠

EIP-684は、コントラクトのデプロイのための2つの条件を定義しています。宛先アドレスのnonceがゼロで、コード長もゼロでなければならないというものです。しかし、これでは不十分です。[EIP-161](./eip-161.md)が適用される前は、新しくデプロイされたコントラクトのnonceはゼロのままでした。そのため、コンストラクタ内でスロットが設定されていれば、nonceがゼロでコード長もゼロであっても、非空のストレージを持つコントラクトを作成することが可能でした。現在、Ethereumメインネットには28件のそのようなコントラクトが存在します。

スマートコントラクトの根本的な原則の1つは、コードは変更されないということです。たとえコードの長さがゼロであっても同様です。そのため、このような場合にはコントラクトの作成を拒否する必要があります。

## 下位互換性

これは実行レイヤーのアップグレードであるため、ハードフォークが必要です。

## テストケース

Ethereumテストリポジトリおよび実行仕様テストには、非空のストレージを持つターゲットへのデプロイメントのシナリオをテストするテストが多数存在します。これらのテストは過去に問題視されてきました。RethおよびEELSは、テストに合格するためにアカウントのリセットを意図的に実装しています。Py-evmは、この状況は不可能であると宣言し、アカウントのリセットを実装していません。

既存のテストを再度満たすことで、このEIPに十分な範囲のテストカバレッジが得られるでしょう。

## セキュリティ上の考慮事項

このEIPはセキュリティアップグレードです。デプロイされたコードの不変性を強制するものです。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)により放棄されています。