---
original: ff8ec641fe880715e26554a957f99f0ad982e88b8b3ebeeec133b428533a155f
---

---
eip: 5022
title: SSTORE のゼロから非ゼロへのコストを 20k ガスから 40k ガスに増加させる
author: Green (@greenlucid)
status: 停滞
type: Standards Track
category: Core
created: 2022-04-20
discussions-to: https://ethereum-magicians.org/t/eip-proposal-increase-cost-of-sstore-from-20k-to-x-when-creating-new-storage/7614
---

### 概要

SSTORE オペコードのコストを `20_000` ガスから `40_000` ガスに増加させる。ただし、元のスロットがゼロで、結果のスロットが非ゼロの場合に限る。

### 動機

状態の作成コストは状態の大きさに応じて増加する。しかし、新しいストレージスロットを作成するコストは増加していない。
すべてのリソースが同じ価格付けメカニズムに統合されている。ストレージスロットの作成コストが固定されている場合、手動で変更する必要がある。

ガスリミットを上げない主な理由の 1 つは状態の増加である。この点で、ストレージの作成コストがその価格よりも高い場合、他のすべてのオペコードのユーザーがステート作成を補助している。ステート作成のコストがより正確に価格付けされれば、ガスリミットを引き上げることが可能になり、ユーザーにも利益がある。

## 根拠

### なぜ非ゼロから非ゼロへのコストも上げないのか?

ストレージの書き換えは状態の成長には影響しない。これが本 EIP が対処しようとしている主要な問題である。ストレージの書き換えも過小に価格付けされている可能性がある。
状態の成長コストを引き上げることで、少なくともデベロッパーにストレージの再利用を促すことができる。

### なぜ非ゼロからゼロへの ガス払い戻しも増やさないのか?

これについてはさらなる議論が必要である。

### なぜより良い状態ソリューションではないのか?

状態レンタル (state rent) や状態の有効期限切れ (state expiry) などのソリューションは長年研究されてきたが、短期から中期的には準備ができないだろう。したがって、短期的な価格付けの修正を行うことが望ましい。オペコードの価格付けの変更は以前にも行われているので、クライアントの開発時間への大きな投資は必要ないはずである。

### なぜその特定の金額が選択されたのか?

現在の価格付けは、ラップトップでオペコードをベンチマークする単純なアプローチに基づいていた。時間とともにコストが増加するリソースに同じ価格を適用するという長期的な問題を考慮していなかったばかりでなく、ベンチマーク自体が間違っていた。この価格は、元のナイーブなベンチマークが本来あるべきだった価格に近い。さらに引き上げることもできるが、それは過度に混乱を招く可能性がある。

### これは過度に混乱を招くのか?

この変更により多くのアプリケーションのガスコストが大幅に影響を受けるだろう。ネットワークは、より高価な通常のトランザクションの犠牲にならないよう、状態の成長を補助する必要はない。したがって、過度に混乱を招く可能性があっても、ネットワークの健全性を高めることになる。

### 仕様

| 定数 | 値 |
| - | - |
| `FORK_BLOCK` | 未定 |
| `NEW_STORAGE_PRICE` | `40_000` |

`block.number >= FORK_BLOCK` のブロックについて、新しいガススケジュールが適用される。`SSTORE_SET_GAS`、つまりスロットがゼロから非ゼロに設定される際のコストを `NEW_STORAGE_PRICE` に等しくする。その他のコストは変更しない。

### 下位互換性

ハードコーディングされたガスコストに依存するコントラクトは、状態を作成する際に破損する可能性がある。

これはガススケジュールの変更なので、FORK_BLOCK 以前のエポックのトランザクションは前のガスコストで処理される。

## 実装

https://github.com/ethereum/go-ethereum/pull/24725

## セキュリティ上の考慮事項

TODO