---
original: abb48068347755469ee21368046b5844f97f4276c4e82c4b339654c37a6d4088
---

---
eip: 1102
title: オプトイン アカウント エクスポージャー
author: Paul Bouchon <mail@bitpshr.net>, Erik Marks (@rekmarks)
discussions-to: https://ethereum-magicians.org/t/eip-1102-opt-in-provider-access/414
status: 停滞
type: Standards Track
category: Interface
created: 2018-05-04
requires: 1474
---

## 簡単な要約

このプロポーザルは、Ethereum 対応の DOM 環境とデアプリ間のコミュニケーション プロトコルについて説明しています。このプロトコルにより、Ethereum 対応の DOM 環境がデアプリに提供する情報と時期を選択できるようになります。

## 概要

以前の世代の Ethereum 対応 DOM 環境は、ユーザーの同意なしにプロバイダーにアカウントを注入するパターンに従っていました。これにより、悪意のあるウェブサイトがこれらのアカウントを使用して詳細なアカウント情報を表示したり、ユーザーに代わって望ましくない取引を任意に開始したりするリスクがユーザーに生じます。

このプロポーザルでは、Ethereum 対応の DOM 環境がユーザーがアカウントアクセスを承認するまでアカウントを公開しないプロトコルについて説明しています。

## 仕様

### 概念

#### RFC-2119

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"MAY"、"OPTIONAL" というキーワードは、[RFC-2119](https://www.ietf.org/rfc/rfc2119.txt) に記載されているように解釈されるものとします。

#### `eth_requestAccounts`

Ethereum 対応の DOM 環境によって公開されるプロバイダーは、新しい RPC メソッド `eth_requestAccounts` を定義します。このメソッドを呼び出すと、ユーザーがデアプリのアカウントアクセスを承認または拒否できるユーザー インターフェイスがトリガーされる可能性があります。このメソッドは、アカウントが利用可能な場合は `Array` のアカウントで解決される `Promise` を返し、アカウントが利用できない場合は `Error` で拒否される `Promise` を返します。

```typescript
ethereum.send('eth_requestAccounts'): Promise<Array<string>>
```

#### Provider#enable (非推奨)

**注: このメソッドは、RPC メソッド [`eth_requestAccounts`](#eth_requestaccounts) に代わって非推奨となりました。**

Ethereum 対応の DOM 環境によって公開されるプロバイダーは、新しい RPC メソッド `ethereum.enable()` を定義します。このメソッドを呼び出すと、ユーザーがデアプリのアカウントアクセスを承認または拒否できるユーザー インターフェイスがトリガーされます。このメソッドは、ユーザーがアクセスを承認した場合は `Array` のアカウントで解決される `Promise` を返し、ユーザーがアクセスを拒否した場合は `Error` で拒否される `Promise` を返します。

```typescript
ethereum.enable(): Promise<any>
```

### プロトコル

#### 従来のデアプリ初期化

```
デアプリ開始
web3 が定義されている場合
    デアプリ続行
web3 が定義されていない場合
    デアプリ停止
```

#### 提案されるデアプリ初期化

```
デアプリ開始
プロバイダーが定義されている場合
    アカウントアクセスを[1] リクエスト
    ユーザーが承認した場合
        アカウントアクセスを[2] 解決
        デアプリ続行
    ユーザーが拒否した場合
        アカウントアクセスを[3] 拒否
        デアプリ停止
プロバイダーが定義されていない場合
    デアプリ停止
```

##### `[1] リクエスト`

デアプリは、`window.ethereum` に公開されているプロバイダーで `eth_requestAccounts` RPC メソッドを呼び出して、アカウントを要求 **MUST** します。このメソッドを呼び出すと、ユーザーがデアプリのアカウントアクセスを承認または拒否できるユーザー インターフェイスがトリガーされる可能性があります。このメソッドは、ユーザーのアカウントの配列で解決される `Promise` を返す **MUST** か、アカウントが利用できない場合 (ユーザーがアカウントアクセスを拒否した場合など) は拒否される `Promise` を返す **MUST** 。

##### `[2] 解決`

`eth_requestAccounts` RPC メソッドを呼び出して返された `Promise` は、ユーザーのアカウントの `Array` で **MUST** 解決されます。

##### `[3] 拒否`

`eth_requestAccounts` RPC メソッドを呼び出して返された `Promise` は、アカウントが利用できない場合 (理由を示す) に、情報のある `Error` で **MUST** 拒否されます。

### 初期化の例

```js
try {
    // 必要に応じてアカウントアクセスをリクエスト
    const accounts = await ethereum.send('eth_requestAccounts');
    // アカウントが公開されたので、それらを使用する
    ethereum.send('eth_sendTransaction', { from: accounts[0], /* ... */ })
} catch (error) {
    // ユーザーがアカウントアクセスを拒否した
}
```

### 制約

* ブラウザーは、`window.ethereum` にプロバイダーを公開 **MUST** する。
* ブラウザーは、`eth_requestAccounts` RPC メソッドを定義 **MUST** する。
* ブラウザーは、`eth_requestAccounts` の Promise を解決/拒否する前にユーザー操作を待機 **MAY** する。
* ブラウザーは、`eth_requestAccounts` の Promise が解決された場合、少なくとも 1 つのアカウントを含める **MUST** 。
* ブラウザーは、アカウントが利用できない場合、Promise を情報のある `Error` で拒否 **MUST** する。

## 根拠

以前の世代の Ethereum 対応 DOM 環境が採用していた自動アカウント公開のパターンは、ユーザープライバシーを保護せず、安全なユーザー エクスペリエンスを維持できません。信頼できないウェブサイトは、詳細なアカウント情報を表示したり、ユーザーに代わって任意の取引を開始したりできてしまいます。ほとんどのユーザーが信頼できないウェブサイトでの不要な取引を拒否するかもしれませんが、アカウントアクセスのプロトコルはそのような不要な要求を不可能にする必要があります。

このプロポーザルでは、デアプリがユーザーのアカウントへのアクセスを要求する新しいパターンを確立しています。このプロトコルにより、ブラウザーがユーザーのアカウントを非表示にし、信頼できないサイトでの不要な取引要求を防ぐことで、ユーザープライバシーが直接強化されます。

### 即時の付加価値

* ユーザーは、信頼できないサイトでアカウントアクセスを拒否してアカウントを非表示にできます。
* ユーザーは、信頼できないサイトでアカウントアクセスを拒否して、不要な取引を防ぐことができます。

### 長期的な付加価値

* デアプリは、ユーザーの同意に基づいて特定のアカウント情報を要求できます。
* デアプリは、ユーザーの同意に基づいて特定のユーザー情報 (uPort、DID など) を要求できます。
* デアプリは、ユーザーの同意に基づいて特定のネットワークを要求できます。
* デアプリは、上記の複数のインスタンスをユーザーの同意に基づいて要求できます。

## 下位互換性

このプロポーザルはデアプリ開発者に影響を与え、上記のプロトコルに従ってユーザーアカウントへのアクセスを要求する必要があります。同様に、このプロポーザルはデアプリブラウザー開発者にも影響を与え、上記のプロトコルに従ってユーザーアカウントを公開する必要があります。

## 実装

MetaMask チームが[実装](https://github.com/MetaMask/metamask-extension/pull/4703)しています。

## 著作権

著作権およびそれに関連する権利は [CC0](../LICENSE.md) で放棄されています。