---
original: 557ac0c9f043de5f40581584cb5bf3378c9e72707e9219cabe7622771a3b32dd
---

---
eip: 3520
title: トランザクション宛先オペコード
author: Alex Papageorgiou (@alex-ppg)
discussions-to: https://ethereum-magicians.org/t/eip-3520-transaction-destination-opcode/6058
status: 停滞
type: Standards Track
category: Core
created: 2021-04-16
requires: 3508
---

## 簡単な要約

トランザクションの元の受信者にアクセスする。

## 概要

このEIPでは、以下のEVMインストラクション `ENTRYPOINT` を導入します。

このインストラクションは、トランザクションの元の受信者である `to` アドレスにアクセスすることを目的としており、[EIP-3508](./eip-3508.md)と組み合わせて新しい内省方法を適用できるようにします。

## 動機

スマートコントラクトが相互接続されていることは否定できません。これまでのところ、スマートコントラクトは、複雑な複数のコントラクト間の相互作用の新しい段階を導入するために、準拠したインターフェースと内省に完全に依存してきました。しかし、これは前方向のアプローチであり、発生する相互作用の種類を制限します。

このEIPの目的は、コントラクトがブロックチェーン上のトランザクションの入り口を識別し、元のトランザクションデータ自体の内省を適用することで、トランザクションの本来の意図を推測できるようにすることです。

このEIPは、[EIP-721](./eip-721) NFTや[EIP-20](./eip-20)トークンが、トランザクションが分散型取引所への流動性供給やコラテラル付き貸付プロトコル内の貸付など、どのアクションの一部であるかを検出できるようにすることで、新しいタイプのスマートコントラクトの開発を可能にします。

## 仕様

### ENTRYPOINT (`0x4a`)

`ENTRYPOINT`命令は0個のスタック引数を使用し、トランザクションの元の `to` メンバーをスタックにプッシュします。命令によって得られるアドレスは、160ビットの値を256ビットにパディングしたものです。この操作の実行コストは、`ORIGIN` (`0x32`)と同様に `G_base` です。

`ENTRYPOINT`オペコードが返すアドレスは、スタック上の最も近い `AUTHCALL` の `to` アドレスパラメータと等しくなります。スタックに `AUTHCALL` がない場合、`ENTRYPOINT` は元のトランザクションの `to` フィールドを取得します。

## 根拠

### AUTHCALL (`0xf7`) の相互作用

[EIP-3074](./eip-3074.md)では、`ORIGIN` (`0x32`)をコンテキスト変数 `authorized` に置き換える新しい呼び出しインストラクション `AUTHCALL` (`0xf7`)が導入されました。`AUTHCALL`の目的は、`ORIGIN`が当初促進していたスマートコントラクトとEOAの間の差別を防ぐことです。`ENTRYPOINT`オペコード単独では、システムに差別を再導入する可能性があるため、`ENTRYPOINT`によって取得される値も `AUTHCALL`のターゲットに置き換えることが適切です。

この相互作用により、[EIP-3074](./eip-3074.md)との完全な互換性が確保され、このEIPによってシステムに差別が再導入されることはありません。

### 命名規則

`ENTRYPOINT`命令は、特定の呼び出しの最初の相互作用、つまり入り口を示すことを明確に示す適切な名称として定義されました。

### 命令アドレス空間

[EIP-3508](./eip-3508)と同等。

### ガスコスト

`ENTRYPOINT` (`0x4a`) オペコードは本質的に `ORIGIN` (`0x32`) オペコードと同じことを行うため、まったく同じガスコストを共有します。

### EIP-3508への依存性

`ENTRYPOINT` (`0x4a`) 命令単独では明確な利点はありません。`AUTHCALL` (`0xf7`) 命令に置き換えることができるため、[EIP-3508](./eip-3508.md)で定義された `ORIGINDATA*` オペコードと組み合わせてのみ、システムに導入されるべきです。

## 下位互換性

このEIPは、EVMの既存の機能を変更または調整するものではないため、既知の問題はありません。

## テストケース

TODO.

## セキュリティ上の考慮事項

### 内省型コントラクト

`ENTRYPOINT`命令により、`ORIGINDATALOAD`および`ORIGINDATACOPY`の値を特定のスマートコントラクトアドレスおよびインターフェースに関連付けることができ、呼び出し経路を確実に推測し、特殊なケースでより細かい相互作用を定義できるようになります。

ただし、この種の内省は、ユーザー定義のコントラクトではなく、事前に承認されたコントラクトにのみ適用する必要があります。なぜなら、この種の内省から得られる価値は、コントラクトのコード不変性と適切な機能に完全に依存しているためで、ユーザー提供のコントラクトは簡単にこれらを回避できるからです。

### 呼び出し側の差別

このEIPのインストラクションは、`AUTHCALL`の仕様で定義されているように、EOAの呼び出し側とスマートコントラクトを区別するために使用してはいけません。この種の差別は、`AUTHCALL`によって破られる可能性があります。

### コントラクト作成時の動作

`ENTRYPOINT`オペコードのコントラクト作成時の動作は、オペコードがゼロアドレスを返すことになります。これは、`ecrecover`の無効な署名の処理と同様に、コントラクト実装によって考慮される必要があります。

## 著作権

著作権およびその関連権利は[CC0](../LICENSE.md)によって放棄されています。