---
original: 7595ec5dc6f2b195d57966ab2cc2d9e5e9c5cc7c120f14b6b24aa23b48a87680
---

---
eip: 6475
title: SSZ Optional
description: オプション値を表現する新しいSSZタイプ
author: Etan Kissling (@etan-status), Zahary Karadjov (@zah)
discussions-to: https://ethereum-magicians.org/t/eip-6475-ssz-optional/12891
status: 停滞
type: Standards Track
category: Core
created: 2023-02-09
---

## 概要

このEIPでは、`Optional[T]`値を表現する新しい[Simple Serialize (SSZ) タイプ](https://github.com/ethereum/consensus-specs/blob/67c2f9ee9eb562f7cc02b2ff90d92c56137944e1/ssz/simple-serialize.md)を導入します。

## 動機

オプション値は現在、回避策を使ってのみSSZで表現できます。適切なサポートを追加することで、以下のような利点があります:

1. **可読性の向上:** オプション値を持つSSZ構造を、基礎となるプログラミング言語のイディオム的なタイプ、例えばPythonの`Optional[T]`で表現できるようになり、扱いやすくなります。

2. **コンパクトなシリアル化:** オプション値の二進的性質を利用してSSZシリアル化を行えるため、回避策に基づく方法よりもコンパクトなシリアル化が可能になります。

## 仕様

この文書における「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

### タイプ定義

`Optional[T]`は以下のいずれかを表現できるタイプとして定義されます:

- SSZタイプ`T`の値
- 値がない状態を示す`None`

### デフォルト値

`Optional[T]`のデフォルト値は`None`です。

### シリアル化

```python
if value is None:
    return b""
else:
    return b"\x01" + serialize(value)
```

### デシリアル化

`Optional[T]`のデシリアル化は入力の長さによって異なります:

- 入力の長さが0の場合、値は`None`です。
- それ以外の場合、デシリアル化範囲の最初のバイトが`0x01`であることを確認し、残りの範囲は`T`と同様にデシリアル化します。

### Merkleization

`Optional[T]`はMerkleizeされた`List[T, 1]`として表現されます。

- 値が`None`の場合、リストの長さは`0`です。
- それ以外の場合、リストの長さは`1`で、最初のリスト要素に基礎となる値が含まれます。

## 根拠

### なぜ`Union[None, T]`ではないのか?

`Union[None, T]`では、将来的に型が拡張される可能性、例えば`Union[None, T, U]`があいまいです。

さらに、SSZのUnionタイプは現在Ethereumの最終仕様では使用されておらず、設計自体も確定していません。`Optional[T]`の使用例がUnionタイプのための回避策にすぎない場合、より単純な`Optional[T]`タイプで十分であり、一般的なUnionのサポートは本当に必要になるまで遅らせることができます。`Optional[T]`の設計は、より一般的な`Union`の基礎として使用できます。

### なぜ`List[T, 1]`ではないのか?

可変長の`T`の場合、リストの長さを示すオフセットテーブルが先頭に追加されるため、シリアル化が効率的ではありません。

## 下位互換性

`Union[None, T]`および`List[T, 1]`の回避策は現時点では`Optional[T]`を表現するために使用されていません。

## テストケース

[EIPアセット](../assets/eip-6475/tests.py)を参照してください。

## 参考実装

- **Python:** [EIPアセット](../assets/eip-6475/optional.py)を参照、`protolambda/remerkleable`に基づいています
- **Nim:** `status-im/nim-ssz-serialization`

## セキュリティ上の考慮事項

なし

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。