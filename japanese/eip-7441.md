---
original: d5ab14a67274efa8e8c75f55fb0ea6092bcadff94abf52f4a25b57de147c8677
---

---
eip: 7441
title: Whiskへのブロック提案者選挙のアップグレード
description: DoS攻撃を防ぐため、ブロック公開までブロック提案者を秘密にする
author: George Kadianakis (@asn-d6), Justin Drake (@JustinDrake), dapplion (@dapplion)
discussions-to: https://ethereum-magicians.org/t/eip-7441-upgrade-block-proposer-election-to-whisk-ssle/15316
status: 停滞
type: Standards Track
category: Core
created: 2023-09-01
---

## 概要

ブロック提案者選挙メカニズムをWhisk (Single Secret Leader Election、SSLE) プロトコルにアップグレードします。現在、ブロック提案者は事前に公開されているため、Ethereumを無効化する可能性のある順次的なDoS攻撃を受けることができます。このアップグレードにより、次のブロック提案者は自身のブロックが公開されるまで秘密のままになります。

## 動機

ビーコンチェーンは現在、各エポックの開始時に次の32人のブロック提案者を選出しています。この選挙の結果は公開されており、誰もがこれらの将来のブロック提案者の身元を知ることができます。

この情報漏洩により、攻撃者はEthereumを無効化しようとして、各提案者に対して順次DoS攻撃を仕掛けることができます。

## 仕様

### 実行レイヤー

実行レイヤーへの変更は必要ありません。

### コンセンサスレイヤー

このプロトコルは以下の並行ステップで要約できます:

- バリデーターはフォーク後の最初の提案時に、トラッカーと一意のコミットメントを登録する
- シャッフリングフェーズの開始時に、RANDAOからの公開ランダム性を使用して候補トラッカーのリストが選択される
- 各シャッフリングフェーズ中、各提案者は秘密のランダム性を使用して候補トラッカーのサブセットをシャッフルする
- 各シャッフリングフェーズ後、RANDAOを使用して候補セットから順序付けられたプロポーザートラッカーのリストが選択される

提案された変更の完全な仕様は、[`/_features/whisk/beacon-chain.md`](https://github.com/ethereum/consensus-specs/blob/a39abe388bc2d1abd5b4fd62fd18aed497956b30/specs/_features/whisk/beacon-chain.md)にあります。要約すると:

- バリデーターのトラッカー、コミットメント、2回の候補者選出ラウンドを追跡するために、`BeaconState`にフィールドを追加する。
- 次のベクトルの候補者をバリデーターセットから計算する `select_whisk_candidate_trackers` を追加する。
- 現在の候補者から次のベクトルのプロポーザーを計算する `select_whisk_proposer_trackers` を追加する。
- エポック処理ロジックに `process_whisk_updates` を追加する。
- ブロック提案者が選出されたトラッカーの知識を検証する `process_whisk_opening_proof` を追加する。
- `process_block_header` を変更し、`get_beacon_proposer_index` での提案者選挙アサーションを削除し、代わりに有効な開示証明をアサートする。
- 開示証明、シャッフルされたトラッカーと証明、トラッカー登録と証明を送信するために、`BeaconBlockBody`にフィールドを追加する。
- 事前シャッフル候補者選択を計算する `get_shuffle_indices` を追加する。
- シャッフルされた候補トラッカーを送信する `process_shuffled_trackers` を追加する。
- ブロック処理ロジックに `process_whisk` を追加する。
- 初期の一意のトラッカーとコミットメントを登録するために、`apply_deposit` を変更する (エントロピーなし)。

## 根拠

### バリデーターごとのフィールド

Whiskには、バリデーターごとに1つのトラッカー `(rG,krG)` と1つの一意のコミットメント `kG` が必要です。両方とも、フォーク後の最初の提案時にのみ更新されます。

トラッカーは、シャッフリングゲートを介してトラッカーを追跡するのを難しくするために、ランダム化されたベース `(rG,krG)` で登録されます。正直なシャッフラーのセットが小さい場合、これが問題になる可能性があります。

### 身元の結合

各トラッカーは、複数の当事者が同じ提案者スロットを主張するのを防ぐために、バリデーターの身元に結合されている必要があります。そうしないと、提案者がプロポーザースロットを売却したり、2つの競合するブロックが表示された場合にフォークチョイスの問題が発生したりする可能性があります。

Whiskは、トラッカーの秘密 `kG` のコミットメントをバリデーターレコードに格納することで、身元の結合を行います。コミットメントを格納することで、`k` の一意性も保証されます。

代替案として、`hash(kG)` のハッシュプレフィックスをバリデーターインデックスと一致させることで、身元の結合を実現できます。ただし、バリデーターは `k` をブルートフォースする必要があるため、計算リソースの少ない参加者にとってシステムの立ち上げが困難になります。

身元の結合は、`k = hash(nonce + pubkey)` と設定することでも実現できます。ただし、提案者は `k` を明らかにする必要があり、隣接するシャッフリングフェーズでの繰り返し提案により、匿名性が失われます。

### 代替案: 単一秘密選挙以外の選挙

秘密の非単一リーダー選挙は、暗号学ではなくプロトコル設計に基づいているため、Whiskよりもはるかに単純で安価です。ただし、フォークチョイスを複雑化し、潜在的なMEVタイムバイイング攻撃に開かれるため、現時点では適切なオプションではありません。

### 代替案: ネットワークの匿名性

DandelionやDandelion++などのプライバシー保護ネットワークプロトコルは、ネットワーク参加者のプライバシーを高めますが、Ethereumのユースケースには十分ではありません。

SASSAFRASは、コンセンサス面ではより単純なSSLEプロトコルの代替案ですが、ネットワークの匿名性レイヤーに依存しています。その特定のトレードオフは、Whiskよりもイーサリアムの全体的な脅威モデルに適していません。

## 下位互換性

このEIPは、コンセンサスレイヤーのブロック検証ルールセットに下位互換性のない変更を導入するため、ハードフォークを伴う必要があります。

PBS参加者(ビルダーなど)は、提案者が事前に自身を明らかにしない限り、次の提案者バリデーターインデックスを知ることはできません。ブロックエクスプローラーやツールは、特定のバリデーターインデックスに欠落したスロットを属性付けできなくなります。

## セキュリティの考慮事項

シャッフリング戦略は、付随論文で分析され、Whiskの使用例に十分に安全であると考えられています。このEIPのデータと計算複雑性は重要ですが一定であり、新しいDoS攻撃ベクトルを開くことはありません。

### 匿名性セット

Whiskの匿名性セットは、提案者として選出されなかった8,192人の候補者セットです。このバリデーター数に対応するp2pノードの数はより少ないと考えられます。"20%のノードが80%のバリデーターを実行する"というパレート原則を仮定すると、平均的な匿名性は2,108ノードに相当します。より大きな候補プールを使用すると、シャッフリング戦略が安全でなくなる可能性がありますが、1ラウンドあたりのトラッカーをシャッフルすることで、ZKプルーフのコストが増加します。

### RANDAOバイアス

Whiskは、候補者選択とプロポーザー選択のイベントでRANDAOを使用しており、悪意のあるプロポーザーによるRANDAOバイアス攻撃の対象となります。Whiskのセキュリティを現状と同等にするには、選択イベントを1つの完全なシャッフリング期間にわたって分散させる必要があります。ただし、現状のセキュリティも理想的ではなく、プロトコルをさらに複雑化することになります。

## 著作権

著作権およびその関連権利は[CC0](../LICENSE.md)で放棄されています。