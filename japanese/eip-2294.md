---
original: 261a66e1f4fa03fe4eb5bf215739a10ed35c989825d37b0ec3363da72adb7a9e
---

---
eip: 2294
title: Chain ID サイズの明示的な制限
description: Chain ID パラメータの最大値を追加し、大きな値を使用する際に発生する可能性のある符号化の問題を回避します。
author: Zainan Victor Zhou (@xinbenlv)、Alex Beregszaszi (@axic)、Bryant Eisenbach (@fubuloubu)
discussions-to: https://ethereum-magicians.org/t/eip-2294-explicit-bound-to-chain-id/11090
status: Review
type: Informational
created: 2019-09-19
requires: 155
---

## 概要

このEIPは、[EIP-155](./eip-155.md)や主要なウォレットおよびJsonPRCにおけるChainIdの表現などの既知の制限に基づいて、ChainIdの "Safe Range" と "Max Range" を情報として定義します。

## 動機

1. エコシステムの各コンポーネント(スマートコントラクト、ウォレット、dApp、JsonPRCなど)で、chainIdが安全であることを確認したい。
2. クロスチェーン関数呼び出しを可能にしたい。
3. [EIP-712](./eip-712.md)ドメインでChainIDをパックする方法を明確に定義したい。
4. L2、L3、Ethereumメインネットのシャーディングなど、チェーンの拡張を可能にしたい。
5. ハッシュベースの一時的なチェーン: 論争的なフォークや他のシナリオに対応できるように、Chain IDの代わりにハッシュベースの識別子を使用することが提案されています。この提案ではこの動作は説明していませんが、~63ビットのエントロピーがあれば、合理的な(例えば悪意のない)使用の場合、衝突が発生する可能性は低いはずです。

## 仕様

我々は以下のchainIDの範囲を宣言しました。

1. (1, 2^31 - 1): "Safe Range"、上限はJavaScriptの数値によって決まります。
2. (1, MAX_CHAIN_ID); "Max Range"、ここで `MAX_CHAIN_ID := floor(MAX_UINT64 / 2) - 36 = 9,223,372,036,854,775,771`:

## 根拠

### "Max Range"を超えると、EIP-155がオーバーフローする可能性があります

`MAX_CHAIN_ID`は、uint64の計算時にオーバーフローが発生しないように計算されています。参考までに、0以下の値も許可されていません。

Chain IDの計算方法により、使用される最大値は `CHAIN_ID * 2 + 36` になるため、クライアントはこの最大値を使用する際にオーバーフローが発生しないことを確認する必要があります。アンダーフローは発生しません。

EIP-155はChain IDパラメータを導入しましたが、このパラメータのサイズについては何も指定していません。256ビット幅を許可すると、トランザクションのRLP符号化にはより大きな(>256ビットの)算術演算が必要になります。

そのため、このパラメータの合理的な最大サイズを強制することで、このパラメータの符号化時に問題が発生しないようにします。これにより、ジェネシスパラメータとしてコミュニティの合意によって選択されるこのパラメータに対して、十分な数の異なる値を確保できます。

Chain IDの適切な値がない場合、[EIP-155](./eip-155.md)(および[EIP-1344](./eip-1344.md)の派生物)の実装にクライアントコードベースと外部ツールの両方で違いが生じ、ネットワークに重大な脆弱性が導入される可能性があります。この制限を明示的に定義することで、Ethereumおよびイーサリアムコードベースを使用するプロジェクトでこのような事態を回避できます。

また、[EIP-1344](./eip-1344.md)を使ってスマートコントラクト実行時にCHAIN IDを公開するコントラクトが増えているため、chainIdの使用と依存性が増加しています。[EIP-712](./eip-712.md)、[ERC-1271](./eip-1271.md)でのオンチェーン署名検証など、chainIdはリプレイ攻撃の防止に使用されています。暗号化処理でchainIdの計算結果が全ケースで一致するよう、クライアントの安全性を確保することが重要です。

## 下位互換性

このEIPは、この機能の以前の実装に影響を与える変更を導入します。ただし、執筆時点(2022-10-18)では、提案された範囲外の値を使用しているチェーンは知られていないため、この制限を採用しても影響はないはずです。

他のチェーンが互換性のないchainIdを使用している場合は、このEIPが採用されたときに適切な対応を行うよう助言します。

## セキュリティ上の考慮事項

議論が必要です。

## 著作権

著作権およびその関連権利は[CC0](../LICENSE.md)によって放棄されています。