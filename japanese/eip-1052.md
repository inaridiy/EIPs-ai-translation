---
original: ee0060dc484764171633f6a5afc8733892043c776b244c42b2b72a3d16d6cf3d
---

---
eip: 1052
title: EXTCODEHASH オペコード
author: Nick Johnson <arachnid@notdot.net>, Paweł Bylica <pawel@ethereum.org>
discussions-to: https://ethereum-magicians.org/t/extcodehash-opcode/262
status: 最終版
type: 標準トラック
category: コア
created: 2018-05-02
requires: 161
---

## 概要
このEIPは、コントラクトのコードのkeccak256ハッシュを返す新しいオペコードを指定しています。

## 動機
多くのコントラクトは、コントラクトのバイトコードに対してチェックを行う必要がありますが、必ずしもバイトコード自体を必要としているわけではありません。例えば、コントラクトは別のコントラクトのバイトコードが許可された実装の1つであるかどうかをチェックしたり、コードを分析し、分析が合格した場合にバイトコードが一致するコントラクトをホワイトリストに登録したりする必要があります。

現在、コントラクトは `EXTCODECOPY` (`0x3c`) オペコードを使ってこれを行うことができますが、特に大規模なコントラクトの場合、ハッシュのみが必要な場合でも非常に高価です。そのため、我々は新しいオペコード `EXTCODEHASH` を提案し、これはコントラクトのバイトコードのkeccak256ハッシュを返します。

## 仕様

新しいオペコード `EXTCODEHASH` が導入され、番号は `0x3f` です。 `EXTCODEHASH` は
スタックから1つの引数を取り、最初の96ビットをゼロにし、
残りの160ビットを表すアドレスのコードのkeccak256ハッシュをスタックにプッシュします。

アカウントが存在しない場合や空の場合 ([EIP-161](./eip-161.md)で定義されているように)、0がスタックにプッシュされます。

アカウントにコードがない場合は、空のデータのkeccak256ハッシュ
(つまり `c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470`)
がスタックにプッシュされます。

`EXTCODEHASH` のガスコストは400です。

## 根拠

動機の項で説明したように、このオペコードは広く有用であり、多くの場合ガスの無駄を節約することができます。

ガスコストは `BALANCE` オペコードと同じです。これは、 `EXTCODEHASH` の実行には `BALANCE` と同じアカウントルックアップが必要であるためです。

引数の最後の20バイトのみが重要で (最初の12バイトは無視される)、これは `BALANCE` (`0x31`)、`EXTCODESIZE` (`0x3b`)、`EXTCODECOPY` (`0x3c`) のセマンティクスと同様です。

`EXTCODEHASH` は、コードのないアカウントと存在しないアカウントを区別します。
これは、状態トライ内のアカウントの表現方法と一致しています。
これにより、スマートコントラクトがアカウントの存在を確認することができます。

## 下位互換性

下位互換性の問題はありません。

## テストケース

1. コードのないアカウントの `EXTCODEHASH` は `c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470`
   (空のデータのkeccak256ハッシュ) です。
2. 存在しないアカウントの `EXTCODEHASH` は `0` です。
3. プリコンパイルドコントラクトの `EXTCODEHASH` は `c5d246...` または `0` です。
4. `A` の `EXTCODEHASH` が `X` の場合、`A + 2**160` の `EXTCODEHASH` も `X` です。
5. 現在のトランザクション内で自己破壊されたアカウントの `EXTCODEHASH`。
6. 自己破壊されて後に自己破壊が取り消されたアカウントの `EXTCODEHASH`。
7. 現在のトランザクション内で作成されたアカウントの `EXTCODEHASH`。
8. 新しく作成されて後に作成が取り消されたアカウントの `EXTCODEHASH`。
9. 最初は存在せず後に空になったアカウントの `EXTCODEHASH`。
10. 状態クリアルールによってクリアされる予定の空のアカウントの `EXTCODEHASH`。

## 実装
TBD

## 著作権
著作権およびその関連権利は [CC0](../LICENSE.md) により放棄されています。