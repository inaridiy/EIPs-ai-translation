---
original: 728903ba3fdffc2ebb07777b795de453695b4d455ce3f6e1a99369889d76c581
---

---
eip: 158
title: ステートクリアリング
author: Vitalik Buterin (@vbuterin)
type: Standards Track
category: Core
status: Final
created: 2016-10-16
---

# 仕様

`block.number >= FORK_BLKNUM`(TBA)のすべてのブロックについて:
1. アカウントの状態変更が行われ、その状態変更の結果、アカウントの状態がnonce = 0、balance = 0、codeが空、storageが空(以下「空アカウント」)で保存される場合、アカウントは代わりに削除される。
2. アドレスが「タッチ」され、そのアドレスに空アカウントが含まれている場合、それは削除される。「タッチ」とは、そのアドレスのアカウントが存在しない場合に作成されるような状況を意味する。
3. EVMがアカウントの存在を確認する際、空であることは存在しないことと同等に扱われる。特に、この変更が有効になると、EVMの実行の観点から、空であることと存在しないことの間に意味のある違いはなくなることに注意する必要がある。
4. 0値のコールと0値のsuicideは、いかなる状況でも25,000アカウント作成ガスコストを消費しなくなる。

「タッチ」が行われるケースは以下のように列挙できる:
- 0値のCALL
- CREATEの場合(最終的に保存されるコードが空で、アカウントに残高がない場合)
- 0値のSUICIDE
- トランザクション受信者
- コントラクト作成トランザクションで作成されたコントラクト
- トランザクション手数料を受け取るマイナー(ガス価格が0の場合、ブロック/叔父/甥の報酬を受け取るのは全トランザクション処理後であるため、アカウントがまだ存在しない場合)

### 仕様(1b)

EVMが空であるかどうかを確認する際(25,000ガスコストを適用するかどうかの目的で)、空であるかどうかは`is_empty(acct): return get_balance(acct) == 0 and get_code(acct) == "" and get_nonce(acct) == 0`で定義される。storageの空であるかどうかは関係ない。これにより、クライアントの実装が簡素化される。なぜなら、キャッシュを正しい方法で列挙するための余分な複雑さを追加する必要がなく、balance/code/nonceが空でstorageが空でない場合に、この変更により25,000ガスが余分に支払われるようなパラダイムな事例は、実際の用途がないためである。

### 仕様(1c)

上記の2番目の点(つまり、新しい空アカウントを作成することはできないが、実際の_変更_がない限り、既存のものは自動的に破棄されない)は実装しない。代わりに、Nブロック目から(Nを含む)、null アカウントが残っている間、sha3(address)の順番で左から1000のnullアカウントを選択し、それらを削除する(ハッシュ順序は、ツリーを反復して簡単に見つけられるようにするために必要である)。

# 根拠

これにより、以前のイーサリアムプロトコルのバグにより、非常に低コストで状態に追加された多数の空アカウントが削除されるため、状態サイズが大幅に削減され、フルクライアントのハードディスク負荷と高速同期時間が減少する。さらに、長期的にはプロトコルが簡素化される。なぜなら、すべての「空」オブジェクトがクリアされると、アカウントが空であることと存在しないことの間に意味のある違いはなくなり、事実上、存在しないことが空であることの簡潔な表現と見なすことができるようになるからである。

ただし、この提案では、既存の空アカウントに対して0値のコールを繰り返すことで、通常の5,000ガス/アカウントではなく700ガス/アカウントでステート変更を作成できるという、一時的な既存の保証の破壊が導入される。このように多数のステート書き込みをブロックあたり許可すると、ブロック処理時間が長くなり、短期的にはおじいさんレートが上がる。しかし、すべての空アカウントがクリアされると、この問題は解消される。

# 参考文献

1. EIP-158 issue and discussion: https://github.com/ethereum/EIPs/issues/158
2. EIP-161 issue and discussion: https://github.com/ethereum/EIPs/issues/161