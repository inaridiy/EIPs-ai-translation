---
original: a58d905f2250bc98e6a362d937ccfdeb875721b8245c4ce23fc2e7780c531e92
---

---
eip: 7664
title: アクセスキーオペコード
description: アクセスキーオペコードにより、コントラクトはアクセスリストに静的に宣言された入力を読み取ることができます。
author: Diederik Loerakker (@protolambda)
discussions-to: https://ethereum-magicians.org/t/access-key-opcode/19395
status: 取り下げられた
withdrawal-reason: 限定的な使用例、EIP-7702でより良く実装できる。
type: Standards Track
category: Core
created: 2024-03-27
requires: 1153, 2930, 4844
---

## 概要

このEIPは、実行中のアドレスのアクセスリストキーを検査する新しいオペコードを導入します。

## 動機

このEIPは、トップレベルコールの検出を置き換えるものであり、スマートコントラクトが属性の静的な宣言を強制できるようにします。

以前は、アカウントアブストラクションの支持者からの一般的な助言に反して、アプリケーション層のコントラクトが`tx.origin`に依存して、トップレベルコールを強制していました。このようにして、コントラクトの入力がトランザクション入力としてエンコードされていました。

トランザクションのアクセスリストは直接実行に影響しますが、ガスコストにのみ影響します。このEIPは、`tx.origin`の動作やガスの内省に依存することなく、静的に定義されたコントラクト入力の特性を提供するためにアクセスリスト機能を拡張します。

これにより、スマートコントラクトは入力の静的な宣言を確実に強制できるようになります。

これは、[EIP-2930](./eip-2930.md)の動機で説明されている目的を達成するための一歩です:

> アクセスリストフォーマットとそのフォーマットを処理するロジックを導入します。
> このロジックは後に、ブロック全体のウィットネス、ReGenesisでの使用、時間の経過とともに静的な状態アクセスへの移行など、多くの他の目的に再利用できます。

## 仕様

### パラメータ

| 定数                       | 値    |
|----------------------------|--------|
| `ACCESS_KEY_OPCODE_GAS`    | `3`    |
| `ACCESS_KEY_OPCODE_BYTE`   | `0x4B` |

### オペコード

`ACCESS_KEY`(オペコード`ACCESS_KEY_OPCODE_BYTE`)という命令を追加します。これはスタックの上部から`index`を大エンディアンの`uint256`としてポップし、`address`が`tx.access_list`に存在し、`index < len(tx.access_list[address])`の場合は`tx.access_list[address][index]`をスタックにプッシュします。それ以外の場合は、ゼロ埋めされた`bytes32`値をプッシュします。

### ガスコスト

このオペコードの固定ガスコストは`ACCESS_KEY_OPCODE_GAS`です。

トランザクション自体のアクセスリストの内容の固有のガスコストは変更されません。

## 根拠

### トランザクションの静的分析

コントラクト入力の静的な宣言により、高度なレイヤー2の構築とブロック構築の技術が可能になります。データはEVMの内省なしで利用可能で、コントラクトはクリティカルな特性をブロックビルダーと検証ノードに宣言したかどうかを確実に知ることができます。

コントラクト入力の静的宣言は、トランザクションバンドラーなどのアカウントアブストラクション関連の変更や、3074でのプロトコル内の変更から独立しています。
<!-- EIP link/requires omitted due to Walidator EIP status bug -->

### グローバルな読み取り専用の値

[EIP-1153](./eip-1153.md)で説明されている`TLOAD`に似て、`ACCESS_KEY`オペコードはトランザクションのメッセージ実行中にグローバルなビューをコントラクトに提供します。

ただし、`ACCESS_KEY`では読み取り専用であり、トランザクションの実行中に変更されることはありません。

### アクセスリストの有用性

現在、アクセスリストはほとんど活用されていません。ほとんどのユーザーがEIP-2930による ガスコスト削減の恩恵を受けていません。

このEIPにより、EVMに追加のリソースを必要とすることなく、アクセスリスト機能の有用性が高まります。

### ウィットネスデータ

このEIPは、アプリケーションの状態を削減するための変換をサポートします。これは、コントラクトの呼び出し側がデータの転送をサポートする必要なく、読み取り専用のアプリケーション状態をコントラクトに提供できるようにすることで実現されます。

アクセスリストの内容にはウィットネスデータが含まれる可能性があり、コントラクトはこれを検証して状態を削減することができます。

### ガスコスト

`ACCESS_KEY_OPCODE_GAS`ガスコストは、同様の操作と一致しています。具体的には、[EIP-4844](./eip-4844.md)の`BLOBHASH`オペコードと同じです。このオペコードもスタックからインデックス型のEVMワードをポップし、トランザクションに埋め込まれたハッシュのリストに基づいて32バイトのEVMワードをスタックにプッシュします。

ただし、[EIP-4844](./eip-4844.md)の`BLOBHASH`機能は、このEIPの目的には再利用できません。ここでの意図は、ただ静的に宣言されたハッシュにアクセスすることであり、Blobのコストではありません。

### `ACCESS_KEY`の命名

現在のアクセスリストは、アクセスキーのリストのみをサポートしています。リストは並べ替えされる必要はなく、インデックス付きの検索をサポートしています。

これは`SLOAD`や`TLOAD`のような`LOAD`オペコードではなく、キーを返すオペコードです。

## 下位互換性

### トランザクションタイプの変更なし

アクセスリストの機能拡張は、アクセスリストのエンコーディングや、アクセスリストをサポートする既存のトランザクションタイプに影響を与えません。

### EVMトランザクションコンテキストへの最小限の影響

EIP-2930により、アクセスリストの内容はEVM実行中のトランザクションコンテキストですでに利用可能です。また、そのような実行をトリガーするRPCメソッドでも利用可能です。

したがって、このEIPはEVMコンテキストの構築や、RPCメソッドに大きな変更を加える必要はありません。

## テストケース

ブロックの手数料受取人や、トランザクションのアクセスリストに静的に宣言されていない他の温められた属性は、アクセスリストの一部とは見なされません。

## セキュリティ上の考慮事項

アクセスリストの属性はEIP-2930でガスメーターされており、ストレージガスコストを判断するためにEVMで容易に利用可能です。拒否サービス攻撃のリスクに関しては、このEIPは新しい重要なデータや、データ処理コストを導入しません。

アクセスリストは読み取り専用であるため、アプリケーション開発者にとってのリスクは最小限です。

アクセスは、それ以外の場合に温められた`SLOAD`を実行するコントラクトに厳密にスコープされているため、ストレージレイアウトの抽象化がスマートコントラクトアプリケーション間で漏洩することはありません。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。