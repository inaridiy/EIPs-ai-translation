---
original: f869539f6a3ee67f1c81b371de9c83d822c8e38c6ba1fa1dab77f941c7817541
---

---
eip: 2677
title: `initcode`のサイズ制限
author: Martin Holst Swende (@holiman), Paweł Bylica (@chfast), Alex Beregszaszi (@axic)
discussions-to: https://ethereum-magicians.org/t/eip-2677-limit-size-of-initcode/4550
status: 取り下げられた
type: Standards Track
category: Core
created: 2020-05-18
withdrawal-reason: EIP-3860に置き換えられた。
---

## 簡単な要約

`initcode`の最大サイズ制限(`max_initcode_size`)を`49152`(`0xc000`)に設定する。

## 概要

`initcode`の最大サイズ制限(`max_initcode_size`)を設定する。`initcode`のサイズが`max_initcode_size`を超えた場合、ガス切れエラーでコントラクト作成に失敗する。

[EIP-170](./eip-170.md)の実装以来、コントラクトコードのサイズ制限は`24576`(`0x6000`)となっている。我々は、実行可能コードのサイズ制限を上記の2倍の`49152`(`0xc000`)に設定することを提案する。

これにより、以下の2つの良い特性が得られる:

- コードのオフセットが16ビット値に収まる
- コードサイズが16ビット値に収まる

## 動機

クライアントが`initcode`を実行する際、クライアントはジャンプ先解析を行う必要がある。場合によっては、クライアントがコードの`ハッシュ`も計算する:

* マッピングのキーとして使用するためのジャンプ先解析の結果
* `CREATE2`内のアドレス計算に使用するため

ジャンプ先解析の処理量はコードサイズに比例して増加する。現在、トランザクションはメモリを1回だけ拡張でき、同じメモリセグメントを(わずかな変更で)再利用して、クライアントに多くの解析/ハッシュ処理を強いることができる。これにより、ブロック処理が遅くなる。 

歴史的に、これは2017年6月に悪用されており、[geth](https://github.com/ethereum/go-ethereum/releases/tag/v1.6.5)の1.6.5パッチリリースを引き起こした。

`CREATE2`内のアドレス計算の処理量は、コードサイズに比例して課金される。

## 仕様

この制限は以下の3つの状況で適用される:

* `CREATE`
* `CREATE2`
* 受信者が空のトランザクションによる作成

これらの(および将来の)すべての場合において、コードの長さが`max_initcode_size`を超えた場合、EVMはガス切れエラーで失敗する。

## 根拠

TBA

## 下位互換性

このEIPは「ネットワークアップグレード」を必要とするため、コンセンサスルールを変更する。

## セキュリティ上の考慮事項

クライアント実装にとって、このEIPはジャンプ先解析やコードのハッシュに基づく攻撃をより問題の少ないものにするため、クライアントの堅牢性を高めるはずである。 

レイヤー2にとっては、このEIPは以前にはなかった失敗モードを導入する。マルチレベルのコントラクト階層を展開するファクトリーコントラクトが存在する可能性がある。つまり、最初のコントラクトのinitcodeに複数のコントラクトのコードが含まれている可能性がある。このEIPの著者(ら)はそのようなコントラクトを認識していない。

## テストケース

以下のようなテストケースを含める必要がある:

- `max_initcode_size`の`initcode_size`での`CREATE`/`CREATE2`/`tx create`
- `max_initcode_size+1`の`initcode_size`での`CREATE`/`CREATE2`/`tx create`

## 実装

TBA

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。