---
original: 8272007cc10cb854ca1e423e654ef8dce532fd9fc2c1c5a5debfaaa8b6fb64fb
---

---
eip: 1962
title: EC算術とランタイム定義のペアリング
author: Alex Vlasov (@shamatar)
discussions-to: https://ethereum-magicians.org/t/generalised-precompile-for-elliptic-curve-arithmetics-and-pairings-working-group/3208/2
type: Standards Track
category: Core
status: Stagnant
created: 2019-04-22
requires: 1109
---

# 簡単な要約

このプロポーザルは[EIP-1829](./eip-1829.md)の拡張と形式化であり、ペアリングが含まれています。[EIP-1109](./eip-1109.md)は、一部の操作の費用が`STATICCALL`オペコードに比べて低いため必要とされます(以下の対応するセクションでより詳しく説明します)。

## 概要

このEIPは、プライバシーとスケーリングソリューションに必要な暗号機能を提供する新しいプリコンパイルを提案しています。このプリコンパイルの機能には以下が必要です:

- ウェアストラス形式の楕円曲線上で以下の操作を実装すること:
    - 点の加算
    - 1つの点のスカラー倍
    - 多重指数計算
- ランタイムで定義されたベース・フィールド、A、Bの係数を持つ以下の"ファミリー"の楕円曲線上でペアリング操作を実装すること:
    - BLS12
    - BN
    - MNT4/6 (Ateペアリング)

プリコンパイルの完全な機能は、以下の「仕様」セクションで説明されています。

## 動機

- [EIP-1829](./eip-1829.md)で対象となる基本的な楕円曲線算術を実装する提案があり、これにより合理的なガス費用でさまざまなプライバシー保護プロトコルを実装できるようになります。
- ペアリングは基本的な算術の重要な拡張機能であり、このため新しいプリコンパイルが提案されています。その利点は以下の通りです:
    - 利用可能な曲線のセットが拡張されるため、ユーザーはセキュリティパラメータと必要な機能を選択できるようになります。
    - このプリコンパイルの一般的なアプローチにより、ユーザーは新しく発見された曲線や新しい構築を、新しいフォークを待つことなく実験できるようになります。
    - 楕円曲線算術は確かにこのプリコンパイルで再実装されますが、それは厳密に必要とされています。ほとんどのペアリングベースのプロトコルでは、標準的な EC の乗算や加算を実行する必要があり、したがってそのような操作が一般的な曲線セットで利用可能でなければなりません。
- ガス費用 - このEIPは、呼び出し中に可能な限り早期に操作の ガス費用を見積もり、指定されたパラメータとオペレーションの種類のみに基づいて決定することを目的としています。これは、トランザクションや操作を可能な限り早期に拒否できるようにするために、任意のプリコンパイルに必要な厳密な要件です。

この新しく提案されるプリコンパイルの機能は、[EIP-1829](./eip-1829.md)と以下の点で異なります:
- 曲線のベースフィールドとスカラーフィールドの任意長のモジュラスでの操作(上限まで)
- ペアリング操作の導入
- 可変パラメータ長のためのABIの違い

## 仕様

`block.number >= XXXXX`の場合、アドレス`[0x.., 0x.., ...]`の`10`個の新しいプリコンパイルを定義し、以下の機能を提供します。

- ベースフィールド上で定義された曲線上の点の加算
- ベースフィールド上で定義された曲線上の点のスカラー倍
- ベースフィールド上で定義された曲線上の`N`組の`(スカラー, 点)`の多重指数計算
- 2次または3次の基本フィールド拡張上で定義された曲線上の点の加算
- 2次または3次の基本フィールド拡張上で定義された曲線上の点のスカラー倍
- 2次または3次の基本フィールド拡張上で定義された曲線上の`N`組の`(スカラー, 点)`の多重指数計算
- `BLS12`ファミリーの曲線上でのペアリング演算
- `BN`ファミリーの曲線上でのペアリング演算
- `MNT4`ファミリーの曲線上でのペアリング演算
- `MNT6`ファミリーの曲線上でのペアリング演算

プリコンパイルの活発な開発と多くの進行中の変更があるため、[真実の源](https://github.com/matter-labs/eip1962/tree/master/documentation)は単一のものです。これには、バイナリインターフェース、ガススケジュール、既存の実装のためのインテグレーションガイドが含まれています。

### 可能な簡略化

提案された操作の実装、デバッグ、ガス費用の要因評価の複雑さが高いため、受け入れ時に曲線のセットを制限し、後で拡張することが適切かもしれません。別のアプローチ(技術的に可能な場合)は、コンセンサスの変更なしに(フォークなしに)更新できる "ホワイトリスト"コントラクトを持つことです。

限定されたセットの場合、以下のセットが最小限のものとして提案されます:
- 現在のEthereumバージョンのBN254曲線
- DIZK の BN 曲線 (2^32 の根を持つ)
- BLS12-381
- ZEXE の BLS12-377 (多数の根を持つ)
- 元の[論文](https://eprint.iacr.org/2014/595.pdf)のMNT4/6サイクル。セキュリティは高くありませんが、実験の自由を与えるかもしれません。
- Coda の MNT4/6 サイクル (パフォーマンスが許可する場合)
- BLS12-377の埋め込みを可能にし、BN曲線のいくつかを含む可能性のあるCP生成曲線のセット(BLS12-377のCPカーブの例はZEXEにあります)。

## 根拠

最も重要な設計上の決定のみを扱います:
- 曲線のスカラーフィールド(メイングループのサイズのmodulo)上の算術はありませんが、ガス見積もりの目的で必要です。
- 多重指数計算は大幅なコスト削減のために別の操作です
- 平方根操作の一般的なガス見積もりの不可能性のため、点の分解はありません。限られた "良い"ケースでは価格が大幅に異なるため、"最悪のケース"を指定するのは高価で非効率的であり、すでに複雑なガス費用の式にさらに複雑さを導入する価値はありません。

### このプリコンパイルとEIP 1109

機能上の厳密な要件はありませんが、EIP 1109が望ましい理由の例は以下の通りです:
- BLS12-381曲線、381ビットのモジュラス、255ビットのスカラーフィールド、EVMには固有の算術がない
- 点の加算には5000ns(かなり過大評価)
- 点の乗算には約150000ns
- 粗いガススケジュール ECRecover プリコンパイルの 15 Mgas/秒
- 点の加算には75ガス、`STATICCALL`がさらに700ガスを追加
- 点の乗算には2250ガス
- メモリ割り当ての費用(少なくとも`1 + 1 + 48 + 48 + 48 + 1 + 32 + 2*48 + 2*48 = 371 byte`、つまり約12の Ethereum "ワード")も36ガス(メモリ拡張の価格は無視できる)ほど追加する必要があります

これらの大まかな見積もりに基づくと、`STATICCALL`の価格が合計コストを支配する(加算の場合)か、大幅な オーバーヘッドをもたらす(乗算の場合)ことがわかります。

## 下位互換性

この変更は下位互換性がなく、ハードフォークによってアクティブ化する必要があります。

新しいプリコンパイル自体の機能は、EthereumやEVMの既存の機能に影響を与えません。

このプリコンパイルは、現在の`ECADD`、`ECMUL`およびペアリングチェックプリコンパイル(`0x06`、`0x07`、`0x08`)の完全な置き換えとなる可能性があります。

## テストケース
テストケースは以下のリンクにある実装の一部です。

## 実装
[ここ](https://github.com/matter-labs/eip1829)に進行中の実装努力があります。現在:
- ペアリング以外の操作が実装され、テストされています。
- BLS12ファミリーはBLS12-381とBLS12-377曲線で完成し、テストされています。
- BNファミリーはBN254曲線で完成し、テストされています。
- Cocks-Pinch法曲線はZEXEのk=6曲線でテストされています。

## 予備的ベンチマーク

benchmarksのcp6はBLS12-377を埋め込むCocks-Pinch法曲線です。マシン: Core i7, 2.9 GHz.

多重指数計算のベンチマークでは、`(ジェネレーター, ランダムスカラー)`の100組を入力として使用しています。同じ "ベース"のため、あまり代表的なベンチマークではない可能性があり、更新されます。

```
test pairings::bls12::tests::bench_bls12_381_pairing    ... bench:   2,348,317 ns/iter (+/- 605,340)
test pairings::cp::tests::bench_cp6_pairing             ... bench:  86,328,825 ns/iter (+/- 11,802,073)
test tests::bench_addition_bn254                        ... bench:         388 ns/iter (+/- 73)
test tests::bench_doubling_bn254                        ... bench:         187 ns/iter (+/- 4)
test tests::bench_field_inverse                         ... bench:       2,478 ns/iter (+/- 167)
test tests::bench_field_mont_inverse                    ... bench:       2,356 ns/iter (+/- 51)
test tests::bench_multiplication_bn254                  ... bench:      81,744 ns/iter (+/- 6,984)
test tests::bench_multiplication_bn254_into_affine      ... bench:      81,925 ns/iter (+/- 3,323)
test tests::bench_multiplication_bn254_into_affine_wnaf ... bench:      74,716 ns/iter (+/- 4,076)
test tests::bench_naive_multiexp_bn254                  ... bench:  10,659,911 ns/iter (+/- 559,790)
test tests::bench_peppinger_bn254                       ... bench:   2,678,743 ns/iter (+/- 148,914)
test tests::bench_wnaf_multiexp_bn254                   ... bench:   9,161,281 ns/iter (+/- 456,137)
```

## 著作権
著作権およびその関連権利は[CC0](../LICENSE.md)で放棄されています。