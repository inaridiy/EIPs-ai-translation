---
original: 7ea0605f35e518cac2d1f204d3e80ba36d02a4b42f1877cfa7eaf35ca8c29646
---

---
eip: 2327
title: BEGINDATAオペコード
author: Martin Lundfall (@MrChico)
discussions-to: https://ethereum-magicians.org/t/new-opcode-begindata/3727
status: 停滞
type: Standards Track
category: Core
created: 2019-10-28
---

## 簡単な要約
新しいオペコード `BEGINDATA` を導入し、コントラクトの残りのバイトをコントラクトコードではなくデータとして扱い、実行できないようにする。

## 概要
スマートコントラクトでは、コンストラクター引数、定数変数、コンパイラメタデータ、初期化フェーズ中のコントラクトランタイムなどを、効率的にコントラクトバイトコードに直接格納することが一般的です。現在、このようなデータはノーマルバイトコードと区別されず、EVM インタープリターによる `JUMPDEST` の分析の対象となっています。このEIPでは、バイト `0xb6` の新しいオペコード `BEGINDATA` を導入し、残りのバイトコードをデータとしてマークすることで、EVM インタープリター、静的解析ツール、チェーンエクスプローラーに対して、残りのバイトがオペコードを表していないことを示します。

## 動機
`BEGINDATA` オペコードは、以前 [EIP-615](./eip-615.md) の一部として「EVM のサブルーチンとスタティックジャンプ」の提案の中で示されていました。ここでは、コントラクトバイトコード内のジャンプテーブルの位置を特定する方法として提案されていました。本EIPでは、`JUMPDEST` 分析からデータを除外し、データにジャンプできないようにすることを目的として、独立した提案として導入されます。これにより、静的解析ツールによるコントラクト分析が容易になり、逆アセンブラ、チェーンエクスプローラー、デバッガーがデータを無効なオペコードの混乱として表示しなくて済むようになります。また、パフォーマンスの若干の向上も期待できます。さらに、他のチェーンからのトランザクションのオンチェーン評価の際に、コードがある特定のパターンに準拠しているかどうかを検証する必要がなくなるため、スケーラビリティの向上にもつながります(Optimism プロジェクトで使用されています)。また、[EIP-1712](https://github.com/ethereum/EIPs/pull/1712)のような提案、ジャンプテーブル[EIP-615](./eip-615.md)、スタック使用違反のあるコントラクトの展開を禁止するなどの投機的な提案の道を開くことにもなります。

## 仕様
コントラクトの有効な `JUMPDEST` を計算する際、最初の `BEGINDATA` に遭遇したら分析を中止します。つまり、`BEGINDATA` の位置以降のコードロケーションにジャンプすると、`BAD_JUMP_DESTINATION` エラーが発生します。
コントラクト実行中に `BEGINDATA` に遭遇した場合、`STOP` と同じセマンティクスを持ちます。ガス消費は0です。

`BEGINDATA` 以降のバイトは、`CODECOPY` と `EXTCODECOPY` で引き続きアクセス可能です。`BEGINDATA` は `CODESIZE` や `EXTCODESIZE` には影響しません。

## 根拠
バイト `0xb6` は [EIP-615](./eip-615.md) に合わせて選択されました。
`BEGINDATA` に遭遇した場合に `STOP` するという選択は多少恣意的です。代替案としては、ガス切れエラーで実行を中止することも考えられます。

## 下位互換性
本提案は、未使用のオペコードの使用に依存する現在の動作を変更しない限り、既存のコントラクトに影響を与えません。

コントラクトはデータを使い続けてきたので、すべてのコントラクトが何らかの未使用オペコードを使用していると言えます。ただし、実行時にスキップされ、ジャンプ越えされるようなデータを使用している必要があります。Solidityコンパイラはそのようなコードを生成したことはありません。他の手段で作成されたコントラクトにそのようなコード構造が存在するかどうかを評価する必要があります。

## テストケース
以下のテストケースを含める必要があります:
1) `BEGINDATA` オペコードよりも高いpcの値を持つ目的地 `X` にジャンプするコントラクト。`X` のバイトが `0x5b` の場合、`BAD_JUMP_DESTINATION` エラーが発生する必要があります。
2) `BEGINDATA` オペコードに遭遇するコントラクト(現在のコールフレームの実行を停止する必要がある)

## 実装
まだありません。

## 著作権
[CC0](../LICENSE.md)によりワイバーされた著作権およびそれに関連する権利。