---
original: c26c60c3c1434f5f0c23c3c60192bb58e7016271a6005696e0a11265f754edc9
---

---
eip: 2696
title: JavaScript `request` メソッドRPCトランスポート
author: Micah Zoltu (@MicahZoltu), Erik Marks (@rekmarks)
discussions-to: https://github.com/ethereum/EIPs/issues/2697
status: 最終版
type: 標準トラック
category: インターフェース
created: 2020-06-04
---

## 簡単な要約
Ethereumプロバイダーとイーサリアムクライアントの間でリモート手順呼び出しを行うための標準。両者がJavaScriptオブジェクトを介して相互に接続できる場合に適用される。

## 概要
この標準は、イーサリアムブロックチェーンとの通信に使用できるオブジェクトの仕様を定義する。ただし、有効なペイロードの内容や、クライアントとプロバイダーがペイロードの内容を発見・合意する方法については規定しない。

このイーサリアムオブジェクトがどのように、どこで公開されるかは、将来の標準に委ねられる。

## 動機
JavaScriptランタイム(NodeJS、Electron、ブラウザなど)で作業する際、ランタイムやランタイムプラグインがオブジェクトをランタイムに注入することがある。ランタイムの作成者やプラグインの作成者は、ランタイム内で実行されるJavaScriptアプリやスクリプトにイーサリアムプロバイダーを公開し、イーサリアムライクなブロックチェーンやサインツールへの間接アクセスを提供することができる。プロバイダーとクライアントの最大の互換性を実現するには、そのオブジェクトの形状に関する標準が必要である。

## 仕様

### RFC-2119

この文書の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「MAY」、「OPTIONAL」のキーワードは、[RFC-2119](https://www.ietf.org/rfc/rfc2119.txt)の定義に従って解釈されるものとする。

### インターフェース

TypeScriptインターフェース定義:
```ts
interface RequestArguments {
	readonly method: string;
	readonly params?: readonly unknown[] | object;
}

interface EthereumProvider {
	request(args: RequestArguments): Promise<unknown>
}
```
プロバイダーは、公開された`EthereumProvider`オブジェクトに`request`メソッドを実装しなければならない(`MUST`)。`request`メソッドは、上記のTypeScriptインターフェースで定義された引数を持つ単一のパラメーターで呼び出し可能でなければならない(`MUST`)。

プロバイダーがJSON-RPC(https://www.jsonrpc.org/specification)リクエストをサポートする場合、`RequestArguments.method`引数がJSON-RPCの`method`文字列と一致し、`RequestArguments.params`がRPCコールの`params`オブジェクトと一致するような`request`コールを受け付けなければならない(`MUST`)。`RequestArguments.params`は、通常のJSON-RPCトランスポートの場合のようにJSONの文字列としてではなく、指定されたJSON-RPCの型に合わせたJavaScriptオブジェクトとしてエンコーディングされるべきである。

#### 例
JSON-RPCリクエストのペイロードが以下の場合:
```typescript
'{ "jsonrpc": "2.0", "id": 1, "method": "do_work", "params": [ 5, "hello" ] }'
```
対応する`EthereumProvider.request`呼び出しは以下のようになる:
```typescript
declare const provider: EthereumProvider
provider.request({ method: 'method', params: [ 5, 'hello' ] })
```

### 結果
プロバイダーがJSON-RPCリクエストをサポートする場合、関連するJSON-RPCリクエストの期待される`result`定義と一致するオブジェクトを返さなければならない(`MUST`)。

#### 例
JSON-RPCレスポンスのペイロードが以下の場合:
```typescript
'{ "jsonrpc": "2.0", "id": 1, "result": { "color": "red", "value": 5 } }'
```
対応する`EthereumProvider.request`レスポンスは以下のようになる:
```typescript
{ color: 'red', value: 5 }
```

### エラー
```ts
interface ProviderRpcError extends Error {
	message: string;
	code: number;
	data?: unknown;
}
```

| コード | メッセージ            | 意味                                                                    |
| ----- | -------------------- | --------------------------------------------------------------------- |
| 4001 | ユーザーが要求を拒否した | ユーザーが要求を拒否した。                                                 |
| 4100 | 承認されていない        | 要求されたメソッドや口座がユーザーによって承認されていない。                     |
| 4200 | サポートされていないメソッド | プロバイダーが要求されたメソッドをサポートしていない。                        |
| 4900 | 切断された              | プロバイダーがすべてのチェーンから切断されている。                            |
| 4901 | チェーンが切断された      | プロバイダーが要求されたチェーンに接続されていない。                          |

プロバイダーがリクエストを何らかの理由で履行できない場合、プロミスをエラーとして解決しなければならない(`MUST`)。可能な限り、上記の`ProviderRpcError`の形式でエラーを解決しなければならない(`MUST`)。_JavaScriptアプリケーションが決して OutOfMemory や StackOverflow エラーを投げないことを保証することはできませんが、可能な限りプロミスの拒否がこの形式に準拠するよう注意を払うべきです。_

リストされているコード、JSON-RPCの仕様(https://www.jsonrpc.org/specification#error_object)、または従っているJSON-RPCリクエスト標準に定義されているコードが提供された場合、エラーの理由はそのコードの確立された意味に合わせ、`message`は提供された`message`と一致しなければならない(`MUST`)。

`data`フィールドには、エラーに関連する任意のデータ、またはユーザーがエラーを理解したり修正したりするのに役立つデータを含めてもよい(`MAY`)。

## 根拠
この標準は、アプリケーションとブロックチェーン間の通信メカニズムとしては最適ではないかもしれませんが、コミュニティ内の確立された慣行に密接に沿っているため、既存のシステムからこのシステムへの移行は比較的簡単です。現在の大部分の通信はJSON-RPCで行われているため、既存のシステムとの迅速な統合を可能にするためにJSON-RPCの標準に合わせることが望ましかった。

## セキュリティ上の考慮事項
イーサリアムプロバイダーとクライアントの関係は信頼関係であり、ユーザーがイーサリアムプロバイダーを暗黙的に信頼していることが前提となっている。これは、プロバイダーがクライアントに注入されたか、クライアントが明示的にそれへの接続を取得したことを意味する。

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。