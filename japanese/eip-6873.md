---
original: 09465b0ddcc4fb30b58a21ae25cf22cd282296529b6d7b89ba88d5e92e36dbee
---

---
eip: 6873
title: プリイメージの保持
description: 実行クライアントは、フォークの前から verge までの間にアクセスされたアドレスとスロットのプリイメージを保持する必要があります。
author: Guillaume Ballet (@gballet)
discussions-to: https://ethereum-magicians.org/t/eip-6873-preimage-retention-in-the-fork-preceding-the-verge/15830
status: 停滞
type: Standards Track
category: Core
created: 2023-04-14
---

## 概要

ネットワーク上の各ノードがフォークの前から verge までの間にプリイメージを収集することを義務付けます。これは、各ノードが自身の変換を担当する必要がある場合に必要です。

## 仕様

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"NOT RECOMMENDED"、"MAY"、"OPTIONAL" というキーワードは、RFC 2119 およびRFC 8174 に記載されているように解釈されるものとします。

`T_p` をvergeの前のフォークのタイムスタンプ、`T_v` をvergeのタイムスタンプとします。

 * ELクライアントは、`T_p` から `T_v` の間に生成されたすべてのブロックの実行中に生成されたアドレスとスロットのハッシュのプリイメージを保存しなければなりません (MUST)。

 * ELクライアントは、この期間外のプリイメージの保存を開始してもよい (MAY)。

 * `T_p` から `T_v` の間に生成されたハッシュについて、ELクライアントはそのプリイメージをデータベースに持っていることを示すべきです (SHOULD)。

 * ELクライアントは、公開されているデータストアから `T_v` 以前に生成されたアドレスとスロットのハッシュのプリイメージをダウンロードできるようにすべきです (SHOULD)。

## 根拠

Verkle ツリーに切り替えるには、すべてのツリーキーを完全に再ハッシュする必要があります。ほとんどの実行クライアントは、プリイメージなしでキーをハッシュして保存しており、現時点ではメインネットで70GBを占めています。これらのプリイメージを誰もが利用できるようにするには、次のような対処方法があります:

 * プリイメージ保持を有効にして完全同期を再開する
 * プリイメージをファイルとしてダウンロードする

後者の方法が実用的です。完全同期を行うと、同期マシンがオフラインになる期間が数日間にもなるため、ネットワーク全体に同時に課すことはできません。一方、ファイルのダウンロードでは、新しいプリイメージが即座に追加される必要があるため、データの陳腐化が問題となります。プリイメージファイルを更新するだけでは不十分で、70GBを超えるデータをスロット時間以内にダウンロードするのは困難です。

Verkle への移行時期に、すべてのプリイメージを適時に利用可能にするために、各ノードはVergeの前のフォークからVergeまでの間にプリイメージのリストを更新する責任があります。

## 下位互換性

下位互換性の問題はありません。

<!--

## テストケース

TODO

-->

## 参考実装

すべてのクライアントは、少なくともオプションとしてプリイメージの保持を実装しています。

## セキュリティ上の考慮事項

要検討。 <!-- TODO -->

## 著作権

[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。