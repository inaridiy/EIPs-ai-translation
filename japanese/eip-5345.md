---
original: 224b3a0dc455bd9b380d7982d94f15fe42ca76016c73c4e84f8912036358e9cf
---

---
eip: 5345
title: JSON-RPC用サイレント署名拡張機能
description: ユーザーの操作なしでの一時的なトランザクション署名
author: Stanley Wu (@fruit37)、Mücahit Büyükyılmaz (@anndro)、Muhammed Emin Aydın (@muhammedea)
discussions-to: https://ethereum-magicians.org/t/walletconnect-silent-signing-extension/10137
status: 停滞
type: Standards Track
category: Interface
created: 2022-07-26
---

## 概要

多くのトランザクションを処理するモバイルアプリケーションでは、ウォレットとアプリケーションのUIを行き来することで、ユーザーエクスペリエンスが悪化する可能性があります。この提案では、ユーザーの参加なしにウォレットのトランザクションに署名して送信する手段を導入します。この機能は、ユーザーが特定の期間の使用を許可することで実装できます。この機能を「サイレント署名」と呼びます。

## 動機

一部のブロックチェーンアプリケーションは、他のアプリケーションよりもはるかに頻繁にブロックチェーンと対話します。特にゲームアプリケーションでは、独自のサイドチェーンを持つことが多いです。ゲームの進行を中断してウォレットに切り替えてトランザクションを実行すると、ユーザーエクスペリエンスに大きな影響を与えます。

## 仕様

この問題を解決するために、ethereum JSON-RPCの新しいRPCメソッドを導入します。これらのメソッドを使うことで、ウォレットがサイレント署名機能を実装できるようになります。

### サイレント署名のユーザーフロー

サイレント署名プロセスは以下の構造になっています:

1. まず、アプリケーションがRPCの`wallet_requestSilentSign`メソッドを使ってウォレットにサイレント署名を要求します。
2. 次に、ウォレットがユーザーにサイレント署名機能を有効化する期間を確認するよう促します。
3. ユーザーがサイレント署名を確認しないか、RPCメソッドが許可されていない場合、アプリケーションは通常のメソッドを使い続けます。
4. ユーザーがサイレント署名を確認すると、その期間中の各トランザクションは`wallet_silentSendTransaction`メソッドを使って送信されます。

### 実装

この実装では、アプリケーションとウォレット側の新しいRPCメソッドとフローを導入します。

### 新しいRPCメソッド

#### `wallet_requestSilentSign`

このRPCメソッドはウォレットを開き、ユーザーに特定の期間の自動署名を有効化するよう促します。この関数により、指定された期間中にアプリケーションが以下のメソッドを呼び出すことができます。`eth_signTrancaction`などの標準メソッドは変更されません。

```shell
パラメーター
  Object: リクエストオブジェクト
    until: NUMBER - 許可が有効になる期限のUnixタイムスタンプ
    chainId: NUMBER - コントラクトが存在するチェーンID
    contractAddress: ADDRESS - 許可されるコントラクトのアドレス
    allowedFunctions: STRING ARRAY - 許可される関数シグネチャ
          例: ["equip(address,uint256)", "unequip(address,uint256)"]
    description: STRING - ユーザーにウォレットが表示できる追加の説明

戻り値
  DATA, 20 Bytes: permissionSecret - サイレント署名リクエストに使用する秘密鍵(ランダムに生成)
```

#### `wallet_silentSignTransaction`

このRPCメソッドはトランザクションを作成し、その data をウォレットに送信して署名します。ウォレットはユーザーの操作を妨げることなく、バックグラウンドでデータに署名します。その後、アプリケーションはNethereum等のライブラリを使って署名済みのトランザクションをブロックチェーンに送信します。

```shell
パラメーター
  DATA, 20 Bytes: permissionSecret - `wallet_requestSilentSign`メソッドで取得した秘密鍵
  Object - トランザクションオブジェクト
    from: DATA, 20 Bytes - トランザクションの送信元アドレス
    to: DATA, 20 Bytes - (新しいコントラクト作成時は省略可能) トランザクションの送信先アドレス
    gas: QUANTITY - (省略可、デフォルト: 90000) トランザクション実行に必要なガス量。未使用ガスは返金されます。
    gasPrice: QUANTITY - (省略可、デフォルト: 未定) 1ガスあたりのガス代(Wei単位)
    value: QUANTITY - (省略可) トランザクションと共に送信されるイーサの量(Wei単位)
    data: DATA - コントラクトのコンパイルされたコードまたは呼び出されるメソッドのシグネチャとエンコードされたパラメーター
    nonce: QUANTITY - (省略可) nonce値。同じnonceを使う保留中のトランザクションを上書きできます。
  
戻り値
  DATA, 署名済みのトランザクションオブジェクト
```

#### `wallet_silentSendTransaction`

このRPCメソッドはトランザクションを作成し、ユーザーの操作を妨げることなくブロックチェーンに送信します。

```shell
パラメーター
  DATA, 20 Bytes: permissionSecret - `wallet_requestSilentSign`メソッドで取得した秘密鍵
  Object - トランザクションオブジェクト
    from: DATA, 20 Bytes - トランザクションの送信元アドレス
    to: DATA, 20 Bytes - (新しいコントラクト作成時は省略可能) トランザクションの送信先アドレス
    gas: QUANTITY - (省略可、デフォルト: 90000) トランザクション実行に必要なガス量
    gasPrice: QUANTITY - (省略可、デフォルト: 未定) 1ガスあたりのガス代
    value: QUANTITY - (省略可) トランザクションと共に送信されるイーサの量
    data: DATA - コントラクトのコンパイルされたコードまたは呼び出されるメソッドのシグネチャとエンコードされたパラメーター
    nonce: QUANTITY - (省略可) nonce値。同じnonceを使う保留中のトランザクションを上書きできます。

戻り値
  DATA, 32 Bytes - トランザクションハッシュ。まだ利用可能でない場合はゼロハッシュ。
```

### アプリケーションとウォレットの通信

アプリケーションとウォレット間のRPCリクエストの送信は通常通りです。例えばブラウザ拡張ウォレットはこれらの新しいメソッドを簡単に使えます。ハードウェアウォレットでも実装できます。ただし、モバイルウォレットの場合は、追加の通信手段を検討する必要があります。モバイルウォレットは使用していないときにアクティブではないためです。

モバイルウォレットはほとんどWalletConnectプロトコルを使用しています。アプリケーションが閉じているか、バックグラウンドで動作している場合、WebSocketを使ってブリッジサーバーに接続できません。そのため、ウォレットにプッシュ通知を送信して、ブリッジに接続し、リクエストの待機を開始するよう促す必要があります。つまり、プッシュ通知をサポートするウォレットのみがこの機能を実装できます。

![](../assets/eip-5345/walletconnect-flow.png)

ウォレットがプッシュ通知を受信すると、ブリッジサーバーに接続し、保留中のリクエストにアクセスします。`wallet_silenSignTransaction`または`wallet_silentSendTransaction`のサイレント署名リクエストがある場合で、その期間の依頼クライアントとの対話が確認されていれば、ウォレットはユーザーの操作を妨げることなくリクエストを実行します。

## 根拠

ゲームやメタバースアプリケーションでは、ユーザーがウォレットと対話し、それに切り替えてトランザクションを承認する場合が多くあります。この切り替え操作はゲームそのものに干渉し、ユーザーエクスペリエンスを損なう可能性があります。そのため、ウォレットがサイレント署名機能をサポートし、ユーザーの操作なしにトランザクションに署名できるようになれば、このようなアプリケーションに大きな利点があります。

## 下位互換性

新しいRPCメソッドは現在のメソッドと干渉せず、モバイルウォレットではプッシュ通知APIが現在`WalletConnect`仕様の一部となっています。この提案の機能を実装しても、他のアプリケーションやウォレットには影響しません。

## セキュリティ上の考慮事項

提案された機能はユーザーエクスペリエンスの向上を目的としており、ユーザーの同意があれば有効化できます。ユーザーは通常どおりアプリケーションを使うことができます。

サイレント署名の許可には制限があり、より安全になっています。
* 許可は指定された期間のみ有効
* 特定のチェーンの特定のコントラクトと、指定された関数のみに許可が与えられる

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。