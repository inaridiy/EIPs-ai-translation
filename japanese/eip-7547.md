---
original: 6e8cca8ff30daf0d53fc9b27d6b3ec0a73a5d5c17a3d999ee8371ca11aba9fb4
---

---
eip: 7547
title: インクルージョンリスト
description: トランザクションの強制的なインクルージョンを可能にするインクルージョンリストメカニズムを追加する。
author: mike (@michaelneuder), Vitalik (@vbuterin), Francesco (@fradamt), Terence (@terencechain), potuz (@potuz), Manav (@manav2401)
discussions-to: https://ethereum-magicians.org/t/eip-7547-inclusion-lists/17474
status: レビュー中
type: Standards Track
category: Core
created: 2023-10-24
---
## 概要

検閲耐性はブロックチェーンの中心的な価値提案です。インクルージョンリストは、提案者が後続のブロックを有効とみなすために迅速にインクルージョンされるべきトランザクションのセットを指定できるようにすることで、Ethereumの検閲耐性を向上させるメカニズムを提供することを目的としています。

## 動機

マージ以降、バリデーターはほとんどすべてのブロック生成を専門のビルダーに外注するようになりました。これは一般的に「提案者-ビルダー分離」と呼ばれています。2023年10月時点で、ブロックの95%近くがビルダーではなく提案者によって構築されています。 `mev-boost`エコシステムを通じてすべての提案者が競争力のあるブロックにアクセスできるのは素晴らしいことですが、外部ビルダーによって構築されたブロックの大きな欠点は、ビルダーが最終的にどのトランザクションをインクルージョンするかを決定することです。強制的なトランザクションインクルージョンメカニズムがない場合、提案者は難しい選択を迫られます。つまり、トランザクションのインクルージョンについて発言権がないか、ローカルでブロックを構築して (最終的にはトランザクションの選択権を持つ) MEV報酬を犠牲にするかのどちらかです。

インクルージョンリストは、提案者にある程度の権限を維持する仕組みを提供することで、この問題に取り組むことを目的としています。最も単純な設計は、`スロットN`の提案者が、自分のスロットで生成されるブロックに必ずインクルージョンされるべきトランザクションのリストを指定することです。ただし、これは インセンティブ整合的ではありません。なぜなら、ビルダーは提案者が彼らの行動に一定の制約を課した場合、ブロックの構築を拒否する可能性があるためです。これは「前方」インクルージョンリストというアイデアにつながります。ここでは、`スロットN`の提案者が指定したトランザクションが`スロットN+1`のブロックで強制的にインクルージョンされます。前方インクルージョンリストの単純な実装には、無料のデータ可用性を露出させる可能性があり、これを悪用してチェーンのサイズを肥大化させることなく支払うガス代を回避できるという問題があります。この無料のデータ可用性の問題は、ノンス再利用に関する観察と、各スロットに複数のインクルージョンリストを指定できるようにすることで解決されます。インセンティブ整合性と無料のデータ可用性の問題に対処できたので、インクルージョンリストの実装をより安全に進めることができます。

## 仕様

### 定数

| 名称 | 値 |
| - | - |
| `MAX_TRANSACTIONS_PER_INCLUSION_LIST` | `2**4 = 16` |
| `MAX_GAS_PER_INCLUSION_LIST` | `2**21` |
| `MIN_SLOTS_FOR_INCLUSION_LIST_REQUEST` | `1` |

#### 参照オブジェクト

```
class InclusionListSummaryEntry(Container):
    address: ExecutionAddress
    gas_limit: uint64
```

```
class InclusionListSummary(Container)
    slot: Slot
    proposer_index: ValidatorIndex
    summary: List[InclusionListSummaryEntry, MAX_TRANSACTIONS_PER_INCLUSION_LIST]
```

```
class SignedInclusionListSummary(Container):
    message: InclusionListSummary
    signature: BLSSignature
```

```
class InclusionList(Container)
    summary: SignedInclusionListSummary
    transactions: List[Transaction, MAX_TRANSACTIONS_PER_INCLUSION_LIST]
```

```
class ExecutionPayload(Container):
    ...
    inclusion_list_summary: List[InclusionListSummaryEntry, MAX_TRANSACTIONS_PER_INCLUSION_LIST]
    inclusion_list_exclusions: List[uint64, MAX_TRANSACTIONS_PER_INCLUSION_LIST]
```

```
class ExecutionPayloadHeader(Container):
    ...
    inclusion_list_summary_root: Root
    inclusion_list_exclusions_root: Root
```

```
class BeaconBlockBody(Container):
    ...
    inclusion_list_summary: SignedInclusionListSummary
```

### コンセンサスレイヤー

#### 概要

**`スロットN`の提案:**

- 提案者は`スロットN+1`用のブロックと、インクルージョンリスト (サマリーとトランザクションオブジェクト) を配信します。
- トランザクションは`スロットN`または`スロットN+1`にインクルージョンされます。
- サマリーには、トランザクションの発信元アドレスとそれぞれのガス制限が含まれています。
- サマリーは署名されていますが、トランザクションには署名がありません。

**`スロットN`の検証:**

- バリデーターは、そのスロットに少なくとも1つのインクルージョンリストを確認した場合にのみ、ブロックの検証とフォークチョイスを行います。
- インクルージョンリストのトランザクションが`スロットN`の開始時に実行可能でない場合、または`maxFeePerGas`が現在のスロットから12.5%以上高くない場合は、ブロックを無効とみなします。

**`スロットN+1`の検証:**

- `スロットN+1`の提案者は、`スロットN`の提案者から署名されたサマリーとともにブロックを構築します。
- ペイロードには、`スロットN`ペイロードの中から署名付きインクルージョンリストサマリーに合致するトランザクションインデックスのリストが含まれています。
- ペイロードは以下の条件を満たす場合に有効とみなされます。(a) 実行条件が満たされている (インクルージョンリストサマリーを満たし、実行レイヤーの観点から実行可能である)、(b) コンセンサス条件が満たされている (前のブロックの提案者署名がある)。

#### 具体的な変更点

**ビーコンチェーンステートトランジション仕様:**

- ***新規** `inclusion_list`オブジェクト:* 提案者が送信し、ノードが処理する新しい`inclusion_list`を導入。
- ***変更** `ExecutionPayload`と`ExecutionPayloadHeader`オブジェクト:* インクルージョンリストの要件に合わせて更新。
- ***変更** `BeaconBlockBody`:* インクルージョンリストサマリーをキャッシュするように変更。
- ***変更** `process_execution_payload`関数:* インクルージョンリストサマリーの充足性チェックを含めるように更新。

**ビーコンチェーンフォークチョイス仕様:**

- ***新規** `is_inclusion_list_available`チェック:* インクルージョンリストが可視範囲内にあるかどうかを判断する新しいチェックを導入。
- ***新規** 通知アクション:* 新しいインクルージョンリストについて実行レイヤー (EL) クライアントに通知する新しい呼び出しを実装。ELクライアントがインクルージョンリストを無効と判断した場合、対応するブロックは無効とみなされる。

**ビーコンチェーンP2Pプロトコル仕様:**

- ***新規** インクルージョンリストのgossipnetとバリデーションルール:* インクルージョンリストのgossipネットワークとバリデーションのための新しいルールを定義。
- ***新規** インクルージョンリストのRPCリクエストとレスポンスネットワーク:* インクルージョンリストの送受信用の新しいネットワークを確立。

**バリデーター仕様:**

- ***新規** `inclusion_list`の義務:* 提案者がインクルージョンリストを準備し、署名する。
- ***変更** `BeaconBlockBody`の義務:* `inclusion_list_summary`を含むようにビーコンブロックボディの義務を更新。

### 実行レイヤー

- ***新規** `get_inclusion_list`:* 提案者がインクルージョンリストを取得する新しい関数を導入。
- ***新規** `new_inclusion_list`:* ノードがインクルージョンリストの実行側の検証を行う新しい関数を定義。
- ***変更** `forkchoice_updated`:* 属性にインクルージョンリストサマリーを含めるように関数を更新。
- ***変更** `new_payload`:* `payload_transactions`が`payload.inclusion_list_summary`と`payload.inclusion_list_exclusions`を満たすことを確認するように関数を更新。
- ***新規** 検証ルール:* 実行APIの変更に基づいて新しい検証ルールを実装。

## 根拠

このEIPにいくつかの設計上の決定点があります。

1. `ReducedSummary`対`Summary`
    - 元の提案では、`ReducedSummary`と`Rebuilder`を使ってデータ効率を改善しようとしています。これにより、完全なサマリーを再構築できます。
    - これはかなり複雑な仕様になるので、この初期バージョンでは通常の`Summary`を使い、後続のブロックに含めることを検討すべきです。
3. ガス制限の有無
    - インクルージョンリストにガス制限を設けるか、ブロックのガス制限を使うかを検討する必要があります。
    - 別のガス制限を設けると複雑さが簡略化されますが、バリデーターがインクルージョンリストの構築を外注して副次的な支払いを受けられるようになるというリスクがあります (例えば、ブロックがいっぱいの場合、提案者は後続のブロックでの確実なインクルージョンのためにインクルージョンリストのスペースを競売に掛けることができます)。
    - 代替案として、インクルージョンリストをブロックのガス制限の一部とし、ブロックのガス制限が満杯でない場合にのみ満たされるようにすることも考えられます。ただし、これにより次のブロック提案者がわざとブロックを埋めてインクルージョンリストを無視する可能性があります (ガスを無駄に消費するというコストを払う必要がありますが)。
4. インクルージョンリストの順序
    - `スロットN`ブロックの先頭でインクルージョンリストが処理されると想定しています。インクルージョンリストのトランザクションは`スロットN`の事前ステートで評価されますが、`スロットN+1`でのみインクルージョンが保証されます。
3. インクルージョンリストのトランザクション除外
    - `スロットN`で提案されたインクルージョンリストのトランザクションは、同じスロットでも (例えば`ExecutionPayload`にインクルージョンされることで) 満たされる可能性があります。これは、バリデーターが`mev-boost`を使っているため、提案するブロックの内容を知らないためです。
    - このため、除外フィールドが存在します。ノードは、ペイロードの`inclusion_list_exclusion`フィールドの各トランザクションを見て、現在のインクルージョンリストと一致するかどうかを確認します。一致する場合は、そのトランザクションをインクルージョンリストサマリーから削除します。
4. `mev-boost`との互換性
    - `mev-boost`への大きな変更はありません。他のハードフォークと同様に、`mev-boost`、リレー、ビルダーはビーコンノードを調整する必要があります。
    - ビルダーは、インクルージョンリストサマリーを満たさない実行ペイロードが無効になることを知る必要があります。
    - リレーには、署名の前にそのような制約を検証する追加の義務があるかもしれません。
    - ヘッダーを受信する際、バリデーターは`inclusion_list_summary_root`がローカルのバージョンと一致するかどうかを確認し、一致しない場合はローカルのブロックを使ってブロックを構築することができます。
5. 範囲またはルートによる同期
    - ブロックを有効とみなすには、最新のヘッドに同期するノードにもインクルージョンリストが必要です。
    - インクルージョンリストのないブロックは、同期
中に処理できません。
    - これに対処するため、`MIN_SLOTS_FOR_INCLUSION_LIST_REQUEST`という パラメーターがあります。ブロックのスロットにこのパラメーターを加えた値が現在のスロットより低い場合、ノードはインクルージョンリストのチェックをスキップできます。
    - これは[EIP-4844](./eip-4844.md)と似ており、ブロブサイドカーのデータ可用性チェックを保持期間外であれば省略できます。

## 下位互換性

このEIPは、コンセンサスレイヤーのブロック検証ルールセットに下位互換性のない変更を導入し、ハードフォークを伴う必要があります。これらの変更は、現在のユーザーアクティビティや体験に関して何も壊すものではありません。

## セキュリティ上の考慮事項

主な潜在的な問題は、インクルージョンリストのインセンティブ化に関するものです。`スロットN`の提案者が、`スロットN+1`の提案者の報酬に悪影響を及ぼすインクルージョンリストを構築した場合、`スロットN+1`の提案者は`スロットN`の提案者に空のリストを公開するよう賄賂を贈る可能性があります。これはプロトコルに対する直接的な攻撃ではなく、むしろインクルージョンリストが活用されないようにする利益共有メカニズムです。検閲耐性スキームがどうあれ、これらのコミットメントゲームが行われる可能性はありますが、これは現在も活発に研究されている分野です。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。