---
original: 979989322547cd2dafed78909448652b454e89560364fcda43b283a5ea4e635a
---

---
eip: 5003
title: EOAにコードを挿入するAUTHUSURP
description: ECDSAから移行するために、外部所有アカウントの場所にコードを展開することを可能にする。
author: Dan Finlay (@danfinlay), Sam Wilson (@SamWilsn)
discussions-to: https://ethereum-magicians.org/t/eip-5003-auth-usurp-publishing-code-at-an-eoa-address/8979
status: 停滞
type: Standards Track
category: Core
created: 2022-03-26
requires: 3074, 3607
---

## 概要

このEIPは、`AUTHUSURP`と呼ばれる新しいオペコードを導入します。これは、[EIP-3074](./eip-3074.md)で承認されたアドレスにコードを展開します。外部所有アカウント(EOA)と[EIP-3607](./eip-3607.md)を組み合わせることで、元の署名キーの権限が事実上取り消されます。

## 動機

EOAは現在、Ethereumブロックチェーン上で多くのユーザー管理の価値を保持していますが、プロトコルによって様々な重要な点で制限されています。これらのアカウントは、セキュリティのためのキーの回転、ガス代を節約するためのバッチ処理、自分でイーサを保持する必要がないスポンサー付きのトランザクションをサポートしていません。コントラクトアカウントやアカウントアブストラクションを持つことで得られる無数の利点があります。認証アルゴリズムの選択、支出限度の設定、ソーシャルリカバリーの有効化、キーの回転、機能の任意かつ推移的な委任、そしてあらゆることが可能になります。

新しいユーザーはスマートコントラクトウォレットを使ってこれらの利点にアクセスできますし、新しいコントラクトは[EIP-4337](./eip-4337.md)のような最近の標準を採用してアプリケーション層のアカウントアブストラクションを可能にすることができます。しかし、これらでは現在のEthereumユーザーの大多数のアカウントを無視してしまいます。これらのユーザーは今日存在しており、彼らのセキュリティ目標を達成するための道筋も必要とされています。

これらの追加の利点の多くは、EIP-3074自体とともに得られるものですが、1つの重大な欠点があります。元の署名キーが最終的な権限を持っているということです。EOAが自身の権限を何らかの_追加の_コントラクトに委任することはできますが、その鍵自体は残り続け、攻撃の対象となり続けます。つまり、EIP-3074は権限を追加の主体に付与することはできますが、取り消すことはできません。

今日のEOAには、自分のキーを回転させる選択肢がありません。フィッシングや偶発的なアクセスによって漏洩した秘密鍵は取り消すことができません。鍵のセキュリティに懸念のある慎重なユーザーは新しい秘密復元フレーズに移行することができますが、最良の場合でも資産ごとにトランザクションが必要で非常に高価になり、最悪の場合、スマートコントラクト内の所有者のようなある種の権限は全く移転できないかもしれません。

EOAは理想的なユーザー体験やセキュリティを提供できないことがわかっており、コミュニティ内にはコントラクトベースのアカウントへの移行を望む声があります。しかし、その移行が今日のEOAユーザーの大多数を顧みずに設計されると、この2つのユーザーベースをサポートし続けなければならず、常に苦労することになります。このEIPは、EOAを永続化するのではなく、それらから最終的に移行する道筋を提供します。

この提案は[EIP-3074](./eip-3074.md)と組み合わせて非常によく機能しますが、それとは区別されます。EIP-3074は、任意のEOAが署名権限を任意のスマートコントラクトに委任できるようにするオペコードを提供します。EOAは自身の権限を放棄することなく、コントラクトアカウントに代わりに行動することを許可できます。一方、このEIPは、EOAの元の署名キーからの最終的な移行経路を提供します。

## 仕様

この文書の中の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119に記載されているように解釈されるものとします。

### 規約

- **`top - N`** - EVMスタックで最後から`N`番目に押されている値で、`top - 0`が最も最近のものです。
- **無効な実行** - 無効で、現在の実行フレームを即座に終了し、残りのガスを全て消費しなければならない実行(スタックアンダーフローや無効なジャンプと同じように)。
- **空のアカウント** - そのバランスが0、ノンスが0、コードがないアカウント。

### `AUTHUSURP` (`0xf8`)

新しいオペコード `AUTHUSURP` が `0xf8` に作成されます。2つのスタック要素を取り、1つのスタック要素を返します。

#### 入力

| スタック   | 値         |
| --------- | ---------- |
| `top - 0` | `offset`   |
| `top - 1` | `length`   |

#### 出力

| スタック    | 値        |
| ---------- | --------- |
| `top - 0`  | `address` |

#### 動作

`AUTHUSURP`は`CREATE` (`0xf0`)と同じ動作をしますが、以下の点が異なります:

- `authorized`(EIP-3074で定義)が設定されていない場合、実行は無効になります。
- `authorized`が空のアカウントを指している場合、`static_gas`は32,000のままです。それ以外の場合、`static_gas`は7,000になります。
- `AUTHUSURP`は`authorized`アカウントのノンスをチェックしません。
- イニットコードは`authorized`アドレスで実行されます。
- イニットコードが何もバイトを返さない場合、その実行フレームはリバートされ、`AUTHUSURP`はゼロを返します。
- イニットコードの実行後、ただし返されたコードがデプロイされる前に、アカウントのコードが空でない場合、イニットコードの実行フレームはリバートされ、`AUTHUSURP`はゼロを返します。
- コードは`authorized`アドレスにデプロイされます。

## 根拠

`AUTHUSURP`は`authorized`アカウントのノンスをチェックしないのは、以前にトランザクションを送信したアカウントでも機能する必要があるためです。

`AUTHUSURP`を使用する際、イニットコードがゼロ長のコントラクトをデプロイした場合、後でも`AUTHUSURP`を使用できないようにする方法がありません。

イニットコードが同じアドレスで`AUTHUSURP`しようとする状況を捕捉するために、コードをデプロイする直前にアカウントのコードをチェックする必要があります。他の展開命令ではアカウントのノンスをインクリメントしてチェックするため、この対策は不要です。

## 下位互換性

EIP-3607と組み合わせた`AUTHUSURP`は、アカウントからトランザクションを送信する権限を元のECDSA署名から取り消します。これは完全に新しい動作ですが、`CREATE2`オペコードとある程度似ています。

## セキュリティ上の考慮事項

トランザクション以外でECDSA署名を使用するコントラクトは、乗っ取られたアカウントがもはずプライベートキーによって制御されていないことを認識しません。つまり、たとえばプライベートキーは常に`permit`関数にアクセスできます。これは`ecrecover`プリコンパイルドコントラクトを変更することで軽減できます。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。