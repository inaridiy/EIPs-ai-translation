---
original: f2f4265d87430c90fd5e6bacc736a0429979019d2814a97cb5cfe9c07d950127
---

---
eip: 2014
title: 拡張状態オラクル
author: Alex Beregszaszi (@axic)
discussions-to: https://ethereum-magicians.org/t/eip-2014-extended-state-oracle/3301
status: 停滞
type: Standards Track
category: Core
created: 2019-05-10
requires: 140
---

## 簡単な要約

## 概要

[Contract ABI Encoding] に従って拡張可能なインターフェースを持つ新しいシステムコントラクトを導入し、チェーン識別子、ブロックハッシュなどの拡張データセットにアクセスできるようにする。

これにより、Ethereumコントラクト言語がこのコントラクトを通常のコントラクトのように扱え、言語サポートを必要としないようになる。

## 動機

過去数年間、EMVにより多くのデータを追加する提案がいくつかなされてきました。例には[EIP-210]によるブロックハッシュへの拡張アクセスや[EIP-1344]によるチェーン識別子などがあります。

これらをEVMオペコードとして追加するのは、比較的使用頻度の低い機能に稀少なオペコードスペースを使用することになるため、プリコンパイルとして追加するのは、各ケースについてインターフェースを定義し合意する必要があるため、より複雑だと考えられています。

この提案では、拡張可能な標準インターフェースを定義することで、これらの問題を解決しようとしています。

## 仕様

新しいシステムコントラクト("プリコンパイル")が`0x0000000000000000000000000000000000000009`のアドレスに導入され、ESO (Extended State Oracle) と呼ばれます。

`CALL`または`STATICCALL`を使用して照会でき、入出力には[Contract ABI Encoding]に従います。複雑さを低く保つため、ABIエンコーディングでは基本的な型の使用が推奨されます。

将来的には、[EIP-210]が提案したのと同様に、ESO に状態を持たせ、システムアドレスからトランザクションを受け付けて渡されたデータを保存することも可能になるかもしれません。

ブロックやトランザクションの一部ではない状態データを追加したい提案は、ESO の拡張を目指すべきです。

現時点では、ESO をプリコンパイルとして含め、実装の詳細をクライアントに任せることが提案されています。
十分に拡張され、状態を持つ必要が生じた場合は、プリコンパイルから実際のコードを持つコントラクトに移行するのが適切でしょう。

### チェーン識別子

最初に、現在のチェーン識別子を読み取る機能 `getCurrentChainId()` が導入されます。これは `uint64` でエンコードされた値を返します。
[EIP-140]に記載されているように、これは非支払い関数であり、任意の値を送信するとトランザクションが巻き戻されます。
これは[EIP-1344]として提案されています。

コントラクトABIのJSONは以下の通りです:
```json
[
    {
	"constant": true,
	"inputs": [],
	"name": "getCurrentChainId",
	"outputs": [
	    {
		"name": "",
		"type": "uint64"
	    }
	],
	"payable": false,
	"stateMutability": "pure",
	"type": "function"
    }
]
```

これにより、バイト列 `5cf0e8a4` をESO に送信し、Ethereumメインネットの場合は `0000000000000000000000000000000000000000000000000000000000000001` というバイト列が返されます。

**注意:** チェーン履歴または特定のブロックに対するチェーン識別子の有効性をチェックするインターフェースを導入することも可能です (参照: [EIP-1959] および [EIP-1965])。

## 根拠

TBA

## 下位互換性

TBA

## テストケース

TBA

## 実装

TBA

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。

[Contract ABI Encoding]: https://solidity.readthedocs.io/en/latest/abi-spec.html
[EIP-140]: ./eip-140.md
[EIP-210]: ./eip-210.md
[EIP-1344]: ./eip-1344.md
[EIP-1959]: https://github.com/ethereum/EIPs/pull/1959
[EIP-1965]: https://github.com/ethereum/EIPs/pull/1965