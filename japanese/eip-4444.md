---
original: 4ce77a46ed1925cfc842f7c24ceb833f08c325cf299037536adc5d4e0c677d5e
---

---
eip: 4444
title: 実行クライアントの過去のデータの制限
description: 1年以上前のデータをクライアントからプルーンする
author: George Kadianakis (@asn-d6), lightclient (@lightclient), Alex Stokes (@ralexstokes)
discussions-to: https://ethereum-magicians.org/t/eip-4444-bound-historical-data-in-execution-clients/7450
status: 停滞
type: Standards Track
category: Networking
created: 2021-11-02
---

## 概要

クライアントは1年以上前のヘッダー、ボディ、レシートをp2pレイヤーで提供しなくなります。クライアントはこれらの過去のデータをローカルでプルーンできます。

## 動機

現在、過去のブロックとレシートは400GBを超えるディスク容量を占めています(そしてまだ増え続けています)。したがって、チェーンを検証するためには、ユーザーは通常1TBのディスクを持っている必要があります。

過去のデータは新しいブロックの検証には必要ありません。したがって、クライアントがチェーンの先端を同期したら、過去のデータは明示的にJSON-RPCで要求されるか、ピアがチェーンを同期しようとした場合にのみ取得されます。この提案では、履歴をプルーンすることで、ユーザーのディスク要件を減らします。履歴のプルーンにより、クライアントはまた過去のブロックを処理するコードを削除することができます。つまり、実行クライアントは各アップグレードの累積的な変更に対処するコードパスを維持する必要がなくなります。

最後に、この変更により、クライアントがPoS弱主観性の仮定に基づいてより軽量な同期戦略を採用するようになるため、ネットワークのバンド幅使用量が減少します。

## 仕様

| パラメータ | 値 | 説明 |
| - | - | - |
| `HISTORY_PRUNE_EPOCHS` | 82125 | ビーコンチェーンのエポック1年分 |

クライアントは、`HISTORY_PRUNE_EPOCHS`エポックより古いヘッダー、ブロックボディ、レシートをp2pネットワーク上で提供してはいけません。

クライアントは、`HISTORY_PRUNE_EPOCHS`エポックより古いヘッダー、ブロックボディ、レシートをローカルでプルーンできます。

#### ブートストラップと同期

このEIPは、クライアントのブートストラップと同期の方法に影響を与えます。過去のデータがもはや提供されないため、クライアントはdevp2pを使ってフルに同期することはできません。

クライアントは、より最近のチェーンの状態を示す有効な弱主観性チェックポイントを使ってブートストラップする必要があります。同期の目的では、クライアントは弱主観性チェックポイントをジェネシスブロックとして扱います。これを「チェックポイント同期」と呼びます。

この提案の目的では、クライアントは常に設定された有効な弱主観性チェックポイントから開始するものとします。この方法の詳細は、この提案の範囲外です。

## 根拠

この提案では、クライアントが古い過去のデータをp2pで提供することを禁止しています。これを明示的に行うことで、クライアントが過去のデータを他のソースから取得するように強制し、一部のクライアントの任意の動作に頼ることによる品質の低下を防ぎます。

### なぜ1年なのか?

この提案では、`HISTORY_PRUNE_EPOCHS`を82125エポック(1年分)に設定しています。この定数は、弱主観性期間の成長に十分な余地を提供しつつ、ディスク容量を占めすぎないように小さくなっています。

## 下位互換性

### 過去のデータの保持

この提案は、過去のデータを利用するノード(ブロック、トランザクション、アカウントの履歴を表示するWeb3アプリケーションなど)に影響します。Ethereumの歴史を保持することは根本的なものであり、これを達成するための様々な社外の方法があると考えています。

過去のデータは、トレントのマグネットリンクやIPFSなどのネットワークを介して、パッケージ化して共有することができます。さらに、ポータルネットワークやThe Graphなどのシステムを使って過去のデータを取得することもできます。

クライアントは過去のデータのインポートとエクスポートを許可する必要があります。クライアントは、データを取得/検証し、自動的にインポートするスクリプトを提供できます。

### ジェネシスからのフルシンク

p2pネットワーク上でのフルシンクはもはや可能ではありません。しかし、興味のある関係者がそれを行えるようにしたいと考えています。

「フルシンク」クライアントを構築することを提案します。このクライアントは、実行エンジンの異なるリリースを組み合わせ、過去のブロックをインポートしてEthereumチェーン全体を検証し、その他の過去のデータを生成するシムです。

アーカイブノードの「ステートシンク」機能の開発も進行中ですが、現時点ではフルシンクが信頼できる唯一の方法であることにも注意が必要です。過去のブロックを社外から取得してインポートし、ネットワークの過去のアップグレードをサポートし続けることができるクライアントが、アーカイブサポートを続ける必要があります。

### ユーザーエクスペリエンス

この提案は、過去のデータを使用するアプリケーションのセットアップに影響します。したがって、クライアントはこの変更を2段階で導入することを提案します。

第1段階では、クライアントはデフォルトでは過去のデータをプルーンしません。ユーザーがデータをプルーンしたい場合に使用できるgethの`--txlookuplimit`のようなコマンドラインオプションを導入します。

第2段階では、履歴がデフォルトでプルーンされ、コマンドラインオプションが削除されます。クライアントは、ユーザーが社外の方法でデータを見つけてインポートすると想定します。

### JSON-RPCの変更

この提案が実装された後、特定のJSON-RPCエンドポイント(例えば`getBlockByHash`)では、ある特定のハッシュが無効なのか、単に古すぎるのかを判断できなくなります。`getLogs`のようなその他のエンドポイントでは、ユーザーが要求しているデータがもはや存在しないことになります。このような後退を、アプリケーションやクライアントがどのように処理すべきかは、この提案の範囲外です。

## セキュリティ上の考慮事項

### 弱主観性への依存

PoSへの移行に伴い、長期攻撃に対する安全性を確保するために、有効な弱主観性チェックポイントを使用することが不可欠です。

この提案は弱主観性の仮定に依存しており、クライアントが無効または古い弱主観性チェックポイントでブートストラップしないことを前提としています。

また、弱主観性期間が`HISTORY_PRUNE_EPOCHS`より長くなることはないと想定しています。そうなった場合、古い弱主観性チェックポイントを持つクライアントは、p2pネットワークが必要なデータを提供できないため、「チェックポイント同期」を行うことができなくなります。

### 集中化/検閲のリスク

過去のデータを保持するインセンティブが不足すると、検閲/可用性のリスクがあります。

Ethereumの過去のデータは、独立した組織によって保存・配信されることが重要であり、その可用性を定期的にチェックする必要があります。これらのメカニズムは、この提案の範囲外と考えています。

さらに、フルノードを設定するのが難しくなるため、より多くのdAppsが過去のデータを取得するためにцентралized サービスに依存するリスクがあります。

### 他の提案との混同

実行クライアントのディスク容量を削減するための代替提案がいくつかあるため、このEIPの発音を明確にすることにしました。EIP番号を発音する際は、必ず「four fours」と発音する必要があります。その他の発音は正しくありません。

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。