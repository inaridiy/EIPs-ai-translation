---
original: 4e34600396cc747d86601b5ab33400de2d61148b327b2a663eb50bd08a58dd4d
---

---
eip: 1109
title: PRECOMPILEDCALL オペコード (プリコンパイルドコントラクトの CALL コストを削除する)
author: Jordi Baylina (@jbaylina)
discussions-to: https://ethereum-magicians.org/t/eip-1109-remove-call-costs-for-precompiled-contracts/447
status: 停滞
type: Standards Track
category: Core
created: 2018-05-22
---

## 簡単な要約

このEIPは、プリコンパイルドコントラクトを呼び出す際の通常の `CALL` コストを削減するために、`PRECOMPILEDCALL` という特別なオペコードを作成します。

## 概要

このEIPは、プリコンパイルドコントラクトを呼び出す際の高いガス消費量の問題を解決しようとしています。このオペコードを使ってプリコンパイルドコントラクトを呼び出すことで、プリコンパイルドコントラクトの実効コストを700未満に定義することができます。

## 動機

各プリコンパイルドコントラクトには、呼び出す際の定義済みのコストがあります。CALL オペコードの暗黙的な余分なガスコストを追加する意味はありません。

例えば、SHA256 プリコンパイルドコントラクトのコストは60、ECADD のコストは500 (EIP-1108で提案されているように50に変更される予定) です。プリコンパイルドコントラクトを呼び出すと、プリコンパイルドコントラクトのコストに加えて、CALL オペコードで700ガスが消費されます。

これは意味がなく、現在、プリコンパイルドコントラクトの実効コストが700未満になるように定義することは不可能です。

## 仕様

`block.number >= XXXXX` の場合、コード値 `0xfb` の新しいオペコード `PRECOMPILEDCALL` を定義します。

このオペコードのガスコストは、2 (Gbase) に各プリコンパイルドスマートコントラクトの特定のガスコストを加えたものです。

このオペコードはスタックから5つの語を取り、1つの語をスタックに返します。

入力スタック値は以下の通りです:

mu_s[0] = 呼び出されるプリコンパイルドスマートコントラクトのアドレス
mu_s[1] = 入力パラメータのメモリポインタ
mu_s[2] = 入力パラメータの長さ(バイト)
mu_s[3] = 出力を格納するメモリのポインタ
mu_s[4] = 出力バッファの長さ

返り値は以下の通りです:

1 = 呼び出しが成功した場合
0 = 以下のいずれかの場合
1. mu_s[0] が未定義のプリコンパイルドスマートコントラクトのアドレスである場合
2. プリコンパイルドスマートコントラクトが失敗した場合(各スマートコントラクトで定義されている)。入力パラメータが無効な場合など

プリコンパイルドスマートコントラクトは、オペコードを実行しないため、通常の `CALL` (`0xf1`) のようにガスパラメーターを渡す必要はありません。利用可能なガスが2 plus 特定のプリコンパイルドスマートコントラクトに必要なガス未満の場合、コンテキストは "Out of Gas" エラーで実行を停止します。

このコールにはスタックチェックはありません。

プリコンパイルドスマートコントラクトへの通常の `CALL` は、まったく同じ動作を継続します。

通常のアドレスやスマートコントラクトへの `PRECOMPILEDCALL` は "未定義のスマートコントラクト" への呼び出しと見なされ、VMは実行せず、オペコードは0x0を返します。

## 根拠

`CALL` のガスコストを削除する最初の提案がありましたが、新しいオペコードを作成して実装・テストする方が簡単だと思われます。

このオペコードのコードは、`STATICCALL` オペコードの次の空いているコードです。

## 下位互換性

このEIPは下位互換性があります。このニューオペコードを使ってプリコンパイルドコントラクトを呼び出すスマートコントラクトは、これからコストが下がります。

`CALL` メソッドでプリコンパイルドスマートコントラクトを呼び出す従来のコントラクトは、引き続き動作します。

## テストケース

- 定義済みのプリコンパイルドコントラクトへの通常の呼び出し
- 未定義のプリコンパイルドコントラクトへの呼び出し
- 通常のコントラクトへの呼び出し
- 通常のアカウントへの呼び出し
- 0x0 スマートコントラクト(存在しない)への呼び出し
- オフセットポインタと長さの大きな値での呼び出し
- スマートコントラクトを呼び出すのに必要なガスが残っている状態での呼び出し
- スマートコントラクトを呼び出すのに必要なガスから1引いた状態での呼び出し

## 実装

まだ実装されていません。

## 著作権
著作権およびその関連権利は[CC0](../LICENSE.md)で放棄されています。