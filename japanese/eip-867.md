---
original: e36de1f10d2fb3c62774c05928042cadbc6b786d05a9de4e01e415b9798fa0f5
---

---
eip: 867
title: 標準化されたイーサリアム回復提案
author: Dan Phifer <dp@musiconomi.com>、James Levy <james@taptrust.com>、Reuben Youngblom <reuben@taptrust.com>
discussions-to: https://ethereum-magicians.org/t/eip-867-standardized-ethereum-recovery-proposals-erps/139
type: Meta
status: 停滞
created: 2018-02-02
---

## 簡単な要約
イーサリアム回復提案(ERP)の標準化されたフォーマットを提供します。ERPは、特定のクラスの紛失したファンドの回復に関連しています。個々のERPは、EIPと同じプロセスに従いますが、一貫性と透明性を確保するために、標準的な方法でフォーマットされ、評価されます。

**このEIPは、特定の回復提案の受け入れを支持または反対するものではなく、その承認だけでは、ブロックチェーンの状態に変更が生じるものではありません。**

## 概要
この提案は、イーサリアムブロックチェーンで特定のクラスの紛失したファンドに対処するために使用できる共通の解決方法を特定しています。特に、直接影響を受ける当事者間で正しい結果について意見の相違がない場合に対処することを目的としており、イーサリアムの成長に伴って既に発生しているか、再び発生する可能性のある多くの問題に対して、タイムリーで低リスクの解決策を可能にします。

この解決方法は3つの部分に分かれています:

1. 承認のために検討されるためには、後続のERPが満たす必要がある基準。
2. 修正措置を指定するための共通フォーマットの推奨事項。クライアントによって解釈できるようにします。
3. クライアントチームが、特定のブロックで修正措置を読み取り、解釈し、適用するためのコードを実装するためのガイドライン。可能な修正措置の集合は、任意のERPに関連するリスクを最小限に抑えるために意図的に制限されています。

## 動機
イーサリアムブロックチェーンでのファンド回復の問題は、しばしば物議を醸します。凍結されたファンド回復提案は、そのような要求の比較的アドホックな性質と、しばしば必要とされる主観性のために、ほとんど成功しません。このEIPは、ファンド回復EIPの標準化されたフォーマットと、将来の提案を評価するための客観的な基準を提供することで、これらの障壁を取り除くことを試みています。

## 仕様
このEIPは、標準プロトコルを使用して対処できない資金回復シナリオに対処するために必要な不規則な状態変更を提案するEIPのサブクラス、いわゆるイーサリアム回復提案(ERP)の共通フォーマットを説明しています。各ERPは、ここに示されたガイドラインに従います。

各ERPの目的は、(a)修正する問題を明確に説明すること、(b)不規則な状態変更が必要かつ正当化されることを説明すること、(c)提案されたアクションが目的を達成することを実証することです。

各ERPは、提案された状態変更のセットを表すための標準フォーマットを使用する必要があり、それらの変更を確実に生成できる検証スクリプトを含める必要があります。これらの要件を満たさないERPは、承認のために検討されません。

各ERPには以下の項目が含まれている必要があります:

- **前文**: EIPの(RFC 822)ヘッダーには、ERPの番号、短いタイトル(最大44文字)、および各著者の実名(および任意の連絡先情報)が含まれています。
- **簡単な要約**: ERPの簡略化された一般向けの説明。
- **詳細な説明**: 提案された修正措置と、それらの措置を決定するために使用された基準についての人間が読める説明。
- **正当化**: 修正措置が合理的であり、直接影響を受ける当事者によって異議を唱えられる可能性が低い理由の簡潔な説明。
- **検証スクリプト**: 1つの状態変更オブジェクトを出力するマシン可読スクリプト。レビュー担当者が独立して同一の状態変更オブジェクトを再生成できるように、説明に概説された選択と行動生成のロジックを明確に実装する必要があります。
- **状態変更オブジェクト**: 検証スクリプトの出力で、クライアントへの入力。主に、提案された状態変更アクションの完全なセットを指定します。
- **付録(オプション)**: 証拠書類など、サポートデータを含むことができます。付録には、回復提案の説明の一部として指定された詳細を検証する文書が含まれる可能性があります。

以下のセクションでは、正当化、検証スクリプト、および状態変更オブジェクトの形式についてより詳細に説明します。

### 正当化
この措置が合理的(不規則な状態変更なしでは実現できない)であり、直接影響を受ける当事者によって異議を唱えられる可能性が低い理由の簡潔な説明。

**十分な例**（簡潔、証拠を含む、悪影響なし）:
*XYZが行ったクラウドセールでは、2018年1月19日にクラウドセールコントラクトのテストネットアドレスをウェブサイトに誤って公開しました。4,235,987ブロックから4,236,050ブロックの間に、328ユーザーが501 ETHをメインネットの間違ったアドレスに送金しました。テストネットのコントラクトはこちら、同じアドレスへのメインネットでの取引はこちらを参照してください。XYZのウェブサイトでの声明はこちらを参照してください。このアドレスにはテストネットにコントラクトが存在し、作成者アドレスのnonceがメインネットで既に使用されているため、偶然にプライベートキーを保持している可能性は事実上ないと考えられます。すべての取引がコードのないアドレスから来たことを確認しているため、送金者に ETHを返金することに問題はないはずです。*

**不十分な例**（詳細不足、証拠なし）:
*ウェブサイトに間違ったコントラクトアドレスを掲載してしまいました。0x1234に送金されたETHを送金者に返金してください。よろしくお願いします。*

**受け入れられない例**（客観的ではない、一方の言い分に過ぎない）:
*Xにトークンを送金したが、サービスが悪かった。お金を返金してほしいが、Xは拒否している。助けてください!!*

### 検証スクリプト
単一の状態変更オブジェクトを出力するマシン可読スクリプト。このスクリプトは、レビュー担当者が簡単に監査できるように実装する必要があります。検証スクリプトは、[web3.js](https://github.com/ethereum/web3.js/)ライブラリを使用できるJavaScriptファイルである必要があります。

検証スクリプトには以下のようなガイドラインがあります:

- スクリプトは常に可能な限り簡潔に書く必要があり、実行する前にレビューして安全でない操作が含まれていないことを確認する必要があります。
- 検証スクリプトでは、アンロックされたイーサリアムウォレットを決して必要としてはいけません。
- スクリプトは実行中に含まれる最高のブロックを固定値にする必要があります(そうしないと、実行間で結果が異なる可能性があります)。

ERPの検証スクリプトの目的は、(コードを通して)状態変更アクションを計算するために使用される基準を明確に指定することです。スクリプトの出力は、上述のように、すべてのイーサリアムクライアントが使用する入力になります。クライアントチームは、成果物を手動で前処理したり、コードの変更を指示するためにのみ成果物を使用したりするのは避ける必要があります。代わりに、成果物をクライアントにバンドルし、指定されたブロックで直接クライアントによって処理される必要があります。これにより、各ERPに必要なクライアントの作業量が最小限に抑えられ、クライアント間の互換性が確保されます。一部のERPの検証スクリプトはきわめて単純かもしれませんが、一貫性のために含めることをお勧めします。

### 状態変更オブジェクト
状態変更オブジェクトは、すべてのイーサリアムクライアントが解釈できる標準フォーマットです。

以下のフィールドを含む単一のJSONオブジェクトです:
- **erpId**: このERPの識別子(おそらくは関連するEIP番号、例: "EIP-1234")。ASCIIからHex文字列に変換され、ターゲットブロックの余分なデータに追加されます。
- **targetBlock**: 状態変更が適用されるべきブロック。クライアントはこれを使用して、状態変更が発生すべきタイミングを判断します。
- **actions**: 状態変更アクションの配列。
- **metadata**
  - **sourceBlock**: スクリプトが実行された際に考慮された最高のブロック。
  - **version**: スクリプトが実行された際のバージョン。

### 状態変更アクション
状態変更アクションは、「type」フィールドと「data」フィールドのセットを含むJSONオブジェクトです。dataフィールドの内容は、typeに依存し、その型に定義されたスキーマに従う必要があります。これにより、クライアントは当初は限られた操作セットをサポートし、必要に応じて後続のEIPに基づいてさらに追加することができます。このEIPの採用時には、クライアントが次のアクションタイプをサポートする必要があります:

#### weiTransfer
`weiTransfer`アクションは、ETHを1つのアドレスから別のアドレスに転送します。

*Dataフィールド*

- **type** (*文字列*): `weiTransfer`
- **fromAddress** (*16進文字列*): ETHを転送する送信元アドレス
- **toAddress** (*16進文字列*): ETHを送信する宛先アドレス
- **value** (*10進数文字列*): 転送するETHの量(単位はwei)。値は正の整数でなければなりません。

#### storeCode
`storeCode`アクションは、指定されたアドレスに指定されたコードを格納します。

*Dataフィールド*

- **type** (*文字列*): `storeCode`
- **toAddress** (*16進文字列*): コントラクトを復元するアドレス。
- **expectedCodeHash** (*16進文字列*): toAddressに既に存在するコードのハッシュ値。コードが存在しない場合は空文字列を使用します。それ以外の場合は、"0x"プレフィックスは省略可能です。
- **code** (*16進文字列*): 新しいバイトコード

### 付録(オプション)
付録には、レビュー担当者がERPの主張を理解または検証するのに役立つ追加の証拠資料や添付ファイルを含めることができます。

storeCodeオペレーションの場合、提案されたコントラクトソース(Solidityなど)と、レビュー担当者がソースをコンパイルして同じバイトコードを生成できるようにするために必要な他の詳細を含める必要があります。また、その場所に元々格納されていたソースも含める必要があります(可能/該当する場合)。2つのコントラクトが同一でない場合は、変更点を記載する必要があります。同一の場合は、著者が変更が必要ない理由を示す必要があります(これは稀です)。さらに、関連するレビュー、監査、およびテストケースを、元のコントラクトで遭遇した問題に対処する範囲で含める必要があります。

承認された場合、ERPは、変更が行われるブロックをコンパイルし、アクションの出所(スクリプトの出力で、標準化されたオブジェクト出力)を簡単に含めることができます。これらは、シームレスな実行のためにクライアントにバンドルできます。

## ERPの承認プロセス
ERPはEIPのサブクラスであるため、同じ承認プロセスに従います。

### テスト
*ERPの著者は現在、適切なテスト手順についてクライアントチームからのフィードバックを求めています*

## イーサリアムクライアントの実装
このEIPに提案された内容を採用するクライアントは、SCOファイル(クライアントプロセスの起動時に指定されたディレク
トリを走査して)のマッピングを構築するモジュールを実装します。新しいブロックの処理を開始する際、クライアントは先に発見されたSCOターゲットブロックのセットを確認し、現在のブロックに必要な回復アクションがあるかどうかを判断する必要があります。

例えば、この例では、`erpsByTargetBlock`は、各ERPの状態変更オブジェクトに関連付けられたターゲットブロック番号と、実際のデータを含むリソース(つまりファイル名)への参照の間のマッピングです。

```
if (erpsByTargetBlock.get(currentBlock) != null) {
    try {
        applyRecoveryActions(erpsByTargetBlock.get(currentBlock));
     }
     catch (e) {
        // 回復アクションはバッチとして扱う必要があります。
        // 1つでも失敗すると、すべて失敗します。
     }
}


// 通常のブロック処理を続行...
```

`applyRecoveryActions`メソッドは、SCOファイルに格納されている順序と同じ順序で回復アクションを適用する必要があります。クライアントは、いかなる状態変更アクションも、アカウントの現在の残高を超える金額を転送しないことを保証する責任があります。`weiTransfer`と`storeCode`の`toAddress`は常に有効なアドレス(つまり`0x0`ではない)でなければなりません。

さらに、ERPの影響を受けるすべてのブロックには、状態変更が発生したことを示す余分なデータを含める必要があります。ブロックに含まれる余分なデータは、SCOファイルのerpIdをHex文字列に変換したものです(つまり`hexStringToBytes(asciiToHex(erpId))`)。クライアントは、ピアから受信したブロックの場合、ターゲットブロックに予期されるヘッダーが存在することも検証する必要があります。

ERPには、各クライアントリポジトリのプルリクエストへのリンクが含まれており、これらのプルリクエストはERPに戻り、EIPの前文と要約も含んでいます。

ERPに関連するすべてのPRは、クライアントの指定されたSCOディレクトリに追加される単一のファイル(SCOファイル)で構成される必要があります。クライアントコードの追加は不要です。

### このEIPの制限事項

このEIPは、回復提案を可能な限り読みやすく、ミスや悪用の可能性を最小限に抑えるために、それらをどのようにフォーマットできるかに焦点を当てています。

以下は、このEIPの範囲外と考えられています:
- 受け入れるべき資金回復提案(もしあれば)は何か。
- 個別の当事者を代表する集団的なERPをどのように組織化できるか。

## 根拠
上記の方法を採用した主な考慮事項は、それ以外の解決策がない回復アクションに関連するリスクを最小限に抑えることでした。2番目の考慮事項は、回復アクションの提案に使用されるフォーマットを標準化することでした。

まず、検証スクリプトを含めることで、回復アクションがどのように決定されたかが明確になります。これは、回復アクション自体が必ずしも正しいことを意味するわけではありません。ただし、それらを決定するために使用されたロジックが完全に指定され、監査可能であることを意味します。

次に、検証スクリプトの出力がクライアントプログラムによって直接解釈可能であることを要求することで、特定のERPを採用するために各クライアントが行う作業が最小限に抑えられます。また、特定のERPの実装について、2つのクライアントが異なる決定をする可能性も低減されます。

3番目に、アクションタイプは意図的に制限および柔軟性がないため、意図しない結果や悪意を持って作成されたファイルがブロックチェーンの状態に影響を与える可能性が低くなります。必要に応じて新しいアクションタイプを追加することは簡単ですが、それには別のEIPが必要です。

## 実装
EthereumJプラットフォーム用のリファレンス実装が書かれています。[こちら](https://github.com/ethereum/ethereumj/pull/1004#commits-pushed-1105610)のプルリクエストを参照してください。

## ERPの例

このセクションには、例とSCOリソースファイル、およびプライベートテストネットを使用してテストする方法に関するチュートリアルが含まれます。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。