---
original: f13494cbdb776d94d4541d82c0acb77755d1060f27ac5a2690ef8c03f938a152
---

---
eip: 2566
title: コントラクト関数実行のための人間可読パラメータ
author: Joseph Stockermans (@jstoxrocky)
discussions-to: https://ethereum-magicians.org/t/human-readable-parameters-for-contract-function-execution/4154
status: 停滞
type: Standards Track
category: Interface
created: 2020-03-23
---

## 簡単な要約
ユーザーに人間可読のコントラクト関数実行データを表示できるよう、`eth_sendTransaction`と並行する新しいEthereumのRPCメソッド`eth_sendTransactionToContractFunction`を導入する。

## 概要
ダップがProviderWalletを通してスマートコントラクト関数の実行をユーザーに求める際、ProviderWalletレイヤーに表示される確認画面では、呼び出される関数の人間可読の詳細や引数を表示することができません。これは、コントラクト関数の実行に使用されるEthereumのRPCメソッド(`eth_sendTransaction`)が、人間可読ではなく(かつ復元不可能な)形式で関数呼び出し情報を受け取るためです。そのため、ProviderWalletがダップから受け取る非人間可読の情報から、人間可読のバージョンを復元することはできません。

これは、ユーザーにとって良くない、潜在的に危険な体験を生み出します。例えば、悪意のあるダップが、トークンコントラクトの`transfer(address,uint256)`関数の`address`引数を入れ替え、本来の受取人ではなく自分にトークンを送金させることができます。この手品のようなことは、非人間可読なデータを軽く見るユーザーには気づかれにくいでしょう。新しいEthereumのRPCメソッド(`eth_sendTransactionToContractFunction`)を導入し、関数のABIを受け取ることで、ProviderWalletはコントラクト関数実行の人間可読の詳細をユーザーに表示できるようになります。

## 動機
### ProviderWalletの定義
MetamaskやgethなどのProviderWalletは、EthereumのAPIプロバイダとイーサリアムウォレットを組み合わせたハイブリッドソフトウェアです。これにより、ユーザーに代わってトランザクションに署名し、それらを Ethereum ネットワークに配信することができます。ProviderWalletは、ユーザーに人間可読の確認プロンプトを提供することで、利便性とユーザー保護の両方を実現しています。

### 既存のソリューション
この数年間、Ethereumのトランザクションデータの人間可読性に関する議論が行われてきました。Aragonの[Radspec](https://github.com/aragon/radspec)は、この問題に取り組んでいます。Radspecでは、コントラクト開発者がコントラクト関数に人間可読なコメントを追加する必要があります。ProviderWalletは、Radspecソフトウェアを使ってこれらのコメントをコントラクトコードから解析し、必要に応じて引数の値を置き換えてエンドユーザーに表示することができます。しかし、この方法は、Radspecコメントのないコントラクトでは機能せず(またIPFSとの統合が必要かもしれません)。

[EIP 1138](https://github.com/ethereum/EIPs/issues/1138)も同様の問題に取り組んでいますが、信頼できないダップが、ユーザーに表示される人間可読メッセージを生成できるという重大なセキュリティ上の問題を含んでいます。同様の考え方に基づいて、[Gethの#2940 PR](https://github.com/ethereum/go-ethereum/pull/2940)や[EIP 191](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-191.md)、[EIP 712](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-712.md)では、ProviderWalletがユーザーに実際に操作しているデータについてより良い情報を提供することの重要性が強調されています。

最後に、ProviderWallet Metamaskには、ERC20コントラクトとの相互作用のための組み込みの機能があり、確認プロンプトに意図された*トークン*の受取人と*トークン*の値を表示することができます。これは、ERC20ライクのコントラクトにのみ ad hoc に実装されていますが、その動機は同じです。ユーザーは、ProviderWalletに依存して実行するコントラクト関数について、より良い情報を得る必要があります。

### 背景
ある時点で、ダップはユーザーにコントラクトとの対話を求めることになります。ダップとコントラクト間の相互作用は、Ethereumエコシステムの大きな部分を占めており、ほとんどの場合ProviderWalletを介して行われます。ダップがユーザーにコントラクトとの対話を求める際、EthereumのAPIをエクスポーズするProviderWalletに`eth_sendTransaction`メソッド名と関連するトランザクションデータを送信します。トランザクションデータの`data`フィールドには、Ethereumの仮想マシンがコントラクトの関数を識別して実行するために必要な情報が含まれています。このフィールドには、人間可読ではなく、元の状態に復元することもできない特定の形式があります。

`eth_sendTransaction`の`data`フィールドに使用される承認された形式は、関数シグネチャのkeccak256ダイジェストの最初の4バイトのヘキサデシマルエンコーディングです。この短縮ハッシュは、関数への引数のABIエンコーディングと連結されます。関数シグネチャのkeccak256ダイジェストを関数シグネチャに逆変換することはできないため、`data`フィールドは人間可読ではなく、復元することもできません。さらに、連結された引数の値についての追加の洞察は、関数シグネチャの前画像に保持されているデータ型の情報によってさらに不明瞭になっています。

## 仕様
このEIPは、EthereumのRPCメソッドのセットに新しいメソッド`eth_sendTransactionToContractFunction`を追加することを提案しています。このメソッドは`eth_sendTransaction`と並行しており、唯一の違いは`abi`フィールドの追加です。

パラメータ

1. `Object` - トランザクションオブジェクト
  * `from`: `DATA`, 20 Bytes - トランザクションが送信されるアドレス。
  * `to`: `DATA`, 20 Bytes - (新しいコントラクト作成時は省略可能) トランザクションが向かうアドレス。
  * `gas`: `QUANTITY` - (省略可能、デフォルト: 90000) トランザクション実行に提供されるガス量。未使用ガスが返されます。
  * `gasPrice`: `QUANTITY` - (省略可能、デフォルト: 未定) 支払われるガスごとのガス価格
  * `value`: `QUANTITY` - (省略可能) このトランザクションと共に送信される値
  * `data`: `DATA` - 呼び出されたメソッドのシグネチャとエンコーディングされた引数のハッシュ
  * `abi`: `DATA` - 関数のABI
  * `nonce`: `QUANTITY` - (省略可能) ノンス。同じノンスを使用する保留中のトランザクションを上書きできます。

パラメータの例
```
  params: [{
    "from": "0x69e6F1b01f34A702Ce63bA6EF83c64fAEC37a227",
    "to": "0xe44127f6fA8A00ee0228730a630fc1F3162C4d52",
    "gas": "0x76c0", // 30400
    "gasPrice": "0x9184e72a000", // 10000000000000
    "value": "0x9184e72a", // 2441406250
    "abi": "{
      "inputs": [{
        "name": "_address",
        "type": "address"
      }, {
        "name": "_value",
        "type": "uint256"
      }],
      "name": "transferTokens",
      "outputs": [{
        "name": "success",
        "type": "bool"
      }],
      "stateMutability": "nonpayable",
      "type": "function"
    }",
   "data": "0xbec3fa170000000000000000000000006Aa89e52c9a826496A8f311c1a9db62fd477E256000000000000000000000000000000000000000000000000000000174876E800"               
  }]
```

戻り値
DATA, 32 Bytes - トランザクションハッシュ。トランザクションがまだ利用可能でない場合は、ゼロハッシュ。

例
// リクエスト
curl -X POST --data '{"jsonrpc":"2.0","method":"eth_sendTransactionToContractFunction","params":[{上記のパラメータ}],"id":1}'

// 結果
{
  "id":1,
  "jsonrpc": "2.0",
  "result": "0xe670ec64341771606e55d6b4ca35a1a6b75ee3d5145a99d05921026d1527331"
}

## 根拠
この EIP で提案されている `eth_sendTransactionToContractFunction` メソッドは、コントラクト関数の実行結果が `eth_sendTransaction` と同じになるように、可能な限り `eth_sendTransaction` と並行するように設計されています。新しく導入された `abi` フィールドは、意図された関数に対応するコントラクトの ABI の一部です。`data` フィールドは `eth_sendTransaction` の `data` フィールドと同じです。`abi` フィールドと `data` フィールドから解析された値を組み合わせることで、人間可読のコントラクト関数実行情報を再現できます。

## 実装
`eth_sendTransactionToContractFunction` の `data` フィールドは、`eth_sendTransaction` に必要なものと同じであるため、`eth_sendTransaction` に使用されている既存のメカニズムを使ってトランザクションを完了できます。入力引数の値は `data` フィールドから解析でき、`abi` フィールドからそれらのデータ型がわかるため、プロバイダウォレットはこの情報を使って適切な人間可読の形式でそれらの値をエンコーディングして表示できます。さらに、`data` フィールドのハッシュ化された短縮関数シグネチャは、`abi` フィールドの情報を使って再構築できるため、提供された ABI が `data` フィールドと一致することを確認する追加のチェックができます。

## 下位互換性
下位互換性を考慮して、このEIPは既存のメソッドを変更するのではなく、EthereumのRPCメソッドのセットに新しいメソッドを追加することを提案しています。新しいRPCメソッドを追加する先例は、[EIP 712](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-712.md)にあります。ここでは、`eth_signTypedData`メソッドの追加が提案されています。別のアプローチとして、`eth_sendTransaction`メソッドに`abi`引数を追加することも考えられますが、これにより、コントラクト関数を実行しようとするすべての既存のコードが壊れてしまいます。

## セキュリティの考慮事項
コントラクトアドレス、関数名、引数の値を表示することで、ユーザーにセキュリティ上の追加の恩恵を与えることができますが、関数が期待どおりに実行されることを保証するものではありません。実装の悪いコントラクトでも、`transfer`という関数名を付け、`address`と`uint256`の引数を受け取ることができます。しかし、コントラクトのコードを調べない限り、これが本当の ERC20 コントラクトであるかどうかを知る方法はありません。このEIPは、コントラクトのコードに対する信頼の問題を解決しようとするものではなく、ユーザーが Ethereum ネットワークに配信しているデータの正確な内容を理解できるようにすることを目的としています。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。