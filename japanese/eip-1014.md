---
original: c6b6b95eecf9979593921ee2fdf1986eb1671e43b9a312111072ad040f7290ac
---

---
eip: 1014
title: Skinny CREATE2
author: Vitalik Buterin (@vbuterin)
category: Core
type: Standards Track
status: Final
created: 2018-04-20
---

### 仕様

新しいオペコード (`CREATE2`) を `0xf5` に追加します。これは4つのスタック引数を取ります: endowment、memory_start、memory_length、salt。`CREATE` (`0xf0`) と同じ動作をしますが、通常の送信者とnonce-hashの代わりに `keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]` を使ってアドレスを初期化します。

`CREATE2` は `CREATE` と同じ `gas` スキーマを持ちますが、`init_code` のハッシングに必要な追加の `hashcost` も持ちます。この `hashcost` は `GSHA3WORD * ceil(len(init_code) / 32)` で計算され、メモリ拡張ガスと `CreateGas` が差し引かれる前に差し引かれます。

- `0xff` は1バイトです。
- `address` は常に `20` バイトです。
- `salt` は常に `32` バイトのスタックアイテムです。

最終的なハッシングラウンドの前処理は常に正確に `85` バイトの長さです。

2018-08-10 のコアデベロッパーの決定により、上記の式が使用されることになりました。

### 動機

まだオンチェーンに存在しないが、特定の初期化コードによって作成されたコードのみを含むことが保証されるアドレスとの (実際の または 仮想的な チャネルでの) 対話を可能にします。状態チャネルのユースケースにとって重要です。

### 根拠

#### アドレス式

* `keccak256(rlp([sender, nonce]))` の従来の式で作成されたアドレスとの衝突を防ぐため、`0xff` はRLPデータの開始バイトとして使用されることはありません。
* ハッシュの前処理の長さを固定します。

#### ガスコスト

`init_code` のハッシングに依存するアドレスの計算では、大きな `init_code` の繰り返しハッシングによるDoS攻撃の可能性があります。このEIPでは、`SHA3`オペコードと同じコストパーワードを使用しています。

### 明確化

`init_code` は、実行されると状態に配置されるランタイムバイトコードを生成するコードで、高レベル言語の「コンストラクタ」の実装に使用されます。

このEIPは衝突を可能にします。衝突の動作は [EIP-684](https://github.com/ethereum/EIPs/issues/684) で指定されています:

> 作成トランザクションまたは `CREATE` (または将来の `CREATE2`) オペコードによる契約の作成が試行された場合、宛先アドレスにゼロ以外のnonce、または空でないコードがある場合、作成は即座に失敗し、初期化コードの最初のバイトが無効なオペコードであるのと同じ動作になります。これはジェネシスから遡及的に適用されます。

具体的には、`nonce` または `code` がゼロ以外の場合、作成操作は失敗します。

[EIP-161](./eip-161.md) によると、

> アカウント作成トランザクションと `CREATE` 操作は、初期化コードの実行の前に、通常の開始値よりも1つ多くnonce を増やさなければなりません。

つまり、トランザクション内で契約が作成された場合、`nonce` は即座にゼロ以外になり、同じトランザクション内での衝突は常に失敗することを意味します - `init_code` 自体から行われた場合でも。

また、`SELFDESTRUCT` (`0xff`) は `nonce` または `code` に即座の影響を与えないため、1つのトランザクション内で契約を破棄して再作成することはできません。

### 例

例 0
* アドレス `0x0000000000000000000000000000000000000000`
* salt `0x0000000000000000000000000000000000000000000000000000000000000000`
* init_code `0x00`
* ガス (メモリ拡張なしと仮定): `32006`
* 結果: `0x4D1A2e2bB4F88F0250f26Ffff098B0b30B26BF38`

例 1
* アドレス `0xdeadbeef00000000000000000000000000000000`
* salt `0x0000000000000000000000000000000000000000000000000000000000000000`
* init_code `0x00`
* ガス (メモリ拡張なしと仮定): `32006`
* 結果: `0xB928f69Bb1D91Cd65274e3c79d8986362984fDA3`

例 2
* アドレス `0xdeadbeef00000000000000000000000000000000`
* salt `0x000000000000000000000000feed000000000000000000000000000000000000`
* init_code `0x00`
* ガス (メモリ拡張なしと仮定): `32006`
* 結果: `0xD04116cDd17beBE565EB2422F2497E06cC1C9833`

例 3
* アドレス `0x0000000000000000000000000000000000000000`
* salt `0x0000000000000000000000000000000000000000000000000000000000000000`
* init_code `0xdeadbeef`
* ガス (メモリ拡張なしと仮定): `32006`
* 結果: `0x70f2b2914A2a4b783FaEFb75f459A580616Fcb5e`

例 4
* アドレス `0x00000000000000000000000000000000deadbeef`
* salt `0x00000000000000000000000000000000000000000000000000000000cafebabe`
* init_code `0xdeadbeef`
* ガス (メモリ拡張なしと仮定): `32006`
* 結果: `0x60f3f640a8508fC6a86d45DF051962668E1e8AC7`

例 5
* アドレス `0x00000000000000000000000000000000deadbeef`
* salt `0x00000000000000000000000000000000000000000000000000000000cafebabe`
* init_code `0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef`
* ガス (メモリ拡張なしと仮定): `32012`
* 結果: `0x1d8bfDC5D46DC4f61D6b6115972536eBE6A8854C`

例 6
* アドレス `0x0000000000000000000000000000000000000000`
* salt `0x0000000000000000000000000000000000000000000000000000000000000000`
* init_code `0x`
* ガス (メモリ拡張なしと仮定): `32000`
* 結果: `0xE33C0C7F7df4809055C3ebA6c09CFe4BaF1BD9e0`