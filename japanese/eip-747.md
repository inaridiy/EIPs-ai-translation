---
original: 8b6f1f30c67c44877c8f653238fea531c00f4b228ce0ff4196034a86f387b2ee
---

---
eip: 747
title: wallet_watchAsset RPC メソッド
description: ユーザーにアセットを監視するよう促すための新しい RPC メソッドを追加する
author: Dan Finlay (@danfinlay)、Esteban Mino (@estebanmino)、Gavin John (@Pandapip1)
discussions-to: https://ethereum-magicians.org/t/eip-747-eth-watchtoken/1048
status: 最終版
type: Standards Track
category: Interface
created: 2018-08-13
requires: 20, 1046, 1193
---

## 概要

このEIPは、クライアントがユーザーのウォレットでトークンを追跡するよう提案できる新しいウォレットスコープのRPCメソッド `wallet_watchAsset` を標準化します。

## 動機

現在、Ethereumウォレットの主要な用途の1つは、ユーザーの資産を追跡することです。
このEIPがなければ、各ウォレットは承認済みのアセットのリストを事前にロードするか、ユーザーが手動でアセットをウォレットに追加する必要があります。
前者の場合、ウォレットはこのリストの管理とセキュリティ、およびウォレット上の既知のアセットの一括ポーリングの帯域幅の両方を負担しなければなりません。
後者の場合、ユーザーエクスペリエンスは悪化します。

## 仕様

この文書の中の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

新しいRPCメソッド `wallet_watchAsset` が追加されます。 `wallet_watchAsset` は、指定されたアセットをユーザーのウォレットにリストアップするよう要求します。 ユーザーにプロンプトを表示する前に、即座に (つまり、ユーザーとの対話を待たずに) `true` を返す必要があります。 要求が無効な場合はエラーを返す必要があります。 「ユーザーのウォレットにリストアップされる」の意味は、ウォレットの実装に依存します。 `wallet_watchAsset` への成功呼び出しは、ウォレットがリクエストを認識し、問題がないことを示す必要がありますが、ユーザーがプロンプトされたかどうか、またはアセットが実際にウォレットに追加されたかどうかを示すものではありません。

### `wallet_watchAsset` パラメーター

`wallet_watchAsset` メソッドは、単一のパラメーターである `WatchAssetParameters` オブジェクトを受け取ります。これは次のように定義されます:

```typescript
interface WatchAssetParameters {
  type: string; // アセットのインターフェース、例: 'ERC1046'
  options: any;
}
```

`type` 文字列には、アセットのコントラクトが実装するインターフェースの一般的に受け入れられている名称を使用する必要があります。例: `ERC1046`。 さまざまなアセットタイプの global 識別子を定義することは、このEIPの範囲外です。

このインターフェースは、アセットの `type` に応じて拡張または変更される必要があります。これらの変更は、別のEIPで指定する必要があります。

### `wallet_watchAsset` の返り値

`wallet_watchAsset` は即座に (つまり、ユーザーとの対話を待たずに) `true` のブール値を返して、リクエストが認識されたことを示します (ユーザーがプロンプトされたかどうかは関係ありません)。リクエストが無効な場合はエラーを返します。次のような場合にエラーが発生する可能性があります (網羅的ではありません):

- アセットタイプが認識されていない/サポートされていない
- アセットがホワイトリストやブラックリストによってブロックされた (これにより、開発者の対応が必要なルート原因のため、リクエストが「無効」になる)
- 画像のダウンロードに失敗した
  - ウォレットが SSRF 攻撃を防ぐために、アセットを表示するために必要なメタデータの一部をロードできなかった

### `ERC1046` タイプ

オプションフィールドのフォーマットは次のとおりです:

```typescript
interface ERC1046WatchAssetOptions {
{
    address: string; // トークンコントラクトの16進数アドレス
    chainId?: number; // アセットのチェーンID。空の場合は、現在のチェーンIDがデフォルトになります。
  };
}
```

`address` は必須で、他のフィールドはオプションです。 `address` は、トークンコントラクトの `0x` プレフィックス付き正規化された16進数アドレスでなければなりません。 `chainId` は、アセットが属するチェーンIDでなければなりません。

チェックサムが失敗した場合、リクエストは無効と見なされる必要があります。

ウォレットが `chainId` を認識しない場合、または `chainId` が空白で、ウォレットに「アクティブ」なチェーンの概念がない場合、呼び出しは失敗する必要があります。

`wallet_watchAsset` は、[ERC-1046](./eip-1046.md) の `tokenURI` をフェッチし、`interop` フィールドを確認してトークンの種類を判断する必要があります。 解析に失敗した場合、または種類が不明な場合、RPCコールはエラーを返す必要があります。

`wallet_watchAsset` は、`name` と `symbol` フィールド、およびコントラクトの `address` と `chainId` を、よく知られているトークンのリストと照合する必要があります。 名前や記号がリストのものに似ているが、`chainId`/`address` が一致しない場合は、ユーザーに警告を表示する必要があります。

ウォレットは、SSRF 攻撃を回避するために、特定のポートとスキームをホワイトリストまたはブラックリストに登録する必要があります。

### 従来の `ERC20` タイプ

オプションフィールドのフォーマットは次のとおりです:

```typescript
interface ERC20WatchAssetOptions {
{
    address: string; // トークンコントラクトの16進数アドレス
    chainId?: number; // アセットのチェーンID。空の場合は、現在のチェーンIDがデフォルトになります。
  };
}
```

`address` は必須で、他のフィールドはオプションです。 `address` は、トークンコントラクトの `0x` プレフィックス付き正規化された16進数アドレスでなければなりません。 `chainId` は、アセットが属するチェーンIDでなければなりません。

チェックサムが失敗した場合、リクエストは無効と見なされる必要があります。

ウォレットが `chainId` を認識しない場合、または `chainId` が空白で、ウォレットに「アクティブ」なチェーンの概念がない場合、呼び出しは失敗する必要があります。

`wallet_watchAsset` は、`name` と `symbol` フィールド、およびコントラクトの `address` と `chainId` を、よく知られているトークンのリストと照合する必要があります。 名前や記号がリストのものに似ているが、`chainId`/`address` が一致しない場合は、ユーザーに警告を表示する必要があります。

可能であれば、代わりに `ERC1046` タイプを使用することをお勧めします。これは、画像とカスタムメタデータをサポートしています。

## 根拠

ユーザーの資産を表示することは、すべての最新のDAppユーザーが期待する基本的な機能です。 現在、ほとんどのウォレットは、クライアント側に保存されるアセットリストを管理するか、残高の取得に集中型APIを使用しています。これにより、分散化が低下し、アカウント保有者とIPアドレスの相関関係が可能になります。 さらに、ネットワークからアセットリストを更新/ポーリングすることは、特に帯域幅が制限されたデバイスでは、コストがかかる可能性があります。 また、アセットリストの管理は政治的な行為になり、嫌がらせを引き起こし、わずかなアセットをリストすることへの圧力を誘発する可能性があります。

自動的にアセットをリストアップすると、アセットがスパムメールのようになります。ユーザーは突然、自分が気にしていないアセットをウォレットに表示されるようになります。これは、未承諾の情報を送信したり、フィッシング詐欺を行ったりするために使用できます。この現象は、すでにエアドロップされたトークンで一般的であり、ネットワークの輻輳の主な原因となっています。なぜなら、新しいトークンをユーザーにスパムすることが、これまで報酬として扱われてきたからです。

ユーザーが手動でアセットを追加する場合、おそらく以前にそのウェブサイトからそのトークンについて学習していたはずです。その時点では、両者の利益が一致しており、ユーザーがそのトークンを追跡することを望んでいました。これは、これらの当事者が簡単に協力できるAPIを導入する自然な時期です。

## セキュリティ上の考慮事項

### サーバーサイドリクエストフォージェリ

ウォレットは、任意のURLへのリクエストを行うことに注意する必要があります。そのため、ウォレットはURIを特定のスキームとポートでホワイトリストに登録することをお勧めします。脆弱なウォレットは、たとえばローカルホストのredisデータベースのデータを変更するように騙される可能性があります。

### 検証

ウォレットは、フィッシング詐欺を避けるために、シンボルや名称が別のトークンと一致または類似している場合、ユーザーに警告を表示する必要があります。

### フィンガープリンティング

ウォレットの動作や/またはリストされたアセットに基づくフィンガープリンティングを避けるために、RPCコールはユーザーがプロンプトを承認または拒否するのを待たずに、ユーザーがプロンプトされるか、エラーが発生したらすぐに返す必要があります。

## 著作権

著作権およびそれに関連する権利は [CC0](../LICENSE.md) で放棄されています。