---
original: a6b9f9611dbc1736713ce35a01249930e68469e80bd0dd0556bf62e974d6391c
---

---
eip: 7684
title: 固有の資格情報の預金を返金する
description: 既存のバリデーター記録の預金を自動的に引き出しますが、実行の引き出し資格情報が異なります
author: Lion (@dapplion)
discussions-to: https://ethereum-magicians.org/t/eip-7684-return-deposits-for-distinct-credentials/19632
status: Draft
type: Standards Track
category: Core
created: 2024-04-12
---

## 概要

既存のバリデーター記録の預金を自動的に引き出しますが、預金に別の実行の引き出し資格情報が含まれています。

## 動機

一部のステーキング操作では、バリデーションキーを運用する1つのエンティティと、預金を行う別のエンティティの2つの異なるエンティティが存在します。資金提供エンティティはステーキング操作の管理を委任しますが、資金の最終的な管理権を保持する必要があります。資金提供エンティティが単一の預金で全額のステーキング額を提出し、他のエンティティのバリデーションキーを使用する場合、フロントランの攻撃の対象となります。バリデーションエンティティは、独自の引き出し資格情報を持つ2番目の預金をフロントランで提出できます。全額のステーキング預金は、バリデーションエンティティの管理下にある追加の預金になります。

フロントランの攻撃に対するいくつかの回避策があります。資金提供エンティティとバリデーションエンティティの両方の同意が必要な分散型キー生成プロトコルを使用して預金を行う。1 ETHの預金を最初に提出し、その取り込みを待ってから全額のステーキング額を追加の預金として送信し、攻撃下での最大損失を1 ETHに制限する。これらの回避策は機能しますが、信頼できない自律的なステーキングプロトコルの運用を困難にします。

この仕様では、ナイーブな預金提出の総損失を預金額全額ではなく`RETURN_DEPOSIT_PENALTY`に減らします。

## 仕様

### コンセンサスレイヤー

仕様の設定値とメカニズムは、[コンセンサスレイヤーの仕様](https://github.com/ethereum/consensus-specs/blob/2360756c8c19c0f7b0e91135f5bbcddecdf0a835/specs/_features/eip9999/beacon_chain.md)にあります。

コンセンサスレイヤーへの変更の概要は以下の通りです。

- `apply_deposit`を変更して、別の実行の引き出し資格情報を持つ預金の引き出しをキューに入れる
- `get_expected_withdrawals`を変更して、まず保留中の引き出しを返す
- `process_withdrawals`を変更して、保留中の引き出しキューをクリアする

### 実行レイヤー

この仕様では、実行レイヤーへの変更は必要ありません。

## 根拠

### 保留中の引き出しを維持する

スロットNのブロックから拒否された預金は、循環依存のためスロットNで引き出すことはできません。実行クライアントは、スロットNのペイロードを構築する前に、引き出しの完全なリストを知っている必要があります。[EIP-6110](./eip-6110.md)以降、コンセンサスクライアントは、スロットNのベーコンブロックを構築する前に、スロットNの完全な実行ペイロードを知っている必要があります。したがって、拒否された預金は、将来のスロットで引き出される必要があります。単純化のため、すべての保留中の引き出しは次のスロットですぐに処理されますが、DoS攻撃の懸念がある場合は、段階的に処理することもできます。

## 下位互換性

これはイーサリアムのコンセンサスレイヤーに対する下位互換性のない変更であり、ハードフォークでスケジュールする必要があります。

実行レイヤーとの前方/後方互換性の問題はありません。

## テストケース

テストケースは、標準的なコンセンサスレイヤーのテストの中で作業中です。

## セキュリティの考慮事項

最悪の場合の引き出し数は、現在のガス規則と30Mガスブロックの下で16から1,271に増加します。[EIP-6110](./eip-6110.md)を引用すると、将来のガス効率により、30Mガスブロックで1,916の引き出しまで増加できます。各引き出しは単一のアドレスバランス変更をもたらします。そのような操作の明示的な価格付けはありませんが、最悪の場合、ブロック全体のガス量が大幅に増加します(6,900ガス/引き出しと現在のガス規則を前提とすると30%増加)。

`RETURN_DEPOSIT_PENALTY`は拒否された預金を抑止し、144,927 Gwei/ガスのガスコストを課します(6,900ガス/引き出しを前提とする)。

## 著作権

著作権およびその関連権利は[CC0](../LICENSE.md)で放棄されています。