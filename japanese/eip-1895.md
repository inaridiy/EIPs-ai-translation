---
original: 3b09ef0e489540198c90b279cb55346f9a4a8a1b8afbeabec7017994c72742ed
---

---
eip: 1895
title: 楕円曲線サイクルのサポート
author: Alexandre Belling <alexandrebelling8@gmail.com>
discussions-to: https://ethresear.ch/t/reducing-the-verification-cost-of-a-snark-through-hierarchical-aggregation/5128
status: 停滞
type: Standards Track
category: Core
created: 2018-03-31
---

## 簡単な要約

現在のEVMは、事前コンパイルされた `ecadd`、`ecmul`、`ecpairing` 関数を使って、楕円曲線 *alt-bn128* の演算をサポートしています。MNT4およびMNT6クラスには、曲線のサイクルが含まれています。これらのサイクルを使うと、ある曲線上で演算を行い、別の曲線上のSNARKで検証することができます (逆も可能)。この EIP では、これらの曲線のサポートを追加することを提案します。

## 概要

以下の演算のサポートを事前コンパイルで追加します:

* MNT4 上の `ecadd`
* MNT4 上の `ecmul`
* MNT4 上の `ecpairing`

## 動機

楕円曲線は、再帰的なSNARKs (つまり、SNARK内でSNARKを検証する) の基本ブロックであり、これにより、スケーラブルなゼロ知識証明が可能になります。より一般的には、SNARK検証が検証対象の回路サイズに依存しないため、スケーラビリティの問題の一部に取り組むことができます。

具体的には、EVMが1000件以上のSNARK検証を処理する必要がある場合、約15億ガスを消費し、実用的ではありません。再帰的SNARKsを使えば、複数の証明を1つにまとめて検証できるため、検証コストを大幅に削減できます。

しかし、*alt-bn128* を使っては不可能です。私の知る限り、ペアリング対応曲線の間でサイクルを生成することができるのは、MNT4とMNT6のみです。これらの2つのファミリー間のサイクルの完全な特徴付けは、[On cycles of pairing-friendly elliptic curves](https://arxiv.org/pdf/1803.02067.pdf) で提案されています。

## 仕様

### 曲線

提案されているサイクルは、[Scalable Zero Knowledge via Cycles of Elliptic Curves](https://eprint.iacr.org/2014/595.pdf) で紹介されています。

### MNT4の定義

`G_1`と`G_2`は素数位数の巡回群です:

```.
q = 475922286169261325753349249653048451545124878552823515553267735739164647307408490559963137
```

`G_1`は素数位数の体`F_p`上に定義されます:

```.
p = 475922286169261325753349249653048451545124879242694725395555128576210262817955800483758081
```

生成元Pは:

```.
P = (
    60760244141852568949126569781626075788424196370144486719385562369396875346601926534016838,
    363732850702582978263902770815145784459747722357071843971107674179038674942891694705904306
)
```

pとqは298ビットで表現できます。

`G_1`は、方程式`Y² = X³ + aX + b`で定義される曲線上に定義されます。ここで:

```.
    a = 2
    b = 423894536526684178289416011533888240029318103673896002803341544124054745019340795360841685
```

ツイスト群`G_2`は、体`F_p^2 = F_p / <<未完成>>`上に定義されます。

`G_2`は、方程式`Y² = X² + aX + b`で定義される曲線上に定義されます。ここで:

```.
    a = 34 + i * 0
    b = 0 + i * 67372828414711144619833451280373307321534573815811166723479321465776723059456513877937430
```

`G_2`の生成元は以下のように生成されます:

```.
    P2 = (
        438374926219350099854919100077809681842783509163790991847867546339851681564223481322252708 +
        i * 37620953615500480110935514360923278605464476459712393277679280819942849043649216370485641,
        37437409008528968268352521034936931842973546441370663118543015118291998305624025037512482 +
        i * 424621479598893882672393190337420680597584695892317197646113820787463109735345923009077489
    )
```

### 演算とガスコスト

以下の演算とそのガスコストを実装します。

```.
MNT_X_ADD = <<To be estimated>>
MNT_X_MUL = <<To be estimated>>
MNT_X_PAIRING = <<To be estimated>>
```

ここで、`X`は4を表します。

### エンコーディング

体`F_p`上の曲線上の点`P(X, Y)`は、圧縮形式`C(X, Y)`で表現されます:

```.
    C = X | s
```

ここで、`s`は`Y`を以下のように表します:

```.
    |  `s'`  | `Y`                      |
    |--------|--------------------------|
    | `0x00` | 無限遠点                 |
    | `0x02` | `y`が偶数の解            |
    | `0x03` | `y`が奇数の解            |
```

アフィン座標から圧縮形式への変換は簡単です:

```.
    s = 0x02 | (s & 0x01)
```

EVMでは、この圧縮形式により、曲線上の点を2つのuint256で表現できます。

### 特殊ケース

* 無限遠点の表現には複数の許容表現がある

## 根拠

この曲線は80ビットのセキュリティを持ち (一方、MNT6は120ビット)、重要なセキュリティレベル (例えば数十億ドルの送金) には不十分かもしれませんが、他の用途には十分です。セキュリティが不十分と判断された場合、Codaが使用している別のサイクルを使う選択肢もあります。しかし、このサイクルは753ビットの体上で定義されているため、これも問題になる可能性があります (Codaの公開物からこの曲線に関する情報は見つからない)。

サイクルの選択に関わらず、群と体要素は256ビットを超える整数で表現される必要があるため、より大きな体サイズの演算のサポートを追加する必要があるかもしれません。

より効率的なペアリング対応サイクルは現時点では知られておらず、そのようなサイクルが存在するかどうかも不明です。ただし、サイクルの全ての曲線がペアリング対応である必要がないという制約を緩和することで、この問題を回避できる可能性があります。ペアリング対応曲線が1つだけあれば、SNARKと他の一般的なゼロ知識暗号システムを交互に使って、証明を合成することができます。

適切なサイクルが見つかったと仮定すると、そのサイクルに含まれる全ての曲線をサポートする必要はなく、最も高速なものだけを実装すれば十分です。再帰的SNARKの全体的なセキュリティは、検証に使用される曲線には依存しません。

適切なベンチマークを行い、ガスコストを決定する必要があります。

## テストケース

## 参考文献

* *Eli-Ben-Sasson, Alessandro Chiesa, Eran Tromer, Madars Virza, [BCTV14], April 28, 2015, Scalable Zero Knowledge via Cycles of Elliptic Curves : https://eprint.iacr.org/2014/595.pdf*
* *Alessandro Chiesa, Lynn Chua, Matthew Weidner, [CCW18], November 5, 2018, On cycles of pairing-friendly elliptic curves : https://arxiv.org/pdf/1803.02067.pdf*

## 実装

* [go-boojum](https://github.com/AlexandreBelling/go-boojum) : 再帰的SNARKsの応用デモ
* [libff](https://github.com/scipr-lab/libff) : 有限体と楕円曲線のためのC++ライブラリ
* [coda](https://github.com/CodaProtocol/coda) : 軽量で定数サイズのブロックチェーンを持つ新しい暗号通貨プロトコル

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。