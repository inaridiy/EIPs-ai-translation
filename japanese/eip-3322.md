---
original: 06442705074c0de7f8fb04e036da243d939ab4a561f209a7947ef4d3ddebd096
---

---
eip: 3322
title: アカウントガスストレージオペコード
author: William Morriss (@wjmelements)
discussions-to: https://ethereum-magicians.org/t/eip-3322-efficient-gas-storage/5470
status: 停滞
type: Standards Track
category: Core
created: 2020-03-04
---

## 簡単な要約
コントラクトアカウントがガスを保存し、リファンドカウンターに転送できるようにします。

## 概要
コントラクトはガスを永続化し、後にリファンドカウンターに転送できます。
このガスカウンターを読み取り、追加し、使用するための3つのオペコードが導入されます。

## 動機
現在、リファンドメカニズムはガストークンによってガス価格を仲介するために使用されています。
これにより、需要の少ない ブロックからより需要の高いブロックにガスを移動することで、ガス供給の弾力性とプライスの安定性が生み出されます。
しかし、これは不要な状態の成長を報酬します。
より優れたガスストレージメカニズムを導入することで、ガス市場はより少ないストレージと計算を必要とするようになります。

## 仕様
コントラクトアカウントには、初期値がゼロの符号なしガスリファンドカウンターが追加されます。

このステートを管理するための3つの新しいオペコードが導入されます。

* `SELFGAS` (`0x49`): 現在のアカウントのガスリファンドカウンターをスタックにプッシュします。
`SELFBALANCE`と同じガス価格設定を共有します。
* `USEGAS` (`0x4a`): スタックから`amount`をポップします。
`amount`と現在のアカウントのガスリファンドカウンターの最小値が実行コンテキストのリファンドカウンターに転送されます。
ガス代は`5000`です。
* `STOREGAS` (`0x4b`): スタックから`amount`をポップします。
ガス代は`5000 + amount`です。
現在のアカウントのガスリファンドカウンターを`amount`だけ増加させます。

## 根拠
実行コンテキストのリファンドカウンターを再利用することで、その50%のDoS保護を再利用できます。これにより、ブロックの弾力性への寄与を2倍に制限できます。

ガス代は、類似のオペコード`SELFBALANCE`と`SSTORE`に基づいています。

ほとんどのアカウントはガスを保存しないため、通常の場合、1アカウントあたりのストレージオーバーヘッドは最小限または0になるはずです。

選択されたオペコード番号は、`SELFBALANCE`と`GASLIMIT`と同じ`0x4X`の範囲にあります。

## 下位互換性
ガスがリファンドカウンターに追加されるため、互換性の問題は予想されません。

## テストケース
| コード             | 使用ガス | リファンド | 元々 | 最終 |
|------------------|----------|--------|----------|-------|
| 0x60004900       |     5003 |      0 |        0 |     0 |
| 0x60034900       |     5003 |      2 |        2 |     0 |
| 0x60034900       |     5003 |      3 |        3 |     0 |
| 0x60034900       |     5003 |      3 |        4 |     1 |
| 0x60034960034900 |    10006 |      4 |        4 |     0 |
| 0x60034960034900 |    10006 |      6 |        6 |     0 |
| 0x484900         |     5010 | 100000 |   100000 |     0 |
| 0x61ffff4a00     |    70538 |      0 |        0 | 65535 |


## セキュリティ上の考慮事項
DoSは既に50%のリファンド制限によって制限されています。

## 著作権
著作権およびその関連権利は[CC0](../LICENSE.md)によって放棄されています。