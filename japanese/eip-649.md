---
original: 872333299e089dce315d3ca271d3d9f68237f8aa46e00f95a6fb9cefd5491c6b
---

---
eip: 649
title: メトロポリス難易度爆弾の遅延とブロック報酬の減少
author: Afri Schoedon (@5chdn), Vitalik Buterin (@vbuterin)
discussions-to: https://github.com/ethereum/EIPs/issues/649
type: Standards Track
category: Core
status: Final
created: 2017-06-21
---

## 簡単な要約
ディフィカルティ・ボム（「_氷河期_」とも呼ばれる）が徐々に加速しているため、平均ブロック時間が増加しています。このEIPは、ビザンチウムフォーク（メトロポリスフォークの最初の部分）で、ディフィカルティ・ボムを約1年半遅らせ、ブロック報酬を減少させることを提案しています。

## 概要
`BYZANTIUM_FORK_BLKNUM`以降、クライアントはホームステッドフォークで以前に指定されていたよりも約300万ブロック遅れて、ディフィカルティ・ボムが調整されていると仮定してディフィカルティを計算します。さらに、ブロック報酬は3 ETHの基本報酬に調整され、叔父報酬とネフュー報酬も相応に調整されます。

## 動機
Casperの開発と proof-of-stakeへの移行が遅れているため、Ethashのproof-of-workを使い続けることで、今後1年半ほど平均15秒ごとにブロックを生成できるようにする必要があります。氷河期の遅延に伴い、突然マイナー報酬が増加することを望まない要望があります。ディフィカルティ・ボムについては長らく知られていたため、これを停止させることにしました。システムの安定性を維持するため、氷河期の遅延を相殺するブロック報酬の減少を行うことで、以前と同じ一般的な状態を維持することができます。報酬の減少は、Ethereumがproof-of-stakeに移行する際のマイナー主導のチェーンスプリットの可能性も減らします。

## 仕様
#### 偽のブロック番号を使ってディフィカルティを緩和する
`calc_difficulty`の目的で、指数関数的な氷河期コンポーネントで使用されている`block.number`を、次の式で置き換えます:

    fake_block_number = max(0, block.number - 3_000_000) if block.number >= BYZANTIUM_FORK_BLKNUM else block.number

#### ブロック、叔父、ネフュー報酬を調整する
Ether発行量を一定に保つため、ブロック報酬を`new_block_reward`に調整します。ここで、

    new_block_reward = 3_000_000_000_000_000_000 if block.number >= BYZANTIUM_FORK_BLKNUM else block.reward

(3E18 wei、または3,000,000,000,000,000,000 wei、または3 ETH)。

同様に、`block.number >= BYZANTIUM_FORK_BLKNUM`の場合に、ブロック`block.number - uncle.number = k`の叔父が含まれている場合の叔父報酬は

    new_uncle_reward = (8 - k) * new_block_reward / 8

これは、単に`new_block_reward`を使って調整した、メトロポリス以前の叔父報酬の既存の式です。

`block.number >= BYZANTIUM_FORK_BLKNUM`の場合のネフュー報酬は

    new_nephew_reward = new_block_reward / 32

これは、単に`new_block_reward`を使って調整した、メトロポリス以前のネフュー報酬の既存の式です。

## 根拠
これにより、氷河期が約4200万秒(約1.4年)遅延するため、2018年末までにブロック時間が30秒に戻ります。別の提案は、ディフィカルティ計算に特別なルールを追加して、実質的に異なるブロック間でディフィカルティを「一時停止」することでした。これは同様の結果をもたらします。

これは以前、All Core Devs Meeting [#09](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%209.md#metropolis-timing-and-roadmap-discussion)、[#12](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2012.md#5-metropolis-update)、[#13](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2013.md#3-eip-186-reduce-eth-issuance-before-proof-of-stake-hudson)、[#14](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2014.md#1-eip-186-reduce-eth-issuance-before-proof-of-stake-core-devs)で議論されました。仕様の合意は、All Core Devs Meeting [#19](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2019.md)で達成され、EIPイシュー[#649](https://github.com/ethereum/EIPs/issues/649)で仕様が起草されました。All Core Devs Meeting [#20](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2020.md)と[#21](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2021.md)で、EIP [#186](https://github.com/ethereum/EIPs/issues/186)を置き換え、ディフィカルティ・ボムの遅延とブロック報酬の減少を組み合わせることが決定され、[#22](https://github.com/ethereum/pm/blob/master/AllCoreDevs-Meetings/Meeting%2022.md)で承認されました。

## 下位互換性
このEIPは前方互換性がなく、ディフィカルティ計算、ブロック報酬、叔父報酬、ネフュー報酬の構造に下位互換性の問題を導入します。したがって、特定のブロック番号でスケジュールされたハードフォークに含める必要があります。このEIPをメトロポリスの最初のハードフォーク、_ビザンチウム_フォークに含めることが提案されています。

## テストケース
テストケースは ethereum/tests [#269](https://github.com/ethereum/tests/pull/269)にあります。

## 実装
以下のクライアントがEIP-649を実装しています:

- Geth [#15028](https://github.com/ethereum/go-ethereum/pull/15028)
- Parity [#5855](https://github.com/paritytech/parity/pull/5855)
- EthereumJ [#927](https://github.com/ethereum/ethereumj/pull/927)
- Cpp-Ethereum [#4050](https://github.com/ethereum/cpp-ethereum/issues/4050)
- PyEthereum [#383](https://github.com/ethereum/pyethereum/pull/383)

Yellow Paperは[#333](https://github.com/ethereum/yellowpaper/pull/333)でEIP-649を実装しています。

その他の重要な実装:

- Eth-Isabelle [#459](https://github.com/pirapira/eth-isabelle/issues/459)
- Py-EVM [#123](https://github.com/ethereum/py-evm/pull/123)

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。