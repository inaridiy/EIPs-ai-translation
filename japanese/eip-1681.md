---
original: ea7fd200c7deef571e245e14fa320b4cb871eb707773c5ec4a9327c46aba2375
---

---
eip: 1681
title: 時間的リプレイ保護
author: Martin Holst Swende (@holiman)
discussions-to: https://ethereum-magicians.org/t/temporal-replay-protection/2355
status: 停滞
type: Standards Track
category: Core
created: 2019-01-08
---

## 簡単な要約

このEIPは、`valid-until`タイムスタンプの形式で、トランザクションに「時間的」リプレイ保護を追加することを提案しています。
このEIPは、Nick JohnsonとKonrad Feldmeierによる https://github.com/ethereum/EIPs/pull/599 に非常に似ていますが、主な違いは、このEIPがブロック番号ではなく、クロック時間/壁時間に基づいていることです。

## 動機

時間ベースのトランザクション有効期限を導入するには、いくつかの異なる動機があります。

- ダスト・アカウントのクリアリングが導入された場合(例: https://github.com/ethereum/EIPs/issues/168)、リプレイ保護を導入する必要があります(例: https://github.com/ethereum/EIPs/issues/169)。時間ベースのリプレイ保護を導入すれば、状態のnonce動作を変更する必要がなくなります。なぜなら、トランザクションはユーザーが明示的に設定した日付以降は再生できないからです。
- ICOなどの場合、多くの人がトランザクションを数時間以内に含めるか、まったく含めないことを望んでいます。現在、トランザクションはキューに入り、数日後に実行される可能性があり、ユーザー(失敗した購入のためにガスを支払うことになる)とネットワーク(大きなトランザクションキューを処理する)の両方にコストがかかります。
- ノード実装には、どのトランザクションを保持、破棄、または伝播するかについての共通の指標がありません。トランザクションにTTLがあれば、システムから古いトランザクションを削除しやすくなります。

## 仕様

ロールアウトは2つのフェーズ、`X`(ハードフォーク)と`Y`(ソフトフォーク)で行われます。

ブロック`X`で、

- RLP符号化されたトランザクションに、`uint64`型(同じく`nonce`)の`valid-until`フィールドを追加します。
- トランザクション`t`にこのフィールドが存在する場合、
  - `t`は`block.timestamp` < `t.valid-until`の場合にのみ、ブロックに含めることができます。

ブロック`Y`で、
- `valid-until`を必須とし、`valid-until`のないトランザクションは無効とみなします。

## 根拠

### このEIPの根拠

ダスト・アカウントのクリアリングのユースケースについて、
- この変更はコンセンサスエンジンに大きな影響を与えません。
  - 「最高既知のnonce」を維持したり、ブロック内のセンダーからのトランザクション数を制限する必要がありません。
  - コンセンサスエンジンのトランザクション検証部分のみに影響します。
  - `nonce`を使う他のスキーマには意図しない副作用があります。
    - 特定のアドレスでコントラクトを作成できなくなる可能性があります。
    - オフラインの署名者と統合するのがより難しくなります。より複雑なnonce方式では状態アクセスが必要になるためです。
    - `highest-nonce`のような複雑なスキームはずっと難しいです。なぜなら、highest-known-nonceはトランザクション実行中に増分および巻き戻される可能性のあるコンセンサス構造であり、さらに1つの記録フィールドが必要になるためです。

### 壁時間の根拠

なぜブロック番号ではなくUTC時間を使うのでしょうか(https://github.com/ethereum/EIPs/pull/599 で提案されているように)?

- UTCは、ほとんどの環境で利用可能です。つまり、ブロックチェーン情報が利用できない環境でも、トランザクションに所望の特性を持たせることができます。
- 時間とブロック番号の相関関係は固定されていません。14秒のブロック時間が「望ましい」とされていますが、ネットワークのハッシュレートと難易度爆弾の進行により変動します。
- テストネットや非公開ネットワークでは、ブロック番号がタイムスタンプとして信頼できません。
- UTCは、ユーザーにとってより使いやすいです。ユーザーは、妥当な有効期限を決めやすくなります。

## 下位互換性

このEIPにより、トランザクションを作成するすべてのソフトウェア/ハードウェアがトランザクションにタイムスタンプを追加する必要があるか、ブロック`Y`以降はトランザクションに署名できなくなります。注意: このEIPには`valid-until`の最大日付は設定されていないため、ほぼ無限の有効期限のトランザクションを作成することができます。

## テストケース

todo

## 実装

まだありません

## セキュリティ上の考慮事項

最も重要なセキュリティ上の影響は、ブロック`Y`以降、紙のバックアップに保存されたプリサインドトランザクションが無効になることです。これが使われる可能性のあるケースは以下のとおりです。
   - ユーザーをEthereumに導入するための、ワンタイムの「ブートストラップ」トランザクションの事前生成。ユーザーにギフトカードでイーサを与える代わりに、ユーザーが実際に使い始めたい時にのみそのイーサを送信するプリサインドトランザクションを与えることがあります。
   - ユーザーがオフラインのペーパーウォレットを持っている場合、取引所などに価値を送信するためのプリサインドトランザクションを持っている可能性があります。これは、ペーパーウォレットを「生き返らせる」ための手順を踏まずにイーサを送信できるようにするためです。

二次的なセキュリティ上の影響は、タイムスタンプの追加によりトランザクションがわずかに大きくなることです。

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。