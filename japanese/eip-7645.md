---
original: 1d9b5a31d56bed687bd2d627cba30080d9d234fa04d91e7abf852c053ddbe555
---

---
eip: 7645
title: ORIGIN を SENDER にエイリアス化する
description: アカウントアブストラクションの基盤を整え、セキュリティホールを解消するために ORIGIN の技術的負債を解消する
author: Cyrus Adkisson (@cyrusadkisson), Eirik Ulversøy (@EirikUlversoy)
discussions-to: https://ethereum-magicians.org/t/eip-7645-alias-origin-to-sender/19047
status: Draft
type: Standards Track
category: Core
created: 2024-03-03
---

## 概要

このEIPは、Ethereum Virtual Machine (EVM) 内の ORIGIN オペコードを SENDER オペコードにエイリアス化することを提案しています。この変更の目的は、外部所有アカウント (EOA) とスマートコントラクトの扱いを調和させることで、アカウントアブストラクションを実現するための基盤を整え、ORIGIN の使用に関連するセキュリティ上の懸念に対処することです。

## 動機

Ethereum の ORIGIN オペコードは、トランザクションチェーンを開始したアカウントのアドレスを返します。これは SENDER (または CALLER) オペコードが直接の呼び出し元のアドレスを返すのとは異なります。ORIGIN の使用は、フィッシング攻撃や、元の送信者と直接の送信者の区別を悪用できる他の脆弱性などのセキュリティ上の問題を引き起こすため、2016年半ばから非推奨とされています。

例えば、[ERC-4337](./eip-4337.md) のバンドラーがスマートコントラクト内のトークンや権限を ORIGIN で決定している場合、バンドラーがバンドルするトランザクションのいずれかによって、この権限を乗っ取られる可能性があります。

現在のEVM進化の文脈でより適切に言えば、ORIGIN と SENDER オペコードの違いは、[EIP-7377](./eip-7377.md) や [EIP-3074](./eip-3074.md) などのアカウントアブストラクションの取り組みすべてに課題を提示しています。なぜなら、アカウントアブストラクションに向けた移行では、ORIGIN オペコードの役割に取り組む必要があるからです。これに取り組まなければ、ORIGIN オペコードはEthereum のアカウントモデルをより柔軟で機能的なものに進化させる障害となります。

## 仕様

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"NOT RECOMMENDED"、"MAY"、"OPTIONAL" は、RFC 2119 およびRFC 8174に記載されている通りに解釈されるものとします。

このEIPは、Ethereum Virtual Machine (EVM) 内の ORIGIN オペコードの動作を変更することを提案しています。現在、ORIGIN オペコードは元のトランザクション開始者のアドレスを返します。このEIPの下では、ORIGIN オペコードは代わりに、メッセージやトランザクションの直接の送信者のアドレスを返す SENDER (別名 CALLER) オペコードと同じ値を返すようになります。

定義の変更: ORIGIN オペコード (0x32) は、実行の全コンテキストにおいて、SENDER (別名 CALLER) オペコード (0x33) が返す値と同じ値を返さなければなりません (MUST)。

EVM実装: すべてのEthereum クライアントは、以下の変更をEVMに実装しなければなりません (MUST): ORIGIN オペコードが呼び出されるたびに、スタックにプッシュされる値は、SENDER オペコードが実行された場合と同じ、現在のコールの送信者アドレスでなければなりません。

トランザクション検証: トランザクションは、上記のEVMオペコードの動作以外は、従来どおりに検証されなければなりません。

互換性: ORIGIN オペコードを使ってトランザクション開始者のアドレスを取得しているスマートコントラクトは、新しい定義の下で正しく機能するよう見直す必要があります。破壊的な変更が生じる場合は、回避策を講じる必要があります。

実装者は、この仕様についてフィードバックを提供し、実装や試験の過程で発生する可能性のある問題を報告することが推奨されます。

## 根拠

ORIGIN を SENDER にエイリアス化する根拠は以下の通りです:

アカウントアブストラクションの促進: アカウントアブストラクションの普遍的な障壁を巧みに解消し、Ethereumでより柔軟で強力なアカウントモデルを実現できるようにする。

セキュリティの向上: 元のトランザクション開始者と直接の呼び出し元を区別することに関連するセキュリティ上の脆弱性を排除する。

技術的負債の清算と EVM モデルの簡素化: 時代遅れで非推奨の機能を削除することで、EVM のトランザクションおよび実行モデルの複雑さを軽減し、将来の変更をより容易かつ安全にする。

## 下位互換性

この変更は完全な下位互換性を持ちません。ORIGIN と SENDER の違いを論理や安全性のために使用しているコントラクトに影響があります。しかし、ORIGIN の使用が長年にわたって非推奨とされてきたこと、変更の影響が最小限であること、EVM でのアカウントアブストラクション実現への強い要望があること、そして最終的にはどのようなアカウントアブストラクション (AA) ソリューションでも ORIGIN に取り組む必要があることを考えると、この非互換性は Ethereum の発展のために必要な一歩と考えられます。

下位互換性の問題は見つかりませんでした。

## テストケース

CALL、STATICCALL、DELEGATECALL、CALLCODE それぞれについて:

直接呼び出し - ターゲットのスマートコントラクトにおいて、ORIGIN と SENDER が同じ値を生成することを確認する。(単純なEOA-to-EOA/SCAトランザクションでは、現在もこの動作となっている。)

マルチホップ - マルチホップトランザクションの各フレームにおいて、ORIGIN と SENDER が同じ値を生成することを確認する。

## セキュリティ上の考慮事項

ORIGIN を SENDER にエイリアス化することで、ORIGIN オペコードに関連する特定のセキュリティ上の脆弱性が解消されます。このEIPの範囲外ではありますが、ORIGIN の使用をすべて禁止することで、さらなる誤解や誤用を排除することも賢明かもしれません。これは、EVMの外部でツールの変更を行うことで実現できますし、EVMの内部で、ORIGIN を使用するスマートコントラクトのデプロイを拒否することでも実現できます。

ORIGIN の問題のある使用例で、この SENDER へのエイリアス化の影響を受けるものについては (明確な例はまだ特定されていませんが)、ユーザーに対してこの問題のある従来のコードを避けるよう教育する必要があるかもしれません。

## 著作権

著作権およびそれに関連する権利は [CC0](../LICENSE.md) で放棄されています。