---
original: 3cf77257df534b73371183b02cbacdde293bc10a4b976f9cef08be6b0c6e5409
---

---
eip: 1380
title: 自己への呼び出しのガスコストの削減
author: Alex Beregszaszi (@axic), Jacques Wagener (@jacqueswww)
discussions-to: https://ethereum-magicians.org/t/eip-1380-reduced-gas-cost-for-call-to-self/1242
status: 停滞
type: Standards Track
category: Core
created: 2018-08-31
requires: 150
---

## 概要

現在のコントラクトをインスタンス化するための呼び出し命令のガスコストを削減する。

## 動機

`CALL`、`DELEGATECALL`、`CALLCODE`、`STATICCALL`の全ての呼び出しタイプに対する700ガスのコストは、現在のコントラクトコードがメモリにすでにロードされているため、追加のI/Oオペレーションを実行する必要がないことを考慮していない。

自己への呼び出しのガスコストを削減することで、SolidityやVyperなどのスマートコントラクト言語が内部関数呼び出しに`CALL`オペコードを使用できるようになり、大きな恩恵を受けることができる。言語は既に内部関数呼び出しに`CALL`を使用できるが、それに伴うガスコストのため、使用を控えている。

`JUMP`オペコードを使用すると、スマートコントラクト言語やコンパイラの実装が複雑になる。呼び出し関数のコンテキスト(スタックやメモリを含む)を入れ替える必要がある。*純粋*な関数(メモリの状態を変更しない関数)を持つことが望ましい機能であり、`JUMP`を使用してそれを実現するには、コンパイラにとってより大きな努力が必要となる。一方、`CALL`を使用できるようになれば、その問題は解決される。

自己への呼び出しを使用すると、内部関数呼び出しの際にメモリやコンテキストの状態がクリアされることが保証されるため、コントラクト作成者とコントラクト利用者の両方にとって、潜在的な端末ケースを検出しやすくなる。

内部関数呼び出しに`JUMP`を使用することで、多数の入出力を持つ入れ子の関数呼び出しが必要な場合、スタックの深さ制限に早期に到達するリスクがある。

ガスコストを削減し、内部関数実装に`JUMP`ではなく自己への呼び出しを使用することを奨励することで、静的解析ツールやトレーサーにも恩恵がある。

## 仕様

`block.number >= FORK_BLKNUM`の場合、呼び出し先のアドレスが呼び出し元のアドレスと等しい場合に限り、`CALL`、`DELEGATECALL`、`CALLCODE`、`STATICCALL`のコストを700から40に減らす。

## 根拠

EIP150では、新しいコントラクトをディスクからロードするコストをより適切に反映するため、これらの命令のコストを40から700に引き上げた。660ガスがディスクからのコントラクトロードコストであると仮定すれば、元の40ガスは既にロードされたコントラクトコードの新しいVM インスタンスを作成するための適切なコストであると考えられる。

## 下位互換性

これは下位互換性に問題を引き起こすことはない。現在存在するコントラクトは違いを感じることはなく、単に実行コストが安くなるだけである。EIP150以降、ガスコストに厳密に依存することは適切ではないことを開発者は学んでいる。このEIPの影響はEIP150よりも小さいため、コストが上がるのではなく下がるという点で、さらに問題はない。

## テストケース

TBA

## 実装

TBA

## 著作権

[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。