---
original: e5ffb70b17636be3ac573ade6383a305016d35c8b7ea49d966c546753e05f4f6
---

---
eip: 6914
title: 引き退いたバリデータインデックスの再利用
description: 完全に引き退いて再利用が安全なバリデータインデックスを新しいビーコンチェーンデポジットに再利用する。
author: Lion (@dapplion), Danny Ryan (@djrtwo)
discussions-to: https://ethereum-magicians.org/t/eip-6914-reuse-withdrawn-validator-indices/15253
status: 停滞
type: Standards Track
category: Core
created: 2023-04-19
---

## 概要

バリデータセットの入れ替わりに伴い、ビーコンチェーンバリデータリストの無制限の成長を排除するため、十分な安全期間が経過した後、完全に引き退いたバリデータインデックスを再利用する。

## 動機

ビーコンチェーンは、バリデータのリストと各バリデータの残高リストを維持しています。新しいバリデータのデポジットが発生した場合、現在のメカニズムでは、以前に完全に引き退いたバリデータインデックスを再利用するのではなく、単に追加するだけです。バリデータが完全に引き退き、新しいバリデータが参入するにつれ、これらの2つのリストは無制限に成長していきます。

この仕様では、安全に行うことができる場合にバリデータインデックスを再利用することを可能にし、無制限のバリデータリスト成長の懸念を解消します。

## 仕様

### コンセンサスレイヤー

この仕様の設定値とメカニズムは、[コンセンサスレイヤー仕様](https://github.com/ethereum/consensus-specs/blob/1a38b83e5db8638ee01c9461cccf11e7d8a3ebce/specs/_features/eip6914)に記載されています。

バリデータインデックスは、バリデータが完全に引き退き、かつ十分な安全期間が経過した場合にのみ再利用されることに注意してください。

### 実行レイヤー

この仕様では、実行レイヤーへの変更は必要ありません。

## 根拠

現在、新しいデポジットが発生するたびに、`validators`と`balances`リストに追加されています。長期的な視点で見ると、ステーカーの参入と退出の自然な仕組みにより、これらのリストとそのステートサイズは無制限に成長していきます。

ステートサイズの増加は、クライアント実装における負荷や複雑さを表します。これには、クライアントのメモリフットプリント、ステートルート計算、バリデータセットのスキャンなどが含まれます。この状態遷移内の比較的単純なクリーンアップにより、それ以外の場合の無制限のリストによる不要な負荷と複雑さを防ぐことができます。

## 下位互換性

これはイーサリアムのコンセンサスレイヤーに対する下位互換性のない変更であり、ハードフォークを通じてスケジュールする必要があります。

実行レイヤーとの前方/後方互換性の問題はありません。

## テストケース

テストケースは、標準的なコンセンサスレイヤーテストの中で作業中です。

## セキュリティ上の考慮事項

バリデータインデックスは即座に再利用できるわけではなく、少なくとも弱い主観性期間の間、アテステーションが「汚染」されないことを確認するために、`SAFE_EPOCHS_TO_REUSE_INDEX`エポック待つ必要があります。

アテステーション汚染攻撃は、以下の2つの事実に依存しています:

* バリデータインデックスの再利用により、ビーコンステートの以前のバリデータの公開鍵が上書きされる。
* `AttesterSlashing`には、署名参加者を再構築するためにバリデータインデックスが含まれる。

### 攻撃の詳細

1/3の攻撃者を想定します。攻撃者は、バリデータセットの小さな割合であるN人のバリデータを正直なチェーンから退出させます。これらのバリデータは退出キューから離れ、数日以内に引き出し可能になります。次にN人の新しいデポジットが入り、バリデータとそれらの公開鍵を上書きします。

攻撃者は次に、N人のバリデータが退出・引き出されていない攻撃者チェーンを構築します。Nは十分に大きいため、平均して攻撃者チェーンのすべての委員会に少なくとも1人のNキーが含まれます。攻撃者は二重署名を試みて攻撃者チェーンを確定させますが、N人のキーの1つが悪意のある集計アテステーションに混ざるようにします - 個々のアテステーションは利用できず、集計のみが利用可能です。これらの悪意のあるアテステーションは、`AttesterSlashing`がバリデータインデックスを特定の公開鍵にマッピングすることを前提としているため、正直なチェーンには含められません。

### 緩和策

`SAFE_EPOCHS_TO_REUSE_INDEX`エポック(最大の弱い主観性期間の3倍)、引き退いたバリデータを上書きしないことで、説明責任のある安全性のセキュリティウィンドウ内でアテステーションが汚染されないことを確認できます。

### 代替案

`AttesterSlashing`がバリデータインデックスではなく公開鍵のリストを含む場合、この問題は発生しません。ただし、これにはより大きな変更が必要で、`AttesterSlashing`、つまりコンセンサスレイヤーの最大のデータ型のデータ要件が6倍増加します。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。