---
original: cf23c5802556ed3c7c5a9023734728b1790c404cab9b922b25ea3fd356e14af5
---

---
eip: 6046
title: SELFDESTRUCTをDEACTIVATEに置き換える
description: SELFDESTRUCTを変更して、ストレージキーを削除せず、アカウントのノンスに特別な値を使ってアクティブ化を解除する
author: Alex Beregszaszi (@axic)
discussions-to: https://ethereum-magicians.org/t/almost-self-destructing-selfdestruct-deactivate/11886
status: 停滞
type: Standards Track
category: Core
created: 2022-11-25
requires: 2681, 2929, 3529
---

## 概要

`SELFDESTRUCT`を変更して、すべてのストレージキーを削除せず、アカウントのノンスに特別な値を使って*アクティブ化解除*されたアカウントを示すようにします。復活のセマンティクスが変わる(ストレージキーが存在し続ける可能性がある)ため、命令名も`DEACTIVATE`に変更します。

## 動機

現在の`SELFDESTRUCT`命令は固定価格ですが、ストレージ/アカウントの変更の数に制限がありません(すべてのキーを削除する必要があります)。これは長年の懸念事項でした。

さらに、*Verkle trees*を使うと、アカウントの構造が異なります。アカウントのプロパティ(ストレージを含む)は個別のキーを持つようになります。使用されているすべてのキーを探索して見つけるのは不可能になります。これにより、Verkle treesでの`SELFDESTRUCT`のサポートが非常に困難になります。

## 仕様

1. [EIP-2681](./eip-2681.md)で導入されたルールを変更し、通常のノンス増加が`2^64-1`ではなく`2^64-2`で制限されるようにします。これはジェネシスから適用されます。

2. `SELFDESTRUCT`の動作を以下のように変更します:

  - ストレージキーを削除せず、アカウントも残します。
  - アカウントの残高を転送し、アカウントの残高を`0`に設定します。
  - アカウントのノンスを`2^64-1`に設定します。
  - [EIP-3529](./eip-3529.md)により、払い戻しは行われません。
  - [EIP-2929](./eip-2929.md)の`SELFDESTRUCT`に関するルールは変更されません。

3. アカウントの実行(外部トランザクションやCALL*命令によってトリガーされる)を変更し、ノンスが`2^64-1`の場合、実行が成功し、空のバッファを返すようにします。

  - アカウントは、コインベースのトランザクションや他の`SELFDESTRUCT`などの実行可能でない値転送を受け取ることができます。

4. `CREATE2`を変更し、ノンスが`2^64-1`の場合でもアカウントの作成を許可するようにします。

  - アカウント(特にコードとストレージ)は、`CREATE2`の前から空ではない可能性があります。
  - 成功した`CREATE2`はアカウントのコード、ノンス、および場合によっては残高を変更します。

5. `SELFDESTRUCT`命令の名称を`DEACTIVATE`に変更します。「アカウントの復活」のセマンティクスが変更されるためです。古いストレージアイテムは残り、新しくデプロイされたコードはこれを認識する必要があります。

## 根拠

`SELFDESTRUCT`を削除する様々な提案がありましたが、多くはデリーション機能を完全に削除してしまいます。これは特定の使用パターンを壊してしまいます。*アクティブ化解除*オプションはこれを残しつつ、わずかな変更を加えます。これは*新しく*デプロイされたコードにのみ影響し、既存のコードには影響しません。

すべての提案でデータがステートに残りますが、この提案では、復活したコントラクトが必要に応じてストレージスロットを個別に再利用または削除できる柔軟性を提供します。

## 下位互換性

このEIPはコンセンサスルールを変更するため、プロトコルアップグレードが必要です。ノンスのさらなる制限は、`2^64-2`が非現実的に高い制限であるため、アカウントに影響を与えるべきではありません。

復活パターンを使うコントラクトは引き続き機能しますが、復活時にデプロイされるコードは、ストレージキーがすでにアカウントに存在する可能性があることを認識する必要があります。

## セキュリティ上の考慮事項

ストレージの保持という新しい動作は、セキュリティに影響を与える可能性があります。コントラクト作成者は注意を払い、コントラクトを適切に設計する必要があります。自律的な破壊と復活を行う既存のデプロイ済みコードにも影響がある可能性があります。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。