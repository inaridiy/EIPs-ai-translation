---
original: 283af272148eb597d931cb58bd3a64e8573c781f90448ff38a7eeea4ef2c9a26
---

---
eip: 2
title: Homestead Hard-fork Changes
author: Vitalik Buterin (@vbuterin)
status: Final
type: Standards Track
category: Core
created: 2015-11-15
---

### メタ参照

[Homestead](./eip-606.md)。

### パラメータ

|   FORK_BLKNUM   | CHAIN_NAME  |
|-----------------|-------------|
|    1,150,000    | Main net    |
|   494,000       | Morden      |
|    0            | Future testnets    |

# 仕様

`block.number >= HOMESTEAD_FORK_BLKNUM`の場合、以下を行います:

1. *トランザクションによるコントラクト作成*のガスコストが21,000から53,000に増加します。つまり、トランザクションを送信し、宛先アドレスが空の場合、現在の21,000ではなく、トランザクションデータのガスコストに加えて53,000が差し引かれます。`CREATE`オペコードを使ってコントラクトから作成されるコントラクトは影響を受けません。
2. s値が`secp256k1n/2`より大きいすべてのトランザクション署名が無効とみなされます。ECDSA回復プリコンパイルドコントラクトは変更されず、高いs値を引き続き受け入れます。これは、コントラクトがBitcoinの古い署名を回復する場合に役立ちます。
3. コントラクト作成に最終ガス料金を支払うのに十分なガスがない場合、コントラクト作成は失敗します(つまりガス切れ)。空のコントラクトが残されることはありません。
4. 現在の難易度調整アルゴリズム `block_diff = parent_diff + parent_diff // 2048 * (1 if block_timestamp - parent_timestamp < 13 else -1) + int(2**((block.number // 100000) - 2))` (ここで `int(2**((block.number // 100000) - 2))` は指数関数的な難易度調整コンポーネントを表す) を `block_diff = parent_diff + parent_diff // 2048 * max(1 - (block_timestamp - parent_timestamp) // 10, -99) + int(2**((block.number // 100000) - 2))` に変更します。ここで `//` は整数除算演算子で、例えば `6 // 2 = 3`、`7 // 2 = 3`、`8 // 2 = 4`です。`minDifficulty`は引き続き許可される最小の難易度を定義し、調整によってこれを下回ることはありません。

# 根拠

現在、トランザクションによるコントラクト作成のコストが21,000であるのに対し、コントラクトによるコントラクト作成のコストが32,000と過剰なインセンティブがあります。さらに、自殺リファンドを利用すると、わずか11,664ガスでイーサ値の単純な転送を行うことができます。この方法のコードは以下の通りです:

```python
from ethereum import tester as t
> from ethereum import utils
> s = t.state()
> c = s.abi_contract('def init():\n suicide(0x47e25df8822538a8596b28c637896b4d143c351e)', endowment=10**15)
> s.block.get_receipts()[-1].gas_used
11664
> s.block.get_balance(utils.normalize_address(0x47e25df8822538a8596b28c637896b4d143c351e))
1000000000000000
```
これは深刻な問題ではありませんが、バグと見なすことができます。

現在のように、`0 < s < secp256k1n`のすべてのトランザクションを許可すると、トランザクション可変性の懸念が生じます。つまり、任意のトランザクションを取り、sの値を`s`から`secp256k1n - s`に反転し、vの値(`27 -> 28`、`28 -> 27`)を反転させても、結果の署名は依然として有効になります。これは深刻なセキュリティ上の欠陥ではありませんが、特にイーサ値の転送やその他のトランザクションの入力にアドレスではなくトランザクションハッシュを使用するユーザーインターフェイスが混乱する可能性があります。高いs値を防ぐことでこの問題が解決されます。

最終ガス料金を支払うのに十分なガスがない場合、コントラクト作成がガス切れになるようにすることには以下の利点があります:
- (i) コントラクト作成プロセスの結果が「成功または失敗」という、より直感的な区別になります。現在の「成功、失敗、または空のコントラクト」という3つの選択肢ではありません。
- (ii) 失敗をより簡単に検出できるようになります。コントラクト作成が完全に成功しない限り、コントラクトアカウントは一切作成されません。
- (iii) エンドウメントがある場合のコントラクト作成がより安全になります。プロセス全体が実行されるか、トランザクションが失敗してエンドウメントが返金されることが保証されます。

難易度調整の変更は、2か月前にイーサリアムプロトコルが経験した問題を決定的に解決します。当時、多数のマイナーが`parent_timestamp + 1`と等しいタイムスタンプのブロックを採掘していました。これにより、ブロックタイムの分布が歪み、現在のブロックタイムアルゴリズムが*中央値*13秒を目標としていたにもかかわらず、平均値が増加し続けていました。51%のマイナーがこの方法でブロックを採掘し始めた場合、平均値は無限大に増加していたでしょう。提案された新しい式は概ね平均値を目標としています。この式を使えば、長期的に平均ブロックタイムが24秒を超えることは数学的に不可能です。

`(block_timestamp - parent_timestamp) // 10`を主要な入力変数として使うのは、アルゴリズムの粗い粒度を維持するためです。これにより、わずかに高い難易度のブロックを生成するために、わざと時間差を1に設定するインセンティブが過度に高まるのを防ぎます。-99の上限は、クライアントのセキュリティバグやその他の予期せぬ事態により、2つのブロックが非常に離れた時間に生成された場合でも、難易度が極端に低下しないようにするためです。

# 実装

これはPythonで以下のように実装されています:

1. https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L130
2. https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L129
3. https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L304
4. https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/blocks.py#L42