---
original: c6a08cc1bbdf0660b5889ce5dc85ad3dab340594c83e83023679fa27b4a5e9d5
---

---
eip: 4488
title: トランザクションコールデータガスコスト削減と総コールデータ制限
description: トランザクションコールデータのガスコストを大幅に削減し、同時にブロック内の総トランザクションコールデータを制限する
author: Vitalik Buterin (@vbuterin), Ansgar Dietrichs (@adietrichs)
discussions-to: https://ethereum-magicians.org/t/eip-4488-transaction-calldata-gas-cost-reduction-with-total-calldata-limit/7555
type: Standards Track
category: Core
status: Stagnant
created: 2021-11-23
---

## 概要

トランザクションコールデータのガスコストを削減し、ブロック内の総トランザクションコールデータの上限を設ける。

## 動機

ロールアップは短期的にも中期的にも、そして長期的にも、Ethereumの唯一の信頼できるスケーリングソリューションです。L1のトランザクション手数料は数か月間非常に高く、ロールアップへのエコシステム全体の移行を促進するために必要なことを行うことが緊急の課題となっています。ロールアップは多くのEthereum利用者の手数料を大幅に削減しています: Optimismとarbitrumは、Ethereumのベースレイヤーよりも手数料が3-8倍低く、署名を含まないことができるZKロールアップは、ベースレイヤーよりも手数料が40-100倍低くなっています。

しかし、これらの手数料でも多くのユーザーにとって高すぎます。ロールアップだけでは長期的に不十分であるという長期的な解決策は常に[データシャーディング](https://github.com/ethereum/consensus-specs#sharding)でした。これにより、ロールアップ用に専用のデータスペースが1-2MB/secほど追加されます。しかし、データシャーディングの実装と展開にはまだ相当の時間がかかります。したがって、ロールアップのコストをさらに削減し、ロールアップ中心のEthereumへのエコシステム全体の移行を奨励するための短期的な解決策が求められています。

このEIPは迅速に実装できる短期的な解決策を提示し、同時にセキュリティリスクを軽減します。

## 仕様

| パラメータ | 値 |
| - | - |
| `NEW_CALLDATA_GAS_COST` | `3` |
| `BASE_MAX_CALLDATA_PER_BLOCK` | `1,048,576` |
| `CALLDATA_PER_TX_STIPEND` | `300` |

トランザクションコールデータのガスコストを、ゼロバイトでも非ゼロバイトでも、`NEW_CALLDATA_GAS_COST`に削減する。

ブロックが有効であるためには、`sum(len(tx.calldata) for tx in block.txs) <= BASE_MAX_CALLDATA_PER_BLOCK + len(block.txs) * CALLDATA_PER_TX_STIPEND`を満たす必要があるというルールを追加する。

## 根拠

自然な代替案は、上限を設けずに`NEW_CALLDATA_GAS_COST`を下げることです。しかし、これにはセキュリティ上の懸念があります。現在、平均ブロックサイズは[60-90 kB](https://etherscan.io/chart/blocksize)ですが、_最大_ブロックサイズは`30M / 16 = 1,875,000`バイト(ブロックとトランザクションのオーバーヘッドを含めると約1キロバイト)です。単にコールデータガスコストを16から3に下げると、最大ブロックサイズが10Mバイトに増加してしまいます。これにより、Ethereumのp2pネットワーキングレイヤーに前例のない負荷がかかり、ネットワークが破壊される可能性があります。数年前に行われた約500 kBのブロックのライブテストでも、いくつかのブートストラップノードが停止していました。

コストを下げつつ上限を設けるという提案は、上限が1.5MBと十分であれば、ロールアップがEthereumのブロックスペースを短期的に支配することはないため、コストを下げる効果の大部分を達成しつつ、セキュリティリスクの大部分を回避することができます。

歴史的に、Ethereumプロトコルコミュニティは、ガスとコールデータといった複数の資源制限ルールに懐疑的でした。そのようなルールにより、提案者(現在のマイナー、マージ後のバリデーター)が解決しなければならないブロックパッキング問題の複雑性が大幅に増加するためです。現在、提案者は単に手数料の優先順位の高い順にトランザクションを選択するだけで、ほぼ最適な手数料収益を生成できます。しかし、複数の次元がある場合、提案者は複数の制約に対処しなければなりません。多次元ナップサック問題は、単一次元の問題に比べてはるかに複雑で、プールが構築した最適化された独自の実装は、デフォルトのオープンソース実装よりも優れている可能性があります。

しかし、今日では次の2つの主な理由により、これほど問題ではなくなっています:

1. [EIP-1559](./eip-1559.md)により、ほとんどの場合、提案者が解決しなければならない問題はナップサック問題ではありません。むしろ、提案者は単に十分なベースフィーとプライオリティフィーを持つすべてのトランザクションを含めるだけです。したがって、単純なアルゴリズムでも頻繁に最適に近い結果を生成することができます。
2. マイナー抽出可能価値(MEV)抽出のための洗練された独自の戦略の存在により、分散型の最適なブロック生成は中長期的に見て既に不可能になっています。代わりに、ブロックボディの生成という専門化しやすい作業をバリデーターの役割から分離する解決策(「提案者/ビルダー分離」)に研究が向けられています。2次元のナップサック問題は、単なる「別のMEVの機会」にすぎません。

したがって、複数次元の資源制限に対する歴史的な反対を再考し、セキュリティを維持しつつ適度なスケーラビリティの向上を達成する実用的な方法として検討する価値があります。

さらに、スティペンド機構により、2次元の最適化問題がさらに問題にならなくなります。すべてのトランザクションの90%([サンプル](../assets/eip-4488/gas_and_calldata_sample.csv)は`13500000, 13501000 ... 13529000`ブロックから取得)がコールデータ300バイト未満です。したがって、提案者が作成しているブロックのコールデータを過剰に埋めてしまった場合でも、提案者はメモリプールの90%のトランザクションを引き続き追加することができます。

## 下位互換性

これは、スケジュールされたネットワークアップグレードを必要とする下位互換性のないガス再価格付けです。

ユーザーは変更を加えることなく引き続き操作できます。

マイナーは、ブロックの総コールデータサイズが最大値に達したら新しいトランザクションの追加を停止するというルール以外は、変更を加える必要はありません。ただし、そのような場合に収益をより最適化するためのヒューリスティックを追加することができます。例えば、ブロックがサイズ制限に達した場合、最後のデータ量の多いトランザクションを削除し、できるだけデータ量の少ないトランザクションを追加し直すといったことです。

## セキュリティ上の考慮事項

この提案の結果、チェーンの_バースト_データ容量は増加しません(実際にはわずかに減少します)。しかし、_平均_データ容量は増加します。これは、履歴保存のストレージ要件が増加することを意味します。最悪のシナリオでは、理論上の長期最大値が約1,262,861バイト/12秒スロット、つまり年間約3.0TBになる可能性があります。

この リスクを軽減するために、このEIPと同時か、すぐ後に[EIP-4444](./eip-4444.md)またはそれに似た履歴期限切れの提案を実装することをお勧めします。

## 著作権

著作権およびその関連権利は[CC0](../LICENSE.md)で放棄されています。