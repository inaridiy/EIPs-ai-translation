---
original: a237b2b0833c1cefbef59692514da9fa27203c24c5eddc40659c1066232d4c65
---

---
eip: 6189
title: エイリアスコントラクト
description: 他のコントラクトにコールを転送できるコントラクトの作成を可能にする
author: Gavin John (@Pandapip1)
discussions-to: https://ethereum-magicians.org/t/eip-6190-functional-selfdestruct/12232
status: 停滞
type: Standards Track
category: Core
created: 2022-12-20
requires: 2929, 6188
---

## 概要

このEIPにより、魔法のノンスを使ってコントラクトを "エイリアスコントラクト" に変換することができます。エイリアスコントラクトは自動的に他のコントラクトにコールを転送します。

## 動機

このEIPは単独では非常に有用ではありません。追加の計算とガスコストを伴いますが、有用な副作用はありません。ただし、[EIP-6190](./eip-6190.md)と組み合わせることで、SELFDESTRUCT をVerkleツリーと互換性のあるものにすることができます。

## 仕様

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"MAY"、"OPTIONAL" は、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

### 定義

ノンスが `2^64-1` で、コントラクトコードが `0x1` であるコントラクトは、エイリアスコントラクトと見なされます。

### 前提条件

[EIP-6188](./eip-6188.md)を使って、`2^64-1`の魔法のノンス値を保護する必要があります。

### オペコードの変更

#### `CALL`、`CALLCODE`、`DELEGATECALL`、`STATICCALL`、`PAY`、およびEOAトランザクション

"呼び出し先" とは、呼び出されるアカウントまたは支払われるアカウントを指します。

呼び出し先のノンスが `2^64-1` の場合、呼び出しは呼び出し先の `0` 番目のストレージスロットに格納されているアドレスに転送されなければなりません (呼び出し先がそのアドレスであるかのように)。これは、非エイリアスコントラクトに到達するまで繰り返されなければなりません。`CALLER` は変更されないままでなければなりません。

エイリアスコントラクトが複数ある場合、元の呼び出し先およびその後の呼び出し先 (最後のものを除く) の `0` 番目のストレージスロットには、最終的な非エイリアスコントラクトのアドレスが設定されなければなりません。その後、呼び出しは通常どおり転送されなければなりません。**これは、`STATICCALL` のような読み取り専用のコンテキストでも行われなければなりません。**

例えば、`A` がエイリアスコントラクトで `B` に呼び出しを転送し、`B` がエイリアスコントラクトで `C` に呼び出しを転送する場合、`A` の `0` 番目のストレージスロットには `C` のアドレスが設定されます。その後、呼び出しは `C` に転送されます。

最後に、オペコードは通常どおり、最終的な非エイリアスコントラクトを使って実行されなければなりません。

`CALL`、`CALLCODE`、`DELEGATECALL`、`STATICCALL` オペコードおよびEOAトランザクションは、[EIP-2929](./eip-2929.md)で定義されているアカウントアクセスに関する通常のコストに加えて、このような方法でアクセスされたアカウントの数 (最終的なものを含む、エイリアスアカウントが使用されていない場合も含む) 1つにつき `25` ガスを消費しなければなりません。また、`0` 番目のストレージスロットが更新されたアカウントごとに、さらに `5000` ガスを消費しなければなりません。

無限ループが発生した場合、トランザクションはガス切れになり、元に戻されなければなりません。

#### `EXTCODEHASH`、`EXTCODECOPY`、`EXTCODESIZE`、および `BALANCE`

"アクセスされたアカウント" とは、アクセスされているアカウント (つまり、そのコードがアクセスされているアカウントまたはそのバランスがアクセスされているアカウント) を指します。

`CALL` ファミリーのオペコードと同様に、アクセスされたアカウントのノンスが `2^64-1` の場合、アクセスされたアカウントのアドレスは、そのアカウントの `0` 番目のストレージスロットに格納されているアドレスに置き換えられなければなりません。これは、非エイリアスコントラクトに到達するまで繰り返されなければなりません。

エイリアスコントラクトが複数ある場合、元のアクセスされたアカウントおよびその後のアクセスされたアカウント (最後のものを除く) の `0` 番目のストレージスロットには、最終的な非エイリアスコントラクトのアドレスが設定されなければなりません。その後、アクセスされたアカウントは通常どおり置き換えられなければなりません。**これは、`STATICCALL` のような読み取り専用のコンテキストでも行われなければなりません。**

最後に、オペコードは通常どおり、最終的な非エイリアスコントラクトを使って実行されなければなりません。

`EXTCODEHASH`、`EXTCODECOPY`、`EXTCODESIZE`、および `BALANCE` オペコードは、[EIP-2929](./eip-2929.md)で定義されているアカウントアクセスに関する通常のコストに加えて、このような方法でアクセスされたアカウントの数 (最終的なものを含む、エイリアスアカウントが使用されていない場合も含む) 1つにつき `25` ガスを消費しなければなりません。また、`0` 番目のストレージスロットが更新されたアカウントごとに、さらに `5000` ガスを消費しなければなりません。

無限ループが発生した場合、トランザクションはガス切れになり、元に戻されなければなりません。

#### `CREATE` および `CREATE2`

`CREATE` または `CREATE2` が (使用されているEIPに応じて) アドレスにアカウントを作成する (または作成に失敗する) 場合、そのアカウントのコードが `0x1` で、ノンスが `2^64-1` であれば、元に戻すのではなく、既存のアカウントの `0` 番目のストレージスロットに格納されているアドレスにコントラクトを作成しようとしなければなりません。これは、非エイリアスコントラクトに到達するまで繰り返されなければなりません。

エイリアスコントラクトが複数ある場合、元のアクセスされたアカウントおよびその後のアクセスされたアカウント (最後のものを除く) の `0` 番目のストレージスロットには、最終的な非エイリアスコントラクトのアドレスが設定されなければなりません。

最後に、オペコードは通常どおり実行され、新しく作成されたコントラクトのアドレスを返さなければなりません。

`CREATE` および `CREATE2` オペコードは、[EIP-2929](./eip-2929.md)で定義されているアカウントアクセスに関する通常のコストに加えて、このような方法でアクセスされたアカウントの数 (最終的なものを含む、エイリアスアカウントが使用されていない場合も含む) 1つにつき `25` ガスを消費しなければなりません。また、`0` 番目のストレージスロットが更新されたアカウントごとに、さらに `5000` ガスを消費しなければなりません。

無限ループが発生した場合、トランザクションはガス切れになり、元に戻されなければなりません。

#### `ADDRESS`

このオペコードは変更されません。`ADDRESS` は、ノンスが `2^64-1` ではないアドレスを指します。

### ゼロアドレスへの送金

ゼロアドレスへの送金は、`CREATE` オペコードと同じ効果を持ち続け、前述の[`CREATE` および `CREATE2`](#create-and-create2)セクションで説明したように、追加のガスコストがかかります。

### トランザクションの有効性

"発信元" とは、検証されるトランザクションを送信したアカウントを指します。

発信元のノンスが `2^64-1` の場合、発信元は現在の発信元の `0` 番目のストレージスロットに格納されているアドレスに更新されなければなりません (発信元がその `0` 番目のストレージスロットのアドレスであるかのように)。これは、非エイリアスコントラクトに到達するまで繰り返されなければなりません。

エイリアスコントラクトが複数ある場合、元の発信元およびその後の発信元 (最後のものを除く) の `0` 番目のストレージスロットには、最終的な非エイリアスコントラクトのアドレスが設定されなければなりません。その後、呼び出しは通常どおり転送されなければなりません。

[EIP-2929](./eip-2929.md)で定義されているアカウントアクセスに関する通常のコストに加えて、このような方法でアクセスされたアカウントの数 (最終的なものを含む、エイリアスアカウントが使用されていない場合も含む) 1つにつき `25` ガスが検証コストに追加されます。また、`0` 番目のストレージスロットが更新されたアカウントごとに、さらに `5000` ガスが追加されます。

最後に、検証は通常どおり行われます。

### RPCエンドポイントの変更

#### `eth_getStorageAt`

`eth_getStorageAt` RPCエンドポイントは、ターゲットコントラクトのコントラクトコードが `0x1` で、ノンスが `2^64-1` の場合、エラーを返さなければなりません。

## 根拠

`25` ガスの追加コストは、ノンスを取得し、指定された値と比較するコストを表しています。

`eth_getStorageAt` は、エイリアスコントラクトの特殊な動作のためにエラーを投げるように変更されました。

`2^64-1` のノンスは、[EIP-6188](./eip-6188.md)で保護されているため、この値が選択されました。

`0x1` のコントラクトコードは任意に選択されました。何らかの理由で、ノンスが `2^64-1` のコントラクトがコードを `0x0` に設定したり、EOAがノンスを `2^64-1` に設定したりした場合に備えて、ゼロ以外のコードが選択されました。

## 下位互換性

このEIPはコンセンサスルールを変更するため、プロトコルのアップグレードが必要です。既存のコントラクトは影響を受けないはずです。なぜなら、ノンスが `2^64-1` ではなく、コントラクトコードが `0x1` ではないはずだからです。

## セキュリティ上の考慮事項

追加のガスコストにより、任意のコントラクトのデータにアクセスしたり、頻繁にコントラクトの非活性化を行ったりすることで、DoS攻撃の可能性があります。コントラクト作成者は注意を払い、コントラクトを適切に設計する必要があります。自律的な破壊と復活を行う既存のデプロイされたコードにも影響がある可能性があります。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。