---
original: 460625e6bd904312a649352f7a8a476cfc3550f130eef78060c93e9116eb3eee
---

---
eip: 2681
title: アカウントのノンスを2^64-1に制限する
author: Alex Beregszaszi (@axic)
discussions-to: https://ethereum-magicians.org/t/eip-2681-limit-account-nonce-to-2-64-1/4324
status: 最終
type: 標準トラック
category: コア
created: 2020-04-25
---

## 概要

アカウントのノンスを`0`から`2^64-1`の間に制限する。

## 動機

現在、アカウントのノンスは任意長の符号なし整数として指定されています。状態証拠でのこの任意長データの扱いは最適ではありません。そのため、このEIPではノンスをより最適化された方法で表現できるようになります。

また、少なくとも3つの他の提案で改善が求められているトランザクション形式にも有益となる可能性があります。

最後に、ノンスを256ビットの数値として保持する必要がなくなるため、クライアントにおける軽微な最適化が可能になります。

## 仕様

ジェネシスから遡って以下の2つの制限を導入する:

1. ノンスが`2^64-1`以上のトランザクションは無効とみなす。
2. `CREATE`および`CREATE2`命令の実行が、アカウントのノンスが`2^64-1`の場合にスタックに`0`を押し出して終了する。この場合、initcodeの実行に対するガスは差し引かれない。

## 根拠

1. 提案された制限に到達するようなノンスが発生することは非常に考えにくい。外部トランザクションでそこまで到達しようとすると、少なくとも`21000 * (2^64-1) = 387_381_625_547_900_583_915_000`ガスがかかる。

2. 過去にMorden testnetでは、各新規アカウントの初期ノンスが`2^20`に設定されていたことに注意が必要です。これはリプレイ保護の一種でしたが、[EIP-155](./eip-155.md)によりチェーン識別子を使う方式が洗練された形で導入されています。

3. ほとんどのクライアントはすでにノンスフィールドを64ビットとして扱っています。例えば go-ethereum がそうです。

4. ノンスが`2^64-1`のトランザクションを無効とするのは、そうしないと送信者アカウントのノンスが`2^64-1`を超えてしまうためです。

## 下位互換性

これは breaking changeですが、実際の影響は見られないはずです:

1. 現在の状態に、この値を超えるノンスを持つアカウントは存在しません。2020年11月時点で、最高のアカウントノンスを持つのは`0xea674fdde714fd979de3edf0f56aa9716b898ec8`アカウントで、約2900万です。

2. go-ethereumはすでに部分的にこの制限を適用しています(`state.Account.Nonce`と`types.txdata.AccountNonce`は64ビットの数値として扱われます)。

## セキュリティ上の考慮事項

なし。

## 著作権

[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。