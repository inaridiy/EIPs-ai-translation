---
original: 7da4559d603f0a75f927d9b930c530aa9f27591a6c16bef5703b70416da7fae4
---

---
eip: 7045
title: 最大アテステーション包含スロットの増加
description: アテステーションのスロットを含むエポック `N` の最後のスロットまでの範囲に、最大アテステーション包含スロットを増加させます。ここで `N` はアテステーションのスロットを含むエポックです。
author: Danny Ryan (@djrtwo)
discussions-to: https://ethereum-magicians.org/t/eip-7045-increase-attestation-slot-inclusion-range/14342
status: 最終
type: 標準トラック
category: コア
created: 2023-05-18
---

## 概要

アテステーションの最大包含スロットを `attestation.slot + SLOTS_PER_EPOCH` から、アテステーションのスロットを含むエポック `N+1` の最後のスロットまでに増加させます。

この増加は、現在の LMD-GHOST セキュリティ分析および確認ルールにとって重要です。

## 動機

現在、アテステーションは最小遅延 (`メインネットでは 1 スロット`) の後、アテステーションが作成されたスロットから `SLOTS_PER_EPOCH` スロット後までの間に含めることができます。このエポック単位の移動ウィンドウは、Phase 0 の間に「公平」と評価されたために決定されました。検討された代替案は、現在のエポックと次のエポックの間にアテステーションを含めることを許可するというものでした。これにより、エポックの初めに作成されたアテステーションの方が、エポックの終わりに作成されたアテステーションよりも、より多くの包含スロットを持つことになります。

この決定以来、代替設計が現在の LMD-GHOST セキュリティ証明および新しい確認ルール (通常のメインネット条件下で約 3-4 スロットでブロックの確認を可能にする) にとって重要であることが明らかになっています。

したがって、このEIPは、セキュリティ証明と確認ルールのニーズに合わせて、アテステーションの最大包含スロットを増加させます。

## 仕様

### 定数

| 名称 | 値 | コメント |
| - | - | - |
|`FORK_TIMESTAMP` | *TBD* | メインネット |

### 実行レイヤー

これには実行レイヤーへの変更は必要ありません。

### コンセンサスレイヤー

仕様の変更は、コンセンサス仕様 Deneb アップグレードに組み込まれています。

この仕様は、状態遷移関数に2つの小さな変更を加えます:

* [`process_attestation`](https://github.com/ethereum/consensus-specs/blob/95f36d99cf4aa59974da06af24ef9a7c12d3c301/specs/deneb/beacon-chain.md#modified-process_attestation)を変更して、スロットチェックの上限を設けず、代わりに最小スロットおよびターゲットエポックが現在または前のエポックにあることを定義することで、包含範囲を定義する。
* [`get_attestation_participation_flag_indices`](https://github.com/ethereum/consensus-specs/blob/95f36d99cf4aa59974da06af24ef9a7c12d3c301/specs/deneb/beacon-chain.md#modified-get_attestation_participation_flag_indices)を変更して、`inclusion_delay`の考慮なしに `TIMELY_TARGET_FLAG`を設定し、拡張された包含アテステーションに非ゼロの報酬が付与されるようにする。

さらに、この仕様は、[アテステーション](https://github.com/ethereum/consensus-specs/blob/95f36d99cf4aa59974da06af24ef9a7c12d3c301/specs/deneb/p2p-interface.md#beacon_attestation_subnet_id)および[集約アテステーション](https://github.com/ethereum/consensus-specs/blob/95f36d99cf4aa59974da06af24ef9a7c12d3c301/specs/deneb/p2p-interface.md#beacon_aggregate_and_proof)のゴシップ条件を変更して、この拡張された範囲でのゴシップを可能にします。

## 根拠

### 最大包含スロットの拡張

動機で説明したように、この最大包含スロットをNext Epochの最後まで拡張することは、LMD-GHOST セキュリティ証明および確認ルールにとって重要です。

### ターゲット報酬のための `inclusion_delay`の考慮の削除

以前は、`get_attestation_participation_flag_indices`が `TIMELY_TARGET_FLAG`(つまり、正しいターゲット投票を行ったアテステーションの報酬)を設定するのは、アテステーションが `SLOTS_PER_EPOCH`のウィンドウ内に含まれる場合のみでした。

このフラグに対する `inclusion_delay`の考慮は削除され、アテステーションが有効な包含ウィンドウ内にある場合は常に、最低限の非ゼロの報酬を受け取ることができるようになります。これにより、クライアントがこのようなアテステーションをブロックに含めようとすることが保証され、セキュリティ分析に重要です。

なお、これは以前定義されていた範囲と同等の動作が意図されていたものです。

## 下位互換性

このEIPは、コンセンサスレイヤーのブロック検証ルールセットに下位互換性のない変更を導入するため、ハードフォークを伴う必要があります。

## テストケース

このEIPのテストケースは、`consensus-specs`リポジトリの [`deneb`](https://github.com/ethereum/consensus-specs/tree/2297c09b7e457a13f7b2261a28cb45777be82f83/tests/core/pyspec/eth2spec/test/deneb)テストスイートにあります。

## セキュリティ上の考慮事項

これにより、LMD-GHOST セキュリティが向上し、高速な確認ルールが可能になります。

セキュリティに対する悪影響は知られていません。

## 著作権

著作権およびそれに関連する権利は [CC0](../LICENSE.md) で放棄されています。