---
original: 2235557ed02f0e498edd87681822cf6136f0b96695c5baf5667ae3d7c60b729b
---

---
eip: 7542
title: eth/70 - available-blocks-extended プロトコル
description: ハンドシェイクでの利用可能なブロック範囲に関する情報の追加と、ブロック範囲のリクエストおよび送信のためのメッセージタイプの追加
author: Ahmad Bitar (@smartprogrammer93) <smartprogrammer@windowslive.com>
discussions-to: https://ethereum-magicians.org/t/eip-eth-70-available-blocks-extended-protocol-handshake/16188
status: Draft
type: Standards Track
category: Networking
created: 2023-10-21
requires: 7642
---
## 概要

このEIPの目的は、Ethereumノードが利用可能なブロックの範囲を通信する方法を導入することです。ノードが提供できるブロック範囲を知ることで、ピアはどのノードからブロックを要求するか、または特定のブロック範囲を探しているときにどのノードに接続するかをより適切に判断できるようになります。これにより、ネットワークの動作がより効率的になります。

このEIPでは、Ethereumワイヤープロトコル(`eth`)のハンドシェイクを拡張し、新しいバージョン`eth/70`を導入します。このバージョンには、ノードが提供できるブロック範囲に関する情報が含まれます。さらに、要求された場合にブロック範囲を共有するための2つの新しいメッセージタイプを追加しています。

## 動機

[EIP-4444](./eip-4444.md)の最初の段階では、一部のノードがまだチェーンの過去のデータを提供する必要があり、他のノードはそれをプルーニングし始める可能性があります。現在、ノードは特定のブロックを要求することで、ピアがその要求されたデータを持っているかどうかを判断する必要があります。これは非効率的で、不要なデータ要求を引き起こし、帯域幅と時間を無駄にする可能性があります。したがって、この変更により、過去のデータを取得したいノードがネットワークから効率的に行うことができるようになります。

さらに、この変更により、同期の効率が向上します。ノードは、ピアがまだ同期中であっても、必要なブロックを持っているかどうかを判断できるため、不要なブロック要求や空の応答を避けることができます。

## 仕様

- `eth/70`という新しい`eth`プロトコルの機能(バージョン)をアドバタイズする。
  - 古い`eth/69`プロトコルは、`eth/70`が実装者に十分に採用されるまで、並行して維持されるべきです。
- `eth/70`の`Status (0x00)`メッセージを変更し、`forkid`の後に`blockRange`フィールドを追加する:
  - `eth/69`の現在のパケット: `[version: P, networkid: P, blockhash: B_32, genesis: B_32, forkid]`
  - `eth/70`の新しいパケット: `[version: P, networkid: P, blockhash: B_32, genesis: B_32, forkid blockRange]`,
  ここで`blockRange`は`[startBlock: uint64, endBlock: uint64]`です。

- 2つの新しいメッセージタイプを導入する:
  - `RequestBlockRange (0x0b)` - ピアの現在のブロック範囲を要求するノードからのメッセージ。
  - `SendBlockRange (0x0c): [startBlock: uint64, endBlock: uint64]` - `RequestBlockRange`への応答で、要求元ノードにピアの現在の利用可能なブロック範囲を通知する。

`eth/70`を使用して接続する際、ノードは`Status`メッセージを交換する必要があります。その後、`RequestBlockRange`と`SendBlockRange`メッセージを使用して、ピアのブロック範囲の変更について情報を得ることができます。

ノードは、ピアの利用可能なブロック範囲に関係なく、接続を維持する必要があります。ただし、ノードのピアスロットが満杯で、必要なブロック範囲を持つピアに接続していない場合は、そのようなピアを探すために切断することができます。

## 根拠

`eth`ハンドシェイクに利用可能なブロック範囲を含めることで、ピアの機能を即座に理解できるようになります。これにより、ノードが必要なデータを持つピアに優先的に接続できるため、より効率的なネットワーキングが可能になります。
新しいメッセージタイプは、ノードが同期やブロックのプルーニングによってブロック範囲が変更された場合に、他のノードから最新の利用可能なブロック範囲を要求できるようにするために導入されています。
必要な範囲を持たないピアとの接続を維持することで、ネットワークの耐性が確保されますが、フル接続時にはブロック同期の効率化のために切断することができます。

## 下位互換性

このEIPは、`eth`プロトコルのハンドシェイクを下位互換性のない方法で拡張し、新しいバージョン`eth/70`を提案しています。ただし、`devp2p`では、同じワイヤープロトコルの複数のバージョンを同時に実行できます。したがって、更新されていないノードは、`eth/69`、`eth/68`、`eth/67`などの古いバージョンを継続して使用できます。

このEIPはコンセンサスエンジンに影響を与えず、ハードフォークを必要としません。

## テストケース

テストには、ハンドシェイク時にノードがブロック範囲の情報を正しく伝達し、理解できることを確認することが含まれます。さらに、ノードが要求された場合に正しくブロック範囲を要求し、共有できることを確認する必要があります。

## セキュリティ上の考慮事項

この変更は、代替の過去のブロックストレージソリューションの実装前に、過去のブロックを保存および提供しないことの標準化ではありません。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。