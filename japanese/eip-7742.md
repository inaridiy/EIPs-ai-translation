---
original: 1d2a199e2b5f82c0630da9cfff6d74273a1985c1e6d6905b5576a3feb5081fa3
---

---
eip: 7742
title: CL と EL の間のブロブカウントの分離
description: CL がブロブの最大値を検証し、EL がターゲット値を CL から取得する
author: Alex Stokes (@ralexstokes)
discussions-to: https://ethereum-magicians.org/t/eip-7742-uncouple-blob-count-between-cl-and-el/20550
status: Draft
type: Standards Track
category: Core
created: 2024-07-12
requires: 4844
---

## 概要

[EIP-4844](./eip-4844.md) からのブロブの最大値と目標値の検証の更新。

実行レイヤー (EL) はもはやブロブの最大値を検証せず、コンセンサスレイヤー (CL) から動的にターゲット値を受け取ります。

## 動機

EIP-4844 に続いて、実行レイヤー (EL) は固定のブロブターゲット値とブロブ最大値を維持しています。EL と CL ノードソフトウェアの関係を考えると、ブロブ最大値の検証は冗長なので、セキュリティに変更を加えることなく完全に削除できます。この EIP はまた、EL がブロブターゲット値の現在値をソースする方法を変更します。その理由は以下の2つです:

1) EIP-4844 の `TARGET == MAX // 2` の静的な関係ではなく、値に対してより柔軟性を得る。
2) CL と EL の層の開発とデプロイを切り離し、ブロブターゲット値を変更したい場合に便利。

## 仕様

| 定数                         | 値                                          |
|---                           |---                                           |
| `FORK_TIMESTAMP`             | 未定                                         |

### 背景

EIP-4844 で導入されたデータ機能は、Ethereum ブロックにブロブを追加します。ブロブは単に固定のデータセットで、正規チェーンに含めることができますが、Ethereum トランザクションの `calldata` のように実行セマンティクスはありません。

プロトコルは、このデータ機能の乱用によるDoS攻撃を防ぐために、ブロックあたりの最大許容ブロブ数を指定しています。プロトコルはまた、Ethereum プロトコルのこのリソースの割り当てを管理するための「ターゲット」値、つまり単位時間あたりの意図されるブロブスループットの実行平均量を維持しています。

これらの値は現在、EIP-4844 の後の EL で固定値として設定されており、EIP-4844 の後の CL でも別個に固定値として設定されています。この EIP は、CL と EL 間でこれらの値を分離するための一連の変更を提案します。これにより、ブロブカウントに関する変更の開発とデプロイが容易になります。

#### ブロックあたりの最大ブロブ数

ブロブの最大値は CL ノードで検証され、Engine API で指定されたバージョン付きハッシュの整合性チェック中に EL がこの検証を継承します。このため、EIP-4844 で指定された厳密なチェックは不要です。

#### ブロックあたりのターゲットブロブ数

ターゲットは現在、ブロブカウントに対する固定値として指定されています。Ethereum コミュニティはスケーリング戦略の一環としてブロブパラメータを増やす予定であり、最大値に対するより柔軟なターゲット値を持つことが望ましいです。これにより、このプロトコルパラメータの硬直性を軽減できます。

EL が最大値に基づいて固定ターゲット値を維持する場合でも、最大値を削除すると EL がターゲット値を知ることができなくなります。この情報の欠如に対処するため、この EIP は CL がEngine APIを介して提供されるペイロードごとに現在のターゲット値を EL に送信することを提案しています。最適化同期のセキュリティを維持するために、EL ブロックヘッダーにもこのターゲット値を拡張する必要があります。

### ブロック構造と有効性

`FORK_TIMESTAMP` 実行タイムスタンプ以降、実行クライアントは追加の64ビットフィールド `target_blob_count` をヘッダースキーマに拡張する必要があります。この値は現在のターゲットブロブ数に設定されます。Engine APIは、このEIPに合わせて変更され、各ペイロードで `target_blob_count` が提供されるようになります。実装はこの値を使ってブロックヘッダーのフィールドを正しく設定できます。

ターゲットブロブ数の有効性は、引き出しの場合と同様、コンセンサスレイヤーから保証されます。

ブロックを検証する際、実行クライアントは必ずブロックヘッダーのターゲットブロブ数が、コンセンサスクライアントから提供されたものと一致することを確認する必要があります。

親がない新規ジェネシスブロックの場合、値はそのジェネシスブロックのプロトコルルールセットで合意されたターゲットブロブ数の仕様に従って設定されるべきです。

### ブロック処理

`block.timestamp >= FORK_TIMESTAMP` の実行ブロックの処理を開始する際 (つまり、トランザクションの処理の前)、EIP-4844 で指定されたブロブ最大値の検証をスキップできます。具体的には、EIP-4844 で指定された `MAX_BLOB_GAS_PER_BLOCK` に関連するロジックを非推奨化できます。
さらに、EIP-4844 の `TARGET_BLOB_GAS_PER_BLOCK` への参照は、CL から取得した `target_blob_count` に `GAS_PER_BLOB` (EIP-4844 で指定) を乗じることで導出できます。

それ以外の点では、EIP-4844 の仕様は変更されていません。例えば、ブロブベースフィーの会計処理とブロブガスの超過追跡は、まったく同じ方法で行われます。

## 根拠

### なぜ CL がブロブベースフィーも計算せず、EL の処理からブロブカウントの概念を完全に取り除かないのか?

TODO

## 下位互換性

問題はありません。

## テストケース

該当なし

## 参考実装

該当なし

## セキュリティ上の考慮事項

該当なし

## 著作権

[CC0](../LICENSE.md)により著作権およびそれに関連する権利が放棄されています。