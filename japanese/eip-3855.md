---
original: f8c1de5c240e03d47ef7bae689469bc34b650e53522c5661b0c93756ad50b217
---

---
eip: 3855
title: PUSH0 命令
description: 定数値 0 をスタックにプッシュする新しい命令を導入する
author: Alex Beregszaszi (@axic)、Hugo De la cruz (@hugo-dc)、Paweł Bylica (@chfast)
discussions-to: https://ethereum-magicians.org/t/eip-3855-push0-instruction/7014
status: 最終
type: Standards Track
category: Core
created: 2021-02-19
---

## 概要

`PUSH0` (`0x5f`) 命令を導入し、定数値 0 をスタックにプッシュする。

## 動機

多くの命令がオフセットを入力として期待しており、その多くがゼロである。`CALLs` のリターンデータパラメータがゼロに設定されるのは一例に過ぎない。コントラクトがこれを好む場合、`RETURNDATA*` を使用する。これは一例に過ぎず、コントラクトがゼロ値をプッシュする必要がある理由はたくさんある。現在は `PUSH1 0` を使用して実現できるが、これはランタイムで 3 ガスかかり、2 バイトでエンコードされるため、デプロイ時のコストは `2 * 200` ガスとなる。

全体的なコストが高いため、多くの人が同じ効果を得るために他の命令を使用しようとしている。一般的な例には `PC`、`MSIZE`、`CALLDATASIZE`、`RETURNDATASIZE`、`CODESIZE`、`CALLVALUE`、`SELFBALANCE` などがある。これらの一部は 2 ガスしかかからず、1 バイトしかないが、その値はコンテキストによって異なる可能性がある。

Mainnet (ブロック範囲 8,567,259...8,582,058 および 12,205,970...12,817,405) での分析によると、実行されたすべての `PUSH*` 命令の約 11.5% がゼロ値をプッシュしていることがわかった。

この変更の主な動機は以下の通りです:
1. コントラクトコードサイズの削減
2. 最適化のために様々な命令を (誤って) 使用するリスクの軽減。これらの命令の再価格設定/変更はより危険である可能性がある。
3. ゼロの複製に `DUP` 命令を使う必要性の軽減

「無駄」の規模を把握するために、既存のアカウントで `PUSH1 00` 命令に 340,557,331 バイトが無駄に使われており、これらをデプロイするのに 68,111,466,200 ガスが費やされていることがわかった。実際、これらのアカウントの多くは他のアカウントと同一のバイトコードを共有しているため、クライアントに保存されているサイズは低くなっているが、デプロイ時のコストは支払われている。

2) の例として、`RETURNDATASIZE` の動作を変更し、呼び出しフレームの開始時にゼロではないことを保証しないようにすることが考えられる。

## 仕様

`PUSH0` 命令は `0x5f` で導入される。即値データはなく、スタックからアイテムをポップせず、値が 0 の単一のアイテムをスタックにプッシュする。この命令のコストは 2 ガス (つまり `base`) である。

## 根拠

### ガスコスト

`base` ガスコストは、`ADDRESS`、`ORIGIN` などの定数値をスタックにプッシュする命令に使用される。

### オペコード

`0x5f` は `PUSH` の実装と「連続」した領域にあり、実装を共有できる可能性がある。

## 下位互換性

この EIP は以前は存在しなかった新しいオペコードを導入する。この EIP 後、このオペコードを使用する既にデプロイ済みのコントラクトの動作が変更される可能性がある。

## テストケース

- `5F` -- 正常に実行され、スタックに単一のアイテム (値 0) が存在する
- `5F5F..5F` (1024 回) -- 正常に実行され、スタックに 1024 個のアイテム (すべて値 0) が存在する
- `5F5F..5F` (1025 回) -- スタックオーバーフローのために実行が中止される

## セキュリティ上の考慮事項

著者は、セキュリティへの影響はないと考えている。ジャンプ先解析は影響を受けないことに注意してください。`PUSH0` には即値データバイトがないためです。

## 著作権

[CC0](../LICENSE.md) によりすべての著作権およびそれに関連する権利が放棄されています。