---
original: 85270100dede7c7a051e8c776893eeedd54306511d48fb2e0b681399036e792e
---

---
eip: 2515
title: 難易度フリーズの実装
author: James Hancock (@madeoftin)
discussions-to: https://ethereum-magicians.org/t/eip-2515-replace-the-difficulty-bomb-with-a-difficulty-freeze/3995
status: 停滞
type: Standards Track
category: Core
created: 2020-02-10
---


## 簡単な要約
難易度フリーズは、プロトコルの難易度調整アルゴリズム内で実装される、難易度爆弾の代替案です。難易度フリーズは、事前に決められたブロック高さから始まり、その後永遠に1%ずつ増加します。これはチェーンを停止させるものではありませんが、開発者に定期的なアップグレードを促し、チェーンの分岐にも難易度フリーズへの対応を要求します。

## 概要
難易度フリーズは予測と分析が容易なメカニズムであり、それを逸脱することによる圧力は、コアの開発者とクライアントのメンテナーにより強く感じられます。クライアントのメンテナーは、差し迫る難易度フリーズに最も迅速に対応できる立場にあります。この予測可能性と相まって、タイムリーな難易度爆弾の拡散につながる可能性が高くなります。

## 動機
現在の難易度爆弾は、ブロック時間ターゲティングメカニズムに複雑な影響を及ぼし、予期せぬタイミングで発生したり(Muir Glacier)、マイナーではない対象に悪影響を及ぼしたりする(技術的な問題によるフォークの遅延)といった問題がありました。マイナーは、ブロック報酬の減少による影響を受けます。ユーザーは、チェーンの使い勝手が低下するブロック時間の増加の影響を受けます。これらのグループは、単独では難易度爆弾に対処することができません。一方、難易度フリーズの場合、その影響はクライアントのメンテナーにより直接的に感じられ、予測可能性も高いため、変更を行うタイミングが明確になります。

## 仕様

変数 `DIFFICULTY_FREEZE_HEIGHT` を追加します。

難易度フリーズのロジックは以下のように定義されます:

```
if (BLOCK_HEIGHT <= DIFFICULTY_FREEZE_HEIGHT):
   block_diff = parent_diff + parent_diff // 2048 * max(
                1 - (block_timestamp - parent_timestamp) // 10, -99)

else:
 block_diff = parent_diff + parent_diff * 0.01
```

**オプションの実装**

変数 `DIFFICULTY_FREEZE_DIFFERENCE` を追加し、`LAST_FORK_HEIGHT` を使って難易度フリーズの発生タイミングを計算します。

例えば、`DFD = 1,800,000 blocks` (約9ヶ月)に設定すると、難易度計算は以下のようになります。

```
if (BLOCK_HEIGHT  <= LAST_FORK_HEIGHT + DIFFICULTY_FREEZE_DIFFERENCE) :
   block_diff = parent_diff + parent_diff // 2048 * max(
                1 - (block_timestamp - parent_timestamp) // 10, -99)

else:
 block_diff = parent_diff + parent_diff * 0.01
```

このアプローチには、アップグレード時に自動的に難易度フリーズが更新される利点がありますが、チェックロジックがより複雑になり、コンセンサスバグが発生しないよう、さらなる分析とテストケースが必要になります。

## 根拠
ブロック高さは、システム内で非常に予測しやすく評価しやすいです。これにより、ブロック時間ターゲティングメカニズムから難易度爆弾の影響が取り除かれます。難易度の増加を追加したのは、メカニズムのゲームの理論が確実に所望の結果をもたらさないという指摘を受けたためです。

https://twitter.com/quentinc137/status/1227110578235330562

## 下位互換性
下位互換性はありません。

## テストケース
TBD

## 実装
TBD

## セキュリティ上の考慮事項
難易度フリーズを逸脱した場合の影響は、難易度爆弾を逸脱した場合とは異なります。難易度フリーズの時点で、プロトコルはネットワークのハッシュパワーの変化に適応できなくなります。これは以下の3つのシナリオのいずれかにつながる可能性があります。

 - ハッシュレートが増加した場合:
   ネットワークのブロック時間が短期的に増加しますが、難易度の上昇が高すぎるためマイナーが追加されなくなります。
 - ハッシュレートが減少した場合:
   ブロック時間が増加します。
 - ハッシュレートが変わらない場合:
   ブロック時間が一定の割合で増加し続けます。

クライアントは、ネットワークに完全に同期することが動機付けられているため、この状況が発生しないよう非常に意欲的です。同時に、難易度フリーズの遅延は、クライアントチームが最も簡単に実装できます。したがって、最も悪影響を受けるのはクライアントチームであり、同時にそれに最も効果的に対処できる立場にもあります。

## 経済的な考慮事項

現在の難易度爆弾の下では、氷河期の影響によりETHの発行量が減少します。一方、難易度フリーズの下では、短期的に発行量が増加する可能性がありますが、クライアントがこれを防ぐよう動機付けられているため、発生する可能性は低くなります。時間の経過とともに難易度の増加により、ブロック時間とETHの発行量も最終的に減少します。

また、この変更のタイミングは予測しやすいため、影響を受けるステークホルダー(ETHホルダー)は、難易度フリーズが近づいているのを観察し、Twitterで開発者に注意を喚起することができます。

## 著作権
[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。