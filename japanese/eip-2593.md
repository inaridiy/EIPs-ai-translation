---
original: fcb676ccb515c7874cc812362c400f49cd5e6959c049985fe5f0d9fccd4b0f76
---

---
eip: 2593
title: ETH 1.0チェーンのエスカレーター手数料市場の変更
author: Dan Finlay <dan@danfinlay.com>
discussions-to: https://ethresear.ch/t/another-simple-gas-fee-model-the-escalator-algorithm-from-the-agoric-papers/6399
status: 停滞
type: Standards Track
category: Core
created: 2020-03-13
---

## 簡単な要約
Ethereumの現在の「第一価格オークション」手数料モデルは非効率的で、ユーザーにとって不必要に高コストです。このEIPは、動的に価格設定されるトランザクション手数料と効率的なトランザクション価格発見メカニズムを可能にする方法を提案しています。

## 概要

[The Agoric Papers](https://agoric.com/papers/incentive-engineering-for-computational-resource-management/full-text/)に基づいています。

各トランザクションには、「エスカレーティング」入札を指定するパラメーターを提供するオプションがあり、バリデーターがそのトランザクションを含めるための時間ベースのオークションが作成されます。

これにより、価格が常に最高入札価格に即座に下がるという、非常に効率的な価格発見が行われます。これは必ずしもユーザーが支払う意思のある最高価格ではありません。

![エスカレーター アルゴリズムの価格チャート](https://ethresear.ch/uploads/default/original/2X/0/042795efa4c2680d644bc66386cd2984a70293f8.gif)

## 動機
Ethereumは現在、単純な第一価格オークションを使ってトランザクション手数料を設定しており、これにはよく文書化された非効率性があります(その一部は[EIP-1559](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md)に記載されています)。特に価格変動が激しい時や、ブロックが満杯の時に、トランザクションがブロックに含まれるための適切な価格を見積もるのが難しくなります。

EIP 1559は現在、Ethereumプロトコルの改善策として推奨されていますが、ガス市場が非常に非効率であることに同意しつつ、このような変更がすべてのクライアントとウォレットの実装に影響を与えるため、Ethereumコミュニティは十分な理由と正当化に基づいて選択を行うべきだと考えています。私はEIP-1559が現在そのような根拠を欠いていると考えています。

ガス料金市場についてより建設的で具体的な議論を促進するために、現状よりも明らかに優れた代替案を提示することが重要だと感じました。そうすれば、EIP-1559の主張される特性を、信頼できる代替案と比較することができます。

私は、以下の条件の組み合わせで、3つのガス支払いアルゴリズムを比較することを提案します:

- 定期的に半分以下のブロック、定期的に半分以下のブロック、そして予期せぬ(「ブラックスワン」)シリーズでブロックが満杯になる場合。
- 市場レートを下回る価格を待つ意思のあるユーザー、および緊急の包含を望み市場レート以上の支払いを行う意思のあるユーザー。

その上で、以下の点を検討すべきです:
- 特定のシナリオで最も支払いたい意思のあるユーザーが、自分の許容できる期間内にトランザクションを処理させられる可能性は高いか?
- 良い価格を望むユーザーが、合理的な期間内(理想的には1ブロック以内)に包含される可能性は高いか?

この分析を行えば、エスカレーター アルゴリズムが通常の条件と変動条件の両方で、高額取引と低価格を望むユーザーの双方に対して、EIP-1559よりも優れた性能を発揮することがわかると考えています。

より深い シミュレーション/分析を行う必要があると思いますが、これらの条件下での予想される結果を共有します。

さらに、トランザクション手数料の支払いを現在の時間に関連付けることで、ミナーが現在の時間をより正直に報告するインセンティブが生まれます。

### 様々な条件とアルゴリズムの下でのユーザー戦略

まず、検討しているアルゴリズムの下で、さまざまな状況のユーザーの最適な戦略を提案します。

| ガス戦略                                                           | 現在の単一価格                                                                                                                                                        | EIP 1559                                                                                                                                                                       | エスカレーター                                                                                                                                                                                |
|-------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ブロックが定期的に半分以下、ユーザーが緊急の包含を望む                           | ユーザーは最近受け入れられた価格範囲内で入札し、若干オーバーペイする可能性がある。                                                                                                                 | ユーザーは現在の料金レートを1段階上回る価格で入札し、おそらく包含される。                                                                                                                                        | ユーザーは最近包含された価格の低端から高端までの範囲で入札し、可能な限り低い料金で包含される可能性が高い。                                                                                                        |
| ブロックが定期的に半分以下、ユーザーが良い価格を待つ意思がある                       | ユーザーは最近受け入れられた価格の低端付近または近くで入札し、しばらく待つ必要があるかもしれない。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                        | ユーザーは現在の価格レベルと同じか、それ以下で入札し、価格が下がるのを待つ。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                                                            | ユーザーは自分の希望する最低価格で入札し、待つ時間の上限を設定する。                                                                                                                                |
| ブロックが定期的に満杯、ユーザーが緊急の包含を望む                              | ユーザーは最近受け入れられたすべての取引の価格を上回る価格で入札し、かなりの過剰支払いをする可能性がある。                                                                                        | ユーザーは現在の価格レベルを上回る価格で入札し、次のブロックで競争力のある`tip`パラメーターを増やす必要があり、単一価格オークションの価格問題が再現される。                                                        | ユーザーは一貫して受け入れられている価格を上回る価格で入札し、その価格が十分ではない場合に備えて価格をエスカレーションさせる。                                                                                |
| ブロックが定期的に満杯、ユーザーが良い価格を待つ意思がある                         | ユーザーは最近受け入れられた価格の低端を下回る価格で入札し、しばらく待つ必要があるかもしれない。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                        | ユーザーは現在の価格レベルと同じか、それ以下で入札し、価格が下がるのを待つ。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                                                            | ユーザーは自分の希望する最低価格で入札し、待つ時間の上限を設定する。                                                                                                                                |
| ブロックが定期的に空き容量がある、ユーザーが緊急の包含を望む                        | ユーザーは最近受け入れられた価格範囲内または上回る価格で入札し、若干オーバーペイする可能性があるが、次のブロックに確実に含まれる。                                                                | ユーザーは現在の価格レベルと同じか、それ以上で入札し、次のブロックに確実に含まれる。                                                                                                                            | ユーザーは最近受け入れられた価格範囲内で入札し、次のブロックに確実に含まれる可能性が高い。                                                                                                                |
| ブロックが定期的に空き容量がある、ユーザーが良い価格を待つ意思がある                   | ユーザーは最近受け入れられた価格の低端を下回る価格で入札し、しばらく待つ必要があるかもしれない。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                        | ユーザーは現在の価格レベルと同じか、それ以下で入札し、次のブロックに確実に含まれる。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                                                | ユーザーは自分の希望する最低価格で入札し、待つ時間の上限を設定する。最低価格で次の数ブロックに確実に含まれる可能性が高い。                                                                                |

### 様々な条件とアルゴリズムの下でのユーザー結果

次に、上記の戦略の最終的な結果を検討します。これらの条件の下でユーザーは満足しているでしょうか? ユーザーの支払いを節約できましたか? 緊急の包含を望むユーザーは、それを確保できましたか?

| ガス戦略                                                           | 現在の単一価格                                                                                                                                                | EIP 1559                                                                                     | エスカレーター                                                                                                                                                                                |
|-------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| ブロックが定期的に半分以下、ユーザーが緊急の包含を望む                           | ユーザーは予想される金額を支払い、確実にトランザクションがマイニングされる。                                                                                                        | ユーザーは予想される金額を支払い、確実にトランザクションがマイニングされる。                                                                                                                                | ユーザーは予想される金額を支払い、確実にトランザクションがマイニングされる。                                                                                                                                |
| ブロックが定期的に半分以下、ユーザーが良い価格を待つ意思がある                       | ユーザーはより良い価格を待つことができるが、再署名したトランザクションを再送信する必要がある可能性がある。                                                                                | ユーザーはより良い価格を待つことができるが、再署名したトランザクションを再送信する必要がある可能性がある。                                                                                                | ユーザーは単一の署名で、自身の時間制限内で最低価格を発見できる。                                                                                                                                        |
| ブロックが定期的に満杯、ユーザーが緊急の包含を望む                              | ユーザーは過剰支払いをするが、確実にトランザクションが含まれる。                                                                                                                | `tip`パラメーターが1ブロック内の「タイブレーカー」となるため、ユーザーは確実な包含のために過剰支払いをする。                                                                                                | ユーザーは緊急性に応じて過剰支払いのリスクを調整できる。                                                                                                                                                |
| ブロックが定期的に満杯、ユーザーが良い価格を待つ意思がある                         | ユーザーは自分の価格を選択し、待つか、手動で再送信する。                                                                                                                     | ユーザーは自分の価格を選択し、待つか、手動で再送信する。                                                                                                                                                | ユーザーは最低価格と最高価格、最大待機時間を選択するため、再送信は不要。                                                                                                                                |
| ブロックが定期的に空き容量がある、ユーザーが緊急の包含を望む                        | ユーザーは過剰支払いをするが、確実にトランザクションが含まれる。                                                                                                                | ユーザーは現在の価格レベルと同じか、それ以上で入札し、確実にトランザクションがマイニングされる。                                                                                                                | ユーザーは予想される金額を支払い、確実にトランザクションがマイニングされる。                                                                                                                                |
| ブロックが定期的に空き容量がある、ユーザーが良い価格を待つ意思がある                   | ユーザーは最近受け入れられた価格の低端を下回る価格で入札し、しばらく待つ必要があるかもしれない。待ち過ぎると、より高い価格で再送信する必要がある可能性がある。                                        | ユーザーは自分の価格を選択し、待つか、手動で再送信する。                                                                                                                                                | ユーザーは最低価格と最高価格、最大待機時間を選択するため、再送信は不要。                                                                                                                                |
## 仕様
**クライアント全体のパラメーター**
* `INITIAL_FORK_BLKNUM`: 未定

**トランザクションパラメーター**
トランザクションの`gasPrice`パラメーターはオプションになり、省略された場合はこれらのパラメーターに置き換えられます:

* `START_PRICE`: ユーザーが支払いたい最低価格。
* `START_TIME`: このトランザクションが有効になる最初の時間。
* `MAX_PRICE`: ユーザーがこのトランザクションを処理させるために支払う意思のある最高価格。
* `MAX_TIME`: `MAX_PRICE`が達成される時間。この時間以降も、その価格でトランザクションは有効です。

**提案**

`block.number >= INITIAL_FORK_BLKNUM`のすべてのブロックについて:

新しい価格設定パラメーターを持つトランザクションを処理する際、ミナーは以下の線形関数に基づいて手数料を受け取ります。ここで`BLOCK`は現在のブロック番号です:

* `BLOCK > MAX_TIME`の場合、`TX_FEE = MAX_PRICE`。
* `TX_FEE = START_PRICE + ((MAX_PRICE - START_PRICE) / (MAX_TIME - START_TIME) * (BLOCK - START_TIME))`

JavaScriptの関数として:
```javascript
function txFee (startTime, startPrice, maxTime, maxPrice, currentTime) {

  if (currentTime >= maxTime) return maxPrice

  const priceRange = maxPrice - startPrice
  const blockRange = maxTime - startTime
  const slope = priceRange / blockRange

  return startPrice + (slope * (currentTime - startTime))
}
```

## 下位互換性

現在の`gasPrice`トランザクションは実質的に平坦エスカレーション型のトランザクション入札であるため、このモデルと完全に互換性があります。したがって、現在のトランザクション処理ロジックを非推奨にする具体的な要件はなく、冷蔵庫ウォレットやハードウェアウォレットが当面の間も引き続き機能し続けることができます。

## テストケース
未定

## 実装
未定

## セキュリティ上の考慮事項
このEIPのセキュリティ上の考慮事項は:
- 現時点では知られていない。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)により放棄されています。