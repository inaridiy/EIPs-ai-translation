---
original: cb79235cff91c44225ce890ae1c32c28b4ac57c85a0cf570780856613587549e
---

---
eip: 6190
title: Verkle互換のSELFDESTRUCT
description: SELFDESTRUCTを有限の状態変更のみ引き起こすように変更する
author: Gavin John (@Pandapip1)
discussions-to: https://ethereum-magicians.org/t/eip-6190-functional-selfdestruct/12232
status: 停滞
type: Standards Track
category: Core
created: 2022-12-20
requires: 2929, 6188, 6189
---

## 概要

`SELFDESTRUCT`を有限の状態変更のみ引き起こすように変更する。

## 動機

`SELFDESTRUCT`命令には固定価格がありますが、ストレージ/アカウントの変更は無制限です(すべてのキーを削除する必要があります)。これは長年の懸念事項でした。

さらに、*Verkleツリー*でアカウントが異なる方法で編成されるようになります。アカウントのプロパティ(ストレージを含む)には個別のキーがあります。使用されているすべてのキーを探索して見つけることはできません。これにより、Verkleツリーでの`SELFDESTRUCT`のサポートが非常に困難になります。このEIPは、Verkleツリーでの`SELFDESTRUCT`のサポートに向けた一歩です。

## 仕様

この文書の中の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

### 前提条件

[EIP-6188](./eip-6188.md)と[EIP-6189](./eip-6189.md)がこのEIPの正しい動作に必要です。

### `SELFDESTRUCT`の動作

トランザクションの最後でコントラクトを破壊する代わりに、そのトランザクションの最後に以下のことが行われます:

1. コントラクトのコードは`0x1`に設定され、ノンスは`2^64-1`に設定されます。
2. コントラクトの`0`番目のストレージスロットに、`CREATE`命令を使用した場合に発行されるアドレス(`keccak256(contractAddress, nonce)`)が設定されます。ノンスは常に`2^64-1`です。
3. コントラクトが1つ以上のエイリアスコントラクトによって転送された呼び出しの後にself-destructedされた場合、エイリアスコントラクトの`0`番目のストレージスロットに、ステップ2で計算されたアドレスが設定されます。
4. コントラクトの残高が、スタックの先頭にあるアドレスに全額転送されます。
5. スタックの先頭がポップされます。

### `SELFDESTRUCT`のガスコスト

`SELFDESTRUCT`のベースガスコストは`5000`に設定されます。`SELFDESTRUCT`のガスコストは、コントラクトのself-destructを転送したエイリアスコントラクトの数に応じて`5000`ずつ増加します。最後に、[EIP-2929](./eip-2929.md)のガスコスト増加が適用されます。

## 根拠

このEIPは、Verkleツリーでの`SELFDESTRUCT`のサポートに向けた一歩を踏み出すことを目的としており、最小限の変更を行うように設計されています。

`5000`のベースガスコストと追加のエイリアスコントラクトは、アカウントのノンスと最初のストレージスロットを設定するコストを表しています。[EIP-2929](./eip-2929.md)のガスコスト増加は、同EIPの根拠で述べられた理由により保持されています。

`2^64-1`のノンスは、[EIP-6188](./eip-6188.md)で指定されたノンスによって保護されているため選択されました。`0x1`のアカウントコードは、[EIP-6189](./eip-6189.md)で指定されたコードでした。

`CREATE`によって作成されるアドレスと同じアドレスにすることで、新しいメカニズムを導入することなく、特定のアドレスでアカウントを作成できるようにするという攻撃ベクトルを減らすことを目的としています。

## 下位互換性

このEIPはコンセンサスルールを変更するため、プロトコルのアップグレードが必要です。

## セキュリティ上の考慮事項

議論が必要です。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。