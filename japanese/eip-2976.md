---
original: 1da7579cb5bc80bb96334481a94155401417981edbe03d97e898ba4379a89e5b
---

---
eip: 2976
title: Gossipを介したタイプ化されたトランザクション
description: devp2pを介したタイプ化されたトランザクションの送信をサポートします。
author: Micah Zoltu (@MicahZoltu)
discussions-to: https://ethereum-magicians.org/t/eip-2976-eth-typed-transactions-over-gossip/4610
status: Final
type: Standards Track
category: Networking
created: 2020-09-13
requires: 2718
---

## 概要
[タイプ化されたトランザクション](./eip-2718.md)は、`TransactionType || TransactionPayload`としてdevp2pを介して送信できます。
`TransactionPayload`の正確な内容は、将来のEIPで定義される`TransactionType`によって定義されており、クライアントはdevp2pバージョンをインクリメントせずにそのgossipをサポートし始めることができます。
クライアントが認識できない`TransactionType`を受信した場合、そのクライアントは**SHOULD**その送信元のピアから切断する必要があります。
クライアントは、フォークブロックが到達したと信じるまで、新しいトランザクションタイプを送信**MUST NOT**します。

## 動機
[EIP-2718](./eip-2718.md)は、ブロック用の新しいトランザクションタイプを導入しました(これはブロックヘッダーのトランザクションルートとレシートルートの構成に反映されます)。
しかし、これらのトランザクションをgossipする仕組みがなければ、誰もそれらをブロックに含めることはできません。
devp2pを更新してタイプ化されたトランザクションのgossipをサポートすることで、これらの新しいトランザクションタイプの恩恵を受けることができます。

*注: タイプ化されたトランザクションの追加の動機については、[EIP-2718](./eip-2718.md)を参照してください。*

## 仕様
以下に指定されたすべての変更は、すべてのプロトコル/バージョンに遡及的に適用されます。

### 定義
* `||`はバイト/バイト配列の連結演算子です。
* `|`は型のユニオン演算子です。
* `DEVP2P_VERSION = TBD`
* `Transaction`は`TypedTransaction`または`LegacyTransaction`のいずれかです。
* `TypedTransaction`は、`TransactionType || TransactionPayload`を含むバイト配列です。
* `TypedTransactionHash`は`keccak256(TypedTransaction)`です。
* `TransactionType`は、トランザクションの種類を表す0から0x7fの間の正の符号なし8ビット数です。
* `TransactionPayload`は、`TransactionType`に依存し、将来のEIPで定義される不透明なバイト配列です。
* `LegacyTransaction`は、`[nonce, gasPrice, gasLimit, to, value, data, v, r, s]`の形式の配列です。
* `LegacyTransactionHash`は`keccak256(rlp(LegacyTransaction))`です。
* `TransactionId`は`keccak256(TypedTransactionHash | LegacyTransactionHash)`です。
* `Receipt`は`TypedReceipt`または`LegacyReceipt`のいずれかです。
* `TypedReceipt`は、`TransactionType || ReceiptPayload`を含むバイト配列です。
* `ReceiptPayload`は、`TransactionType`に依存し、将来のEIPで定義される不透明なバイト配列です。
* `LegacyReceipt`は、`[status, cumulativeGasUsed, logsBloom, logs]`の形式の配列です。
* `LegacyReceiptHash`は`keccak256(rlp(LegacyReceipt))`です。

### プロトコルの動作
クライアントが認識できない`TransactionType`をメッセージを介して受信した場合、**SHOULD**その送信元のピアから切断する必要があります。

クライアントが、`TransactionType`に対して有効でない`TransactionPayload`を受信した場合、**SHOULD**その送信元のピアから切断する必要があります。

クライアントは、そのトランザクションタイプの導入フォークブロックが到達するまで、新しい`TransactionType`のトランザクションを送信**MUST NOT**します。

クライアントは、そのトランザクションタイプの導入フォークブロックよりも大幅に前に新しい`TransactionType`のトランザクションを送信するピアを切断する**MAY**。

### プロトコルメッセージ
`Transactions (0x02)`: `[Transaction_0, Transaction_1, ..., Transaction_n]`

`BlockBodies (0x06)`: `[BlockBody_0, BlockBody_1, ..., BlockBody_n]`ここで:
* `BlockBody`は`[TransactionList, UncleList]`です。
* `TransactionList`は`[Transaction_0, Transaction_1, ..., Transaction_n]`です。
* `UnclesList`は、以前のdevp2p仕様で定義されています。

`NewBlock (0x07)`: `[[BlockHeader, TransactionList, UncleList], TotalDifficulty]`ここで:
* `BlockHeader`は、以前のdevp2p仕様で定義されています。
* `TransactionList`は`[Transaction_0, Transaction_1, ..., Transaction_n]`です。
* `UnclesList`は、以前のdevp2p仕様で定義されています。
* `TotalDifficulty`は、以前のdevp2p仕様で定義されています。

`NewPooledTransactionIds (0x08)`: `[TransactionId_0, TransactionId_1, ..., TransactionId_n]`

`GetPooledTransactions (0x09)`: `[TransactionId_0, TransactionId_1, ..., TransactionId_n]`

`PooledTransactions (0x0a)`: `[Transaction_0, Transaction_1, ..., Transaction_n]`

`Receipts (0x10)`: `[ReceiptList_0, ReceiptList_1, ..., ReceiptList_n]`ここで:
* `ReceiptList`は`[Receipt_0, Receipt_1, ..., Receipt_n]`です。

## 根拠
### なぜプロトコル層で各トランザクションタイプを指定しないのですか?
プロトコルにトランザクションペイロードの形状を認識させることもできました。
しかし、著者らは長期的にはdevp2pを更新する必要があるのは大きな保守負担になると感じたため、単にタイプ化されたトランザクションがサポートされていることを定義することにしました。
### 未知のトランザクションタイプを受信した場合にピアを切断する理由は何ですか?
未知のトランザクションタイプを送信するピアに接続し続けるよう奨励することもできます。
これは、受信者が新しいトランザクションタイプを認識していない場合に備えてです。
ただし、そうすると、未定義の`TransactionType`のトランザクションを送信してクライアントをDoS攻撃の対象にする可能性があります。
また、ほとんどの場合、新しいトランザクションタイプがdevp2pを介して送信されるようになる時点では、その新しいトランザクションタイプを認識する必要があるハードフォークがほぼ確実に差し迫っています。

## 下位互換性
従来のトランザクションはまだサポートされています。

## セキュリティ上の考慮事項
クライアントが、未知のトランザクションタイプを送信するピアを切断するという**SHOULD**推奨事項を無視する場合、DoS攻撃の対象になる可能性があります。
この推奨事項を無視するのは、信頼できるピアのみ、またはDoSのリスクが極めて低い他の状況に限定する必要があります。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。