---
original: 66885796301ef75153feb0a4c3f9cf0085b152545a45fa0d555a69833d673438
---

---
eip: 2803
title: リッチトランザクション
description: 外部所有アカウントからバイトコードを直接実行できるようにすることで、'リッチトランザクション'をサポートする。
author: Micah Zoltu (@MicahZoltu)
discussions-to: https://ethereum-magicians.org/t/rich-transactions-via-evm-bytecode-execution-from-externally-owned-accounts/4025
status: 停滞
type: Standards Track
category: Core
created: 2020-07-18
---

## 概要
トランザクションの `to` が address `x` の場合、トランザクションの `data` はEVMバイトコードとして扱われ、トランザクションの署名者(つまり `CALLER`)のコンテキストから実行されます。

## 動機
現在、多くのイーサリアムDAppでは、1つの効果を生み出すために、ユーザーが複数のトランザクションを承認する必要があります。例えば、トークンの使用を承認してから、そのコントラクトを呼び出すといった一般的なパターンがあります。これにより、ユーザーエクスペリエンスが悪化し、DAppとのインタラクションが複雑になります。

外部所有アカウントがEVMバイトコードを直接実行できるようにすることで、単一のトランザクションで複数のコントラクト呼び出しを実行できるようになり、DAppは1回のインタラクションで最大1回のトランザクションしか必要としないスムーズな体験を提供できるようになります。

現在、これは契約ウォレットを使って原理的に可能ですが、ガス代を送信アカウントに資金提供する必要があること、ブラウザ統合で契約ウォレットがサポートされていないこと、契約ウォレットの一貫したAPIがないことなどのUXの問題により、これらの採用は低調です。このEIPは、「完璧を善の敵にしてはいけない」という精神に基づき、既存のEOAの有用性を高める方法です。

## 仕様
新しい予約アドレス `x` が、プリコンパイルに使用される範囲に指定されます。外部所有アカウントからこのアドレスにトランザクションを送信すると、トランザクションのペイロードがEVMバイトコードとして扱われ、トランザクションの署名者を現在のアカウントとして実行されます。明確にするために:
 - `ADDRESS`オペコードは、トランザクションに署名したEOAのアドレスを返します。
 - `BALANCE`オペコードは、トランザクションに署名したEOAの残高を返します。
 - 値を送信する `CALL` オペレーションは、トランザクションに署名したEOAから値を取ります。
 - `CALL`は `CALLER` をEOA(ではなく `x`)に設定します。
 - `DELEGATECALL`は所有アカウントとしてEOAを保持します。
 - `CALLER`と`ORIGIN`オペコードはともに、トランザクションに署名したEOAのアドレスを返します。
 - プリコンパイルアドレスには関連するコードはありません。 `CODE*`と`EXTCODE*`オペコードは、空のアドレスの場合と同じように動作します。
 - `CALLDATA*`オペコードは、予想どおりトランザクションのペイロードで動作します。
 - `SLOAD`と`SSTORE`は、EOAのストレージで動作します。その結果、EOAはトランザクション間で永続化するデータをストレージに持つことができます。
 - `SELFDESTRUCT`オペコードは何も行いません。
 - その他のすべてのオペコードは、コントラクトアドレスへの呼び出しの場合と同様に動作します。
 - 値が添付されている場合、トランザクションは無効です。
 - コントラクトからプリコンパイルアドレスへの呼び出しには特別な効果はなく、存在しないプリコンパイルや空のアドレスへの呼び出しと同等です。

## 根拠
このEIPの目的は、新しいプリコンパイルが可能な限り `DELEGATECALL` からの外部所有アカウントのように動作することです。ただし、コードがオンチェーンに保存されていないことや、`SELFDESTRUCT`などの特殊なケースを反映するために、いくつかの変更が必要です。これにより、EOAのnonce(ランダム数)をゼロにする機能などの新しいエッジケースが導入されるのを防ぐことができます。

EIP-2718トランザクションタイプの新規定義ではなく、プリコンパイルを使用した理由は、プリコンパイルを使えば、任意のEIP-2718トランザクションタイプでリッチトランザクションを持つことができるためです。

## 下位互換性
このEIPは、将来のハードフォークで実装される新機能を導入します。既存のコードとの下位互換性の問題は予想されません。

EOAが複数の操作を原子的に実行できないことを前提としているコントラクトやDAppは、この変更の影響を受ける可能性があります。なぜなら、これにより、EOAが複数の原子的操作を一緒に実行できるようになるためです。ただし、この「保護」は鉱夫によってすでに簡単に回避されているため、著者はこれが重要なユースケースではないと考えています。

## 著作権
[CC0](../LICENSE.md)によって著作権およびそれに関連する権利が放棄されています。