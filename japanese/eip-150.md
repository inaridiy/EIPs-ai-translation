---
original: 1c7919b2035588c11842e8322cb4febcf3e9c5ddf1a2621eea589ba18a5cc39c
---

---
eip: 150
title: IO集約型操作のガスコスト変更
author: Vitalik Buterin (@vbuterin)
type: Standards Track
category: Core
status: Final
created: 2016-09-24
---

### メタリファレンス

[Tangerine Whistle](./eip-608.md)。

### パラメータ

|   FORK_BLKNUM   |  CHAIN_ID  | CHAIN_NAME  |
|-----------------|------------|-------------|
|    2,463,000    |     1      | メインネット|

### 仕様

`block.number >= FORK_BLKNUM`の場合:
- EXTCODESIZE のガスコストを20から700に増加させる。
- EXTCODECOPY のベースガスコストを20から700に増加させる。
- BALANCE のガスコストを20から400に増加させる。
- SLOAD のガスコストを50から200に増加させる。
- CALL、DELEGATECALL、CALLCODE のガスコストを40から700に増加させる。
- SELFDESTRUCT のガスコストを0から5000に増加させる。
- SELFDESTRUCT が新しく作成されたアカウントに当たる場合、追加のガスコスト25000が発生する(CALLと同様)。
- 推奨ガスリミットターゲットを550万に増加させる。
- `N`の"64分の63"を`N - floor(N / 64)`と定義する。
- コールが許可された最大ガス量(つまり、コールのガスコストと記憶域拡張を差し引いた後の親の残りガス量)を超える場合、OOGエラーを返さない。代わりに、コールが許可された最大ガス量の64分の63を超える場合、許可された最大ガス量の64分の63のガスでコールを実行する(これはEIP-90<sup>[1](https://github.com/ethereum/EIPs/issues/90)</sup>とEIP-114<sup>[2](https://github.com/ethereum/EIPs/issues/114)</sup>の組み合わせに相当する)。CREATEは親ガスの64分の63しか子コールに提供しない。

つまり、以下のように置き換える:

```
        extra_gas = (not ext.account_exists(to)) * opcodes.GCALLNEWACCOUNT + \
            (value > 0) * opcodes.GCALLVALUETRANSFER
        if compustate.gas < gas + extra_gas:
            return vm_exception('OUT OF GAS', needed=gas+extra_gas)
        submsg_gas = gas + opcodes.GSTIPEND * (value > 0)
```

を以下のように:

```
        def max_call_gas(gas):
          return gas - (gas // 64)

        extra_gas = (not ext.account_exists(to)) * opcodes.GCALLNEWACCOUNT + \
            (value > 0) * opcodes.GCALLVALUETRANSFER
        if compustate.gas < extra_gas:
            return vm_exception('OUT OF GAS', needed=extra_gas)
        if compustate.gas < gas + extra_gas:
            gas = min(gas, max_call_gas(compustate.gas - extra_gas))
        submsg_gas = gas + opcodes.GSTIPEND * (value > 0)
```

### 根拠

最近の拒否サービス攻撃により、状態ツリーを読み取るオペコードが他のオペコードに比べて過小評価されていることが明らかになりました。この問題を緩和するためのソフトウェアの変更が行われており、今後も行われる予定ですが、そのようなオペコードは依然として、トランザクションスパムを介してネットワークパフォーマンスを著しく低下させる最も簡単な既知のメカニズムであり続けます。この問題は、ディスクからの読み取りに時間がかかることと、今後のシャーディング提案にもリスクがあるためです。攻撃トランザクションはこれまでネットワークパフォーマンスの劣化に最も成功してきましたが、それらはメルクルプルーフを提供するために数十メガバイトも必要とします。このEIPは、この懸念に対処するために、状態読み取りオペコードのコストを引き上げています。コストは、1.0ガスコストの計算に使用されたテーブルの更新版に基づいて導出されています: https://docs.google.com/spreadsheets/d/15wghZr-Z6sRSMdmRmhls9dVXTOpxKy8Y64oy9MvDZEQ/edit#gid=0。ルールは、ブロック処理に必要な読み取りデータを8MBに制限することを目標としており、SLOADのメルクルプルーフに500バイト、アカウントに1000バイトを見積もっています。

このEIPは単純であり、この表で計算されたコストに加えて、コードの読み込み(最悪の場合17-21kbに相当)のコストを考慮して、さらに300ガスのペナルティを課しています。

EIP 90のガスメカニクスが導入されているのは、それがなければ、現在のすべてのコントラクトが機能しなくなるためです。これらのコントラクトは、コールのガスコストが40であることを前提として、`msg.gas - 40`のような式を使ってコールに使うガス量を決めています。さらに、EIP 114が導入されているのは、コールのコストを高くしてより予測不可能にすることで、現在利用可能な保証を損なうことなく、コールスタックの深さ制限を"ソフトな"ガスベースの制限に置き換えることができるためです。これにより、コントラクト開発者がコールスタックの深さ攻撃を心配する必要がなくなり、コントラクトプログラミングの安全性が向上します。与えられたパラメータでは、事実上のコールスタックの最大深さは~340(1024から)に制限されるため、さらなる潜在的な二次的複雑性のDDoS攻撃による被害を軽減できます。

ガスリミットの増加は、平均的なコントラクトのトランザクション処理能力を維持するために推奨されています。

## 参考文献

1. EIP-90, https://github.com/ethereum/EIPs/issues/90
2. EIP-114, https://github.com/ethereum/EIPs/issues/114