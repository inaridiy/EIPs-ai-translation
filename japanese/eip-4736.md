---
original: cc4f700c3e1a835ea72df401f6cdd57def284d280ab83e4bdc376e7844df4a2c
---

---
eip: 4736
title: コンセンサスレイヤー引き出し保護
description: コンセンサスレイヤーニーモニックが危殆化された場合の追加セキュリティ、コンセンサスを変更することなく
author: Benjamin Chodroff (@benjaminchodroff), Jim McDonald (@mcdee)
discussions-to: https://ethereum-magicians.org/t/consensus-layer-withdrawal-protection/8161
status: Final
type: Standards Track
category: Interface
created: 2022-01-30
---

## 概要

コンセンサスレイヤーのニーモニックフレーズが危殆化された場合、コンセンサスレイヤーネットワークは正当な鍵の保有者と不正な保有者を区別することはできません。しかし、コアイーサリアムコンセンサスを変更することなく、より広い意味で考慮できる信号があります。この提案では、実行レイヤーのデポジットアドレスや署名済みメッセージのリストなどの on-chain の証拠が、正当なニーモニック保有者が攻撃者に対して競争条件で勝つことを大幅に有利にするが保証するものではない、社会的なコンセンサスを生み出す方法について説明しています。

## 動機

コンセンサスレイヤーの `BLSToExecutionChange` メッセージは、鍵とニーモニックが危殆化されていないことを確信している単一のユーザーにとって安全です。しかし、コンセンサスレイヤーの検証者の引き出しは Capella ハードフォークまで不可能であるため、ユーザーは `BLSToExecutionChange` がオンチェーンになるまで、つまり遅すぎるまで、自分の鍵が危殆化されていないことを確信することはできません。当初すべての正当なニーモニックフレーズ保有者は実行レイヤーのデポジットアドレスを制御していました。ビーコンノードクライアントとノードオペレーターは、正当な保有者が攻撃者に対して競争条件で勝つことを大幅に有利にする可能性のある検証可能な `BLSToExecutionChange` メッセージのリストを任意でロードできます。攻撃者がコンセンサスレイヤーのノードを大量に危殆化した場合、イーサリアム全体のコミュニティにリスクをもたらします。

引き出しアドレスを実行レイヤーアドレスに設定することは、eth2.0-deposit-cli v1.1.1 (2021年3月23日)まで対応されていませんでした。これにより、早期採用者は自分のデポジットアドレスを実行レイヤーアドレスに強制的に設定したいと望んでいました。このような変更をプロトコル内で強制することはできません。部分的にはビーコンチェーンに実行レイヤーのデポジットアドレスに関する情報がないためであり、部分的にはこれが要件として記載されていなかったためです。また、引き出しの秘密鍵の正当な保有者の制御下にない実行レイヤーのデポジットアドレスである可能性もあります。

しかし、個々のノードがコンセンサスを変更することなく、ブロックに含めたり、ネットワーク上で伝播したりするリクエストを制限することは可能です。また、クライアントノードが `BLSToExecutionChange` リクエストを公平な方法で可能な限り多くのノードに迅速に伝播するのを支援することも可能です。さらに、このような `BLSToExecutionChange` の署名済みメッセージをあらかじめクライアントにロードすることで、攻撃リクエストをさらに効果的にフィルタリングできます。

この提案は純粋にオプションの追加保護を提供します。2つの競合する `BLSToExecutionChange` メッセージがある場合に、検証可能な実行レイヤーのデポジットアドレスを優先的に扱うようノードに要求することを目的としています。また、ネットワークがそれをサポートするようになったときに「可能な限り早く」これらのメッセージを伝播するのを支援するために、`BLSToExecutionChange` の署名済みメッセージのリストを確立することも目的としています。これはコンセンサスを変更するものではありませんが、引き出しキーが故意または偶発的に危殆化された場合の攻撃の伝播を防ぐのに役立つ可能性があります。

この提案がコンセンサスの変更ではないことを理解することが重要です。この提案のいかなる部分も、プロトコル内の引き出し資格情報操作の有効性を制限するものではありません。これは、ビーコンノードにこの機能を構築し、ノードオペレーターがユーザーが提案する制限と伝播機能の一部または全部を受け入れるかどうかを決める、クライアントチームとノードオペレーターの自発的な変更です。

上記のため、完全に実装されたとしても、どのバリデーターがブロックを提案し、それらのバリデーターのビーコンノードが実行している任意の制限は偶然によるものです。ノードオペレーターは危殆化された可能性のあるコンセンサスレイヤーの鍵に対する攻撃を防ぐためにできることはありますが、成功を保証するものではありません。

## 仕様

コンセンサスレイヤーの `BLSToExecutionChange` 操作には以下のフィールドがあります:

* バリデーターインデックス
* 現在の引き出しBLS公開鍵
* 提案された実行レイヤーの引き出しアドレス
* 上記のフィールドに対する引き出し秘密鍵による署名

この提案は、クライアントビーコンノードが任意で実装できる機能と、ユーザーが自身のビーコンノード運用で推奨される機能を説明しています。

### `BLSToExecutionChange` 伝播ファイル

ビーコンノードクライアントは、「バリデーターインデックス」、「現在の引き出しBLS公開鍵」、「提案された実行レイヤーの引き出しアドレス」、「署名」を指定する行からなる任意のファイルをサポートできます。このファイルが提供された場合、ノードはCapellaハードフォーク時に有効な署名ごとに1回限りの `BLSToExecutionChange` 伝播メッセージを自動的に送信するよう指示されます。このファイルにより、すべてのノードオペレーターが Capella ハードフォーク時に有効な `BLSToExecutionChange` メッセージを確実に伝播、共有、リピートできる任意の機会が得られます。このオプションのファイルはまた、ファイル内の署名と一致するメッセージの受け入れと再伝播を指示し、引き出し資格情報に一致しない署名のメッセージの受け入れや再伝播を拒否するよう、ノードに指示します。

### `BLSToExecutionChange` の処理

ビーコンノードクライアントは、検証可能な署名の "`BLSToExecutionChange` 伝播"ファイルを受け入れることを推奨されており、その後 P2P 経由の "最初のリクエスト" を受け入れるよう選択できます。この提案のすべての部分はビーコンノードの実装や使用にとってオプションですが、すべてのクライアントチームは Capella ハードフォーク前に "`BLSToExecutionChange` 伝播ファイル"をローカルにロードできるようにすることが推奨されます。この任意の保護により、ユーザーはコンセンサスを変更することなくネットワークがそれをサポートするようになった時点で引き出しアドレスメッセージを設定しようとできます。

## 根拠

この提案は、故意または偶発的に危殆化された正当なバリデーターのニーモニック保有者を保護することを目的としています。所有権を移転する安全な方法がないため、すべてのバリデーター保有者が自分が指定する引き出しアドレスに設定しようとすると安全に想定できます。実行レイヤーのデポジットアドレスを正当な保有者を判断するために使用することは、過去の履歴にあり、そのようなリストを維持するのに過大な負担がかかるため、コンセンサスで考慮することはできません。そのため、この提案は、クライアントノードソフトウェアやオペレーターに義務的な負担を課すことなく、正当な元のニーモニック保有者を保護するオプションのメカニズムを概説しています。

## 下位互換性

Capella 以前に `BLSToExecutionChange` 操作は存在しないため、文書化された下位互換性はありません。提案のすべての部分が実装とオペレーションの両方でオプションであるため、この提案の機能の一部または全部を実装しないクライアントビーコンノードも、提案で説明されている機能の一部または全部を実装するクライアントと完全に下位互換性を維持すると予想されます。さらに、ユーザーはこれらのオプション機能を有効にすることが推奨されますが、一部または全部の機能を無効にしたり無視したり、意図された目的に反するコンテンツを意図的にロードしたりした場合でも、ビーコンノードクライアントはコアイーサリアムコンセンサスを変更することなく完全に互換性を維持し続けます。

## 参考実装

### `BLSToExecutionChange` 伝播ファイル

すべてのコンセンサスレイヤーの引き出し資格情報の署名と検証可能な実行レイヤーのデポジットアドレスをあらかじめロードする "change-operations.json" ファイル。このファイルはスクリプトで生成され、コミュニティメンバーがコンセンサスレイヤーノードを使用して独立して検証できるものとし、すべてのクライアントに含めて、デフォルトで有効にすることを奨励します。

change-operations.json フォーマットは、単一の JSON 配列に結合された "`BLSToExecutionChange` ファイル - クレーム" です。

### `BLSToExecutionChange` 伝播ファイル - クレーム

検証可能な "`BLSToExecutionChange` 伝播"クレームのコミュニティ収集および独立検証可能なリストが収集されます。ノードオペレーターはこれらのクレームを独立して検証でき、互換性のあるビーコンノードクライアントにクレームをロードすることが提案されます。

検証可能なクレームを作成するには、ユーザーは "[chain]/validatorIndex.json" というテキストファイルを任意の公開リポジトリにアップロードできます。例えば "mainnet/123456.json" のようなファイルです。

123456.json:

```
[{"message":{"validator_index":"123456","from_bls_pubkey":"0x977cc21a067003e848eb3924bcf41bd0e820fbbce026a0ff8e9c3b6b92f1fea968ca2e73b55b3908507b4df89eae6bfb","to_execution_address":"0x08f2e9Ce74d5e787428d261E01b437dC579a5164"},"signature":"0x872935e0724b31b2f0209ac408b673e6fe2f35b640971eb2e3b429a8d46be007c005431ef46e9eb11a3937f920cafe610c797820ca088543c6baa0b33797f0a38f6db3ac68ffc4fd03290e35ffa085f0bfd56b571d7b2f13c03f7b6ce141c283"}]
```

#### クレームの受け入れ

公開リポジトリにマージされるためには、提出物は以下の条件を満たす必要があります:

1. validatorIndex.json という形式のファイル名
2. コンセンサスレイヤーで有効なバリデーターインデックス
3. 検証可能な署名
5. 1つのバリデーターに対する1つの変更操作で、ファイルに必要なすべてのフィールドが含まれ、他のコンテンツがない

受け入れられなかったすべてのマージリクエストには、上記の理由が提供されます。これらの理由に対処する必要があります。受け入れられたクレームへの今後の検証可能な修正は、同じ提出者によって提案される必要があり、それ以外の場合は争いとして扱われます。

#### `BLSToExecutionChange` 伝播

コミュニティ内の誰もが、Capella 仕様やコマンドラインクライアントツール (「ethdo」など) を使用して、提供されたクレームファイルを独立して検証できます。

2つ以上の提出物の間で検証可能なコンセンサスレイヤーの署名が異なり、いずれの当事者も実行レイ
ヤーのデポジットアドレスの所有権を証明できない場合、クレームは争われているとみなされます。争われているが検証済みの "`BLSToExecutionChange` 伝播"リクエストがリポジトリに到着した場合、すべての当事者に通知され、オンチェーンの証拠やオフチェーンの証拠を提供して自分のクレームをノードに含めるよう、より広いコミュニティを説得しようとする可能性があります。ノードオペレーターは、社会的なコンセンサスに基づいて、どの検証可能なクレームを含めるかを決定できます。

## セキュリティ上の考慮事項

### 1: 攻撃者が EL デポジットキーを持っていない、争われていないクレーム

* ユーザーA: CLキーとデポジットに使用されるELキーを制御している
* ユーザーB: CLキーを制御しているが、デポジットのELキーを制御していない

ユーザーAがCLWPリポジトリにクレームを署名して提出し、クライアントがユーザーAのメッセージを "`BLSToExecutionChange` 伝播"ファイルにロードします。最初のエポックでの `BLSToExecutionChange` サポート時に、多くの (すべてではない) ノードがこのメッセージを伝播し始めます。ユーザーBも別の有効な `BLSToExecutionChange` を、クレームのシグネチャと一致しないアドレスに送信しようとします。このメッセージはREST APIで正常に受信されますが、一部の (すべてではない) ノードがシグネチャが "`BLSToExecutionChange` 伝播"ファイルのシグネチャと一致しないため、このメッセージを静かにドロップし始めます。そのため、これらのノードはこのメッセージをP2Pで複製しません。

### 2: 攻撃者がELデポジットキーとCLキーの両方を持っている、争われていないクレーム

* ユーザーA: CLキー/ニーモニックとデポジットに使用されるELキーを制御し、新しいアドレスに移動するクレームを提出する
* ユーザーB: ELデポジットに使用されるCLおよびELキー/ニーモニックを制御しているが、クレームを提出しない

ユーザーAがELデポジットアドレスのすべての資金が盗まれたことに気づく可能性があります。これにより、CLキーも危殆化された可能性があるため、引き出しのための新しいアドレスを選択することを決めるかもしれません。シナリオ1と同様の展開になりますが、クレームが争われていないためです。

### 3: #2と同様だが、攻撃者が争われたクレームを提出する

* ユーザーA: CLキー/ニーモニックとデポジットに使用されるELキーを制御し、新しいアドレスに移動するクレームを提出する
* ユーザーB: CLキー/ニーモニックとデポジットに使用されるELキーを制御し、新しいアドレスに移動するクレームを提出する

これは争われたクレームであり、オンチェーンのデータを使用して誰が正当な所有者であるかを証明する方法はありません。代わりに、ノードオペレーターが自分の争われたクレームを "`BLSToExecutionChange` 伝播"ファイルにロードするよう説得しようと、いずれかのユーザーが自分が正当な所有者であることをコミュニティに説得しようとする可能性があります。しかし、完全に証明する方法はありません。

### 4: ユーザーがCLキーおよび/またはニーモニックを紛失した (引き出しキーがない)

* ユーザーA: CLキーとニーモニックがない

この提案では、ユーザーがキーを紛失したことを証明する方法がないため、この状況を回復する方法はありません。ニーモニックは引き出しキーを生成するために必要です。

### 5: エンドゲーム - 攻撃者

* ユーザーA: ELおよびCLキー/ニーモニックを制御し、アドレス設定の引き出しに成功する
* ユーザーB: CLキーを制御し、攻撃を決める

ユーザーAが正常にアドレス設定の引き出しを行ったことに気づいた後、ユーザーBはバリデーターを実行し、ユーザーAをスラッシュしようとする可能性があります。自分のバリデーターキーやシードフレーズが危殆化されていると疑う場合は、できるだけ早くバリデーターを退出する措置を講じるべきです。

### 6: 鍵が危殆化されているが、引き出しに脆弱ではない

* ユーザーA: ELおよびCLキー/ニーモニックを制御しているが、CLキーは漏洩するが CLニーモニックは漏洩しない脆弱性がある
* ユーザーB: CLキーを制御しているが、CLニーモニックがない

ユーザーAは引き出しキー (ニーモニックが必要) を生成できます。ユーザーBはユーザーAをスラッシュすることで攻撃できますが、引き出しキーを生成することはできません。

### 7: 攻撃者が1つ以上のノードに悪意のある `BLSToExecutionChange` 伝播ファイルをロードし、ユーザーAがクレームを提出する

* ユーザーA: 争われていない有効なクレームを提出し、多くのノードですぐに伝播される
* ユーザーB: クレームを提出せず、自分の `BLSToExecutionChange` 伝播リストを通じて有効な悪意のあるクレームを伝播し、ユーザーAのクレームをノードでブロックする

ユーザーBのクレームは多くのノードに到達しますが、ユーザーAの署名を採用したノードに到達すると、ドロップされ、再伝播されません。統計的に、ユーザーBは全コミュニティの中で合意を得るのが難しくなりますが、それは偶然次第です。

### 8: #7と同様だが、ユーザーAがクレームを提出しない

攻撃者は最初にメッセージを多くのノードに伝播できるため、統計的に勝つ可能性が高くなります。ユーザーAがサポート開始時にリクエストを提出しない限り、十分なノードに聞こえる可能性は低くなります。ニーモニックが危殆化されていないことを確認できるのは遅すぎるため、すべてのユーザーがこの理由でクレームを提出することが奨励されます。

### 二次的影響

1. "`BLSToExecutionChange` 伝播"に参加するユーザーは、攻撃者に早期に諦めさせ、代わりにスラッシュを開始させる可能性があります。一部のユーザーにとって、スラッシュされるのは敵に資金を与えるよりも好ましい可能性があります。提案は任意のため、このシナリオを恐れるユーザーは参加しないことを選択する可能性があります。
2. 攻撃者は自分の `BLSToExecutionChange` 伝播を設定して、自分の攻撃と一致しない署名を拒否する可能性があります。これは、この提案の有無にかかわらず可能です。
3. 攻撃者が、この提案のメカニズムを使用して "`BLSToExecutionChange` 伝播"クレームを収集し、意図的に正当なリクエストを拒否する可能性があります。誰でも、同じメカニズムを使用して独自のコミュニティクレーム収集を設定し、代替の社会的コンセンサスを形成することができます。

## 著作権

著作権およびそれに関連する権利は [CC0](../LICENSE.md) により放棄されています。