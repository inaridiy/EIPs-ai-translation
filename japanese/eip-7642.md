---
original: ba69ddcda305705fca24fccb33b10c5c24b141b6e49ef7cfa15c023e2600006d
---

---
eip: 7642
title: eth/69 - マージ前のフィールドの削除
description: マージ後の不要なフィールドの削除
author: Marius van der Wijden (@MariusVanDerWijden)
discussions-to: https://ethereum-magicians.org/t/eth-70-drop-pre-merge-fields-from-eth-protocol/19005
status: Draft
type: Standards Track
category: Networking
created: 2024-02-29
requires: 5793
---

## 概要

マージ後、ネットワーキングプロトコルの一部のフィールド(`td`)とメッセージ(`NewBlockHashes`、`NewBlock`)が不要になりました。
このEIPは、これらのフィールドが送信されないようにネットワーキングメッセージを変更します。
さらに、レシートネットワーキングメッセージから`Bloom`フィールドを削除することを提案します。

## 動機

最近、クライアントが必要に応じて再計算できる`Bloom`フィールドをレシートに保存していないことが判明しました。
しかし、ネットワーキング仕様では`Bloom`フィールドをネットワーク経由で送信する必要があります。
したがって、同期ノードはすべてのレシートのBloomフィルターを要求します。
サービングノードは約530GBのBloomフィルターを再生成します(23億トランザクション * 256バイト)。
これらの530GBがネットワーク経由で同期ピアに送信され、同期ピアが確認しても保存しません。
これにより、同期時の不要なバンド幅が530GBも追加されます。

さらに、マージによって非推奨になったフィールドとメッセージを削除することを提案します。

- `Status`メッセージから`TD`フィールドを削除します。

- `NewBlockHashes`メッセージを削除します。

- `NewBlock`メッセージを削除します。

## 仕様

`NewBlockHashes (0x01)`メッセージを削除します。

`NewBlock (0x07)`メッセージを削除します。

`Status (0x00)`メッセージを次のように変更します:

- (eth/68): `[version: P, networkid: P, td: P, blockhash: B_32, genesis: B_32, forkid]`

- (eth/69): `[version: P, networkid: P, blockhash: B_32, genesis: B_32, forkid]`

`Receipts (0x10)`メッセージのレシートエンコーディングを次のように変更します:

- (eth/68): `receipt = {legacy-receipt, typed-receipt}` with `typed-receipt = tx-type || receipt-data` and

```
legacy-receipt = [
    post-state-or-status: {B_32, {0, 1}},
    cumulative-gas: P,
    bloom: B_256,
    logs: [log₁, log₂, ...]
]
```

- (eth/69): `receipt = {legacy-receipt, typed-receipt}` with `typed-receipt = tx-type || receipt-data` and

```
legacy-receipt = [
    post-state-or-status: {B_32, {0, 1}},
    cumulative-gas: P,
    logs: [log₁, log₂, ...]
]
```

レガシーおよび型付きレシートの両方からBloomフィルターを省略します。
受信ノードはログに基づいてBloomフィルターを再計算できます。

## 根拠

マージ後、`Status`メッセージの`TD`フィールドは意味がなくなりました。なぜなら、マージ後のブロックの難易度は0だからです。
同期済みノードと未同期ノードを区別するために使用できますが、同じことをforkidでも行えます。
go-ethereumコードベースでは使用されていません。

マージ後、`NewBlock`および`NewBlockHashes`メッセージはブロック伝播に使用されていません。
なぜなら、マージ後のブロック伝播はコンセンサスレイヤーで行われるためです。
これらのメッセージタイプはgo-ethereumの実装でエラーになります。
これらを削除すると、メインネット以外のピアを早期に切断できます。

`Receipt`メッセージからBloomフィルターを削除すると、サービングノードのCPU負荷とバンド幅が大幅に削減されます。
受信ノードはBloomフィルターを再計算する必要があります。
再計算はそれほどCPU集約的ではありません。
バンド幅の節約は、同期ノードあたり約530GiBまたは(少なくとも)95GiBのsnappy圧縮です。

## 下位互換性

このEIPは`NewBlock`および`NewBlockHashes`メッセージを削除するため、これらを使用してブロックを配布するプライベートネットワークやフォークはこのバージョンにアップグレードできません。
イーサリアムメインネットと同様のメカニズムを使用するプライベートネットワークやフォークは、`eth/69`にアップグレードできます。

このEIPはeth プロトコルを変更し、新しいバージョン`eth/69`のリリースが必要です。
複数のワイヤープロトコルバージョンをサポートすることは可能です。
新しいバージョンをロールアウトしても、古いクライアントは直ちに破壊されません。
なぜなら、プロトコルバージョン`eth/68`を継続して使用できるためです。

このEIPはEVMのコンセンサスルールを変更せず、ハードフォークは必要ありません。

## セキュリティ上の考慮事項

なし

## 著作権

[CC0](../LICENSE.md)によりすべての著作権およびそれに関連する権利が放棄されています。