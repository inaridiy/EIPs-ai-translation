---
original: e9ad74874f464972427337230930acb506689e2cafddba5d037a800974ef0612
---

---
eip: 196
title: 楕円曲線alt_bn128の加算とスカラー乗算のための事前コンパイルされたコントラクト
author: Christian Reitwiessner <chris@ethereum.org>
type: Standards Track
category: Core
status: Final
created: 2017-02-02
---

## 簡単な要約

ブロックガス制限内でzkSNARKの検証を行うには、楕円曲線演算のための事前コンパイルされたコントラクトが必要です。

## 概要

このEIPでは、特定のペアリング対応楕円曲線上での加算とスカラー乗算のための事前コンパイルされたコントラクトを追加することを提案しています。これは[EIP-197](./eip-197.md)と組み合わせることで、Ethereumスマートコントラクト内でzkSNARKsを検証することができます。EthereumにおけるzkSNARKsの一般的な利点は、ユーザーのプライバシーを向上させること(ゼロ知識の性質のため)と、スケーラビリティの解決策となる可能性があること(簡潔性と効率的な検証性の性質のため)です。

## 動機

現在のEthereumスマートコントラクトの実行は完全に透明であるため、場所、身元、過去の取引履歴などの非公開情報を含む多くのユースケースに適していません。zkSNARKsの技術がこの問題の解決策となる可能性があります。EthereumバーチャルマシンはzkSNARKsを理論的に利用できますが、現在のところブロックガス制限に収まるほど安価ではありません。そのため、このEIPでは、zkSNARKsを効率的に実装し、ガスコストを削減するために、いくつかの基本的なプリミティブのパラメーターを指定することを提案しています。

これらのパラメーターを固定することで、zkSNARKsの使用ケースが制限されるように見えるかもしれませんが、これらのプリミティブはそれほど基本的なものであるため、将来のzkSNARK研究の進展に合わせて柔軟に組み合わせることができ、さらなるハードフォークを必要としないはずです。

## 仕様

`block.number >= BYZANTIUM_FORK_BLKNUM`の場合、楕円曲線"alt_bn128"上の点加算(ADD)とスカラー乗算(MUL)のための事前コンパイルされたコントラクトを追加します。

ADDのアドレス: 0x6
MULのアドレス: 0x7

この曲線は以下のように定義されます:
```
Y^2 = X^3 + 3
over the field F_p with
p = 21888242871839275222246405745257275088696311157297823662689037894645226208583
```

### エンコーディング

フィールド要素とスカラーは32バイトのビッグエンディアンの数値としてエンコードされます。曲線上の点は、`(x, y)`の2つのフィールド要素として表され、無限遠点は`(0, 0)`としてエンコードされます。

オブジェクトのタプルは、それらの連結としてエンコードされます。

両方の事前コンパイルされたコントラクトについて、入力が期待される長さより短い場合は、末尾にゼロが仮想的に付加されているものとみなされます(つまり、`CALLDATALOAD`オペコードのセマンティクスと互換性があります)。入力が期待される長さより長い場合は、末尾の余分なバイトは無視されます。

返されるデータの長さは常に指定された長さです(つまり、"パディングが外されて"いるわけではありません)。

### 正確なセマンティクス

無効な入力: 両方のコントラクトについて、入力点が曲線上にない場合や、フィールド要素(点の座標)がフィールドのモジュラスpと等しいか大きい場合、コントラクトは失敗します。スカラーは0から2**256-1の範囲の任意の数値でかまいません。

#### ADD
入力: 2つの曲線上の点`(x, y)`。
出力: 曲線上の点`x + y`。ここで`+`は上記の楕円曲線`alt_bn128`上の点加算を表します。
無効な入力で失敗し、提供されたすべてのガスを消費します。

#### MUL
入力: 曲線上の点とスカラー`(x, s)`。
出力: 曲線上の点`s * x`。ここで`*`は上記の楕円曲線`alt_bn128`上のスカラー乗算を表します。
無効な入力で失敗し、すべてのガスを消費します。

### ガスコスト

 - `ECADD`のガスコスト: 500
 - `ECMUL`のガスコスト: 40000

## 根拠

特に`alt_bn128`曲線を選択したのは、zkSNARKsや、より具体的には、ペアリング関数の検証ビルディングブロックに特に適しているためです。さらに、この曲線を選択することで、ZCashのコンポーネントや成果物の一部を再利用できるシナジー効果も得られます。

入力にカーブとフィールドのパラメーターを追加する機能は検討されましたが、最終的には却下されました。これは仕様を複雑化させるためです: ガスコストを大幅に決定するのが難しくなり、実際の楕円曲線ではないものに対してコントラクトを呼び出すことができてしまいます。

非コンパクトな点エンコーディングが選択されたのは、スマートコントラクト自体でいくつかの操作を実行できるようにするため(完全なy座標の含有)、および2つのエンコードされた点の等価性を比較できるようにするため(第3の射影座標は不要)です。

## 下位互換性

事前コンパイルされたコントラクトの導入に伴い、既に指定のアドレスを使用しているコントラクトのセマンティクスが変更されます。そのため、アドレスは256未満の"予約済み範囲"から取られています。

## テストケース

テストする入力:

 - 数値がpで割った余りとして有効な曲線上の点(失敗するはず)。
 - 両方のコントラクトで空の入力が成功するはず。
 - 有効な曲線上の点になる入力の一部が切り捨てられたもの。
 - 曲線上にない点(それ以外は有効)。
 - 群の位数よりも大きいスカラーで点を乗算(成功するはず)。
 - フィールドの位数よりも大きいスカラーで点を乗算(成功するはず)。

## 実装

これらのプリミティブの実装は以下で入手可能です:

 - [libff](https://github.com/scipr-lab/libff/blob/master/libff/algebra/curves/alt_bn128/alt_bn128_g1.cpp) (C++)
 - [bn](https://github.com/zcash/bn/blob/master/src/groups/mod.rs) (Rust)

両方のコードベースで、alt_bn128曲線上の特定のグループが使用されており、G1と呼ばれています。

 - [Python](https://github.com/ethereum/py_pairing/blob/master/py_ecc/bn128/bn128_curve.py) - おそらく最も自己完結的で最も読みやすいでしょう。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。